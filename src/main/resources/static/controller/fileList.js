layui.define(["table","admin","form","fileManager","upload"],(function(e){var a=layui.$,l=layui.admin,i=layui.table,n=(layui.view,layui.form),t=layui.upload,o=layui.fileManager;uploadInst=t.render({elem:"#fileManager",url:"/file/uploadFile",accept:"file",auto:!0,headers:{Authorization:layui.data("layuiAdmin").Authorization},choose:function(e){console.log(a(".layui-upload-file").get(0)),console.log(e);var l=e.pushFile(),i=Object.keys(l);i.forEach((function(e,a){a!==i.length-1&&delete l[e]})),file=l[i[i.length-1]],renderUpload({fileName:file.name})},done:function(e){200===e.code&&(layer.msg("成功发起审批"),window.history.back())},error:function(){}}),o.render({elem:"#fileManager",method:"get",id:"fmTest",btn_upload:!0,btn_create:!1,icon_url:"ico/",url:"/file/findAll",headers:{Authorization:layui.data("layuiAdmin").Authorization},thumb:{nopic:"ico/misc-no.png",width:100,height:100},parseData:function(e){console.log(e);var l=[];return l.code=0,l.data=e.data.content.map((function(e){var l=e.fileName.split(".")[1];return a.extend(e,{thumb:e.url,path:e.url,name:e.fileName,type:["jpg","png","gif","jpeg"].includes(l)?"misc":l})})),l.count=e.data.totalElements,l},done:function(e,i,n){a.contextMenu({selector:".fileManager li",items:{download:{name:"下载文件",callback:function(a,l){console.log(a,l,e);var i=l.$trigger.data().index;e.data[i]}},del:{name:"删除文件",callback:function(a,i){var n=i.$trigger.data().index,t=e.data[n];layer.confirm("确定要删除"+t.fileName+"?",(function(e){l.reqAsync({url:"/file/deleteFile",method:"DELETE",data:{id:t.id},done:function(e){200===e.code&&(layer.msg("操作成功"),o.reload("fmTest"))}})}))}}}})},page:{limit:19,layout:["count","prev","page","next","limit","refresh","skip"]},where:{}}),i.on("tool(file_list_table)",(function(e){var a=e.data;console.log(a),"del"===e.event&&layer.confirm("确定要删除？",(function(e){l.reqAsync({url:"/file/deleteFile",method:"DELETE",data:{id:a.id},done:function(a){200===a.code&&(i.reload("file_list_table"),layer.close(e))}})})),e.event})),n.on("submit(LAY-user-back-search)",(function(e){var a=e.field,l={};a.documentNumber?l.search_AND_LIKE_documentNumber=a.documentNumber:l=null,i.reload("file_list_table",{where:l})})),e("fileList",{})}));