layui.define(["table","admin","form","laytpl"],(function(e){var t=layui.$,a=layui.admin,l=layui.table,o=layui.view,i=layui.form,n=layui.laytpl;function r(e){var t=layer.load(1);return a.reqAsync({url:"/vehicle/information/updateVehicleStatus",method:"POST",data:{id:e.id,operation:e.operation,remarks:e.remarks}}).then((function(e){return layer.close(t),e}))}l.render({elem:"#car_list_table",cols:[[{field:"index",title:"序号"},{field:"model",title:"车辆型号"},{field:"plateNumber",title:"车牌号"},{field:"company",title:"单位"},{field:"status",title:"状态",templet:"#buttonTpl"},{field:"createTime",title:"创建时间",sort:!0},{title:"操作",width:180,align:"center",fixed:"right",toolbar:"#car_list_table_edit"}]],url:"/vehicle/information/findAll",headers:{Authorization:layui.data("layuiAdmin").Authorization},page:!0,limit:30,response:{statusCode:200},parseData:function(e){return{code:e.code,msg:e.msg,count:e.data.totalElements,data:window.utils.addPermission(e.data.content).map((function(e,t){return e.createTime=window.utils.format(null,e.createTime),e.index=t+1,e.status=e.status,e.canRecord=["NotLeaving","NotReturned"].includes(e.status),e.statusText={NotInUse:"未使用",Approval:"审批中",NotLeaving:"未离场",NotReturned:"未归还",withdrawalOfApproval:"已撤回",rejectedApproval:"已拒绝"}[e.status]||"未使用",e}))}},done:function(e,t,l){window.utils.dealCode(e.code,a),console.log(e),console.log(t),console.log(l)},text:{none:"暂无数据"}}),i.on("submit(carList_search_form)",(function(e){var t=e.field,a={};t.plateNumber?a.search_AND_LIKE_plateNumber=t.plateNumber:a=null,console.log(a),l.reload("car_list_table",{where:a})})),l.on("tool(car_list_table)",(function(e){var d=e.data;({del:function(){console.log(d),d.status||d.status&&"NotInUse"!==d.status?layer.msg("审批/使用中的车辆无法删除"):layer.confirm("确定删除此车辆？",(function(t){var l=layer.load(1);a.req({url:"/vehicle/information/delVehicleRecord",method:"POST",data:{id:d.id},done:function(a){layer.close(l),200===a.code?(layer.msg("操作成功"),e.del(),layui.table.reload("car_list_table")):layer.msg("操作失败"),layer.close(t)}})}))},edit:function(){a.popup({title:"编辑车辆",area:["420px","430px"],id:"LAY-popup-useradmin-add",success:function(e,t){o(this.id).render("car/carForm",d).done((function(){i.render(null,"layuiadmin-form-admin"),i.on("submit(LAY-user-back-submit)",(function(e){var l=layer.load(1),o=e.field;o.id=d.id,console.log(o),a.req({url:"/vehicle/information/update",method:"post",data:o,done:function(e){console.log(e),layer.close(l),200===e.code&&(layui.table.reload("car_list_table"),layer.close(t))}})}))}))}})},log:function(){n(t("#car_list_log_open").html()).render(d,(function(e){layer.open({title:"记录车辆操作",content:e,btn:["车辆返场"],yes:function(e){"NotLeaving"===d.status?r({id:d.id,operation:"VehicleDeparture",remarks:t("#car_text_opener").val()}).then((function(t){200===t.code?layer.msg("操作成功"):layer.msg("操作失败"),layer.close(e),l.reload("car_list_table",{where:null})})):layer.confirm("确定记录返场？",(function(e){r({id:d.id,operation:"ReturnVehicle",remarks:t("#car_text_opener").val()}).then((function(t){200===t.code?layer.msg("操作成功"):layer.msg("操作失败"),layer.close(e),l.reload("car_list_table",{where:null}),layer.close(e)}))}))},btn2:function(e){r({id:d.id,operation:"VehicleDeparture",remarks:t("#car_text_opener").val()}).then((function(t){200===t.code?layer.msg("操作成功"):layer.msg("操作失败"),layer.close(e),l.reload("car_list_table",{where:null})}))}})}))}})[e.event]()}));var d={delCar:function(){},addCar:function(){a.popup({title:"添加车辆",area:["420px","430px"],id:"LAY-popup-useradmin-add",success:function(e,t){o(this.id).render("car/carForm").done((function(){i.render(null,"layuiadmin-form-admin"),i.on("submit(LAY-user-back-submit)",(function(e){var l=layer.load(1),o=e.field;console.log(o),a.req({url:"/vehicle/information/save",method:"post",data:o,done:function(e){console.log(e),layer.close(l),200===e.code&&(layui.table.reload("car_list_table"),layer.close(t))}})}))}))}})}};t(".layui-btn.layuiadmin-btn-admin").on("click",(function(){var e=t(this).data("type");d[e]&&d[e].call(this)})),e("car",{})}));