/*! For license information please see set.js.LICENSE.txt */
layui.define(["form","upload","view"],(function(e){var s=layui.$,a=layui.layer,t=(layui.laytpl,layui.setter,layui.view),i=layui.admin,n=layui.form,r=layui.upload;s("body");n.render(),n.verify({nickname:function(e,s){return new RegExp("^[a-zA-Z0-9_一-龥\\s·]+$").test(e)?/(^\_)|(\__)|(\_+$)/.test(e)?"用户名首尾不能出现下划线'_'":/^\d+\d+\d$/.test(e)?"用户名不能全为数字":void 0:"用户名不能有特殊字符"},pass:[/^[\S]{6,12}$/,"密码必须6到12位，且不能出现空格"],repass:function(e){if(e!==s("#LAY_password").val())return"两次密码输入不一致"}}),n.on("submit(set_website)",(function(e){return a.msg(JSON.stringify(e.field)),!1})),n.on("submit(set_system_email)",(function(e){return a.msg(JSON.stringify(e.field)),!1})),n.on("submit(setmyinfo)",(function(e){return a.msg(JSON.stringify(e.field)),!1}));var o=s("#LAY_avatarSrc");r.render({url:"/api/upload/",elem:"#LAY_avatarUpload",done:function(e){0==e.status?o.val(e.url):a.msg(e.msg,{icon:5})}}),i.events.avartatPreview=function(e){var s=o.val();a.photos({photos:{title:"查看头像",data:[{src:s}]},shade:.01,closeBtn:1,anim:5})},n.on("submit(setmypass)",(function(e){var s=layui.data("store").userInfo;return i.req({url:"/sys/user/updatePassword",data:{username:s.username,newPassword:e.field.newPassword,oldPassword:e.field.oldPassword},method:"POST",success:function(e){console.log(e),200===e.code?(a.msg("修改成功"),t.exit()):a.msg(e.data)}}),!1})),e("set",{})}));