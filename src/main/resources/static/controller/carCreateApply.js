layui.define(["table","admin","form","laytpl"],(function(e){var n=layui.$,a=layui.admin,t=layui.table,o=layui.view,i=layui.form,l=layui.laytpl,r=[];function u(e){l(n("#apply_list").html()).render(e.concat([{}]),(function(e){n("#apply_list_view").html(e),n(".applyList_del").on("click",(function(e){var a=Number(n(this).data("type"));layer.confirm("真的删除么",(function(e){r.splice(a,1),u(r),layer.close(e)}))})),n(".applyList_edit").on("click",(function(e){var l=Number(n(this).data("type"));a.popup({title:"选择审批人",area:["600px","430px"],id:"car_apply",success:function(e,n){o(this.id).render("approve/selectPeople",{}).done((function(){i.render(null,"createApply_form"),c(r.map((function(e){return e.name}))),t.on("tool(LAY-user-back-manage)",(function(e){var a=e.data;console.log(a),"edit"===e.event&&(r[l]={name:a.username},u(r),layer.close(n))}))}))}})})),n(".addPeople").on("click",(function(e){a.popup({title:"选择审批人",area:["600px","430px"],id:"car_apply",success:function(e,n){o(this.id).render("approve/selectPeople",{}).done((function(){i.render(null,"createApply_form"),c(r.map((function(e){return e.name}))),t.on("tool(LAY-user-back-manage)",(function(e){var a=e.data;console.log(a),"edit"===e.event&&(r.push({name:a.username}),u(r),layer.close(n))}))}))}})}))}))}function c(e){t.render({elem:"#LAY-user-back-manage",cols:[[{field:"username",title:"登录名"},{field:"name",title:"真实姓名"},{title:"操作",align:"center",fixed:"right",toolbar:"#table-useradmin-admin"}]],url:"/sys/user/findAll",headers:{Authorization:layui.data("layuiAdmin").Authorization},page:!0,limit:30,response:{statusCode:200},parseData:function(n){return{code:n.code,msg:n.msg,count:n.data.totalElements,data:n.data.content.filter((function(n){return console.log(e,n.username),"Y"!==n.isDelete&&!e.includes(n.username)}))}},done:function(e,n,a){console.log(e),console.log(n),console.log(a)},text:{none:"暂无数据"}}),i.on("submit(LAY-user-back-search)",(function(e){var n=e.field.name,a={};n&&(a={search_AND_EQ_username:n}),t.reload("LAY-user-back-manage",{where:a})}))}i.on("submit(apply-submit)",(function(e){var n=e.field,t={};t.vehicleId=layui.router().search.id,t.destination=n.destination,t.title=n.title,t.number=n.number,t.type="vehicle",t.username=r.map((function(e){return e.name})).join(","),a.req({url:"/approval/submitForApproval",data:t,method:"POST",done:function(e){200===e.code?(layer.msg("操作成功"),window.history.back()):layer.msg("操作失败")}}),console.log(t)})),u(r),layui.router().search.applyId&&a.reqAsync({url:"/approval/findOneById",method:"GET",data:{id:router.search.id}}).then((function(e){})),e("carCreateApply",{})}));