layui.define(["table","admin","form","laytpl"],(function(e){var a=layui.$,n=layui.admin,t=layui.table,l=layui.view,o=layui.form,i=layui.laytpl,r=[];function u(e){i(a("#apply_list").html()).render(e.concat([{}]),(function(e){a("#apply_list_view").html(e),a(".applyList_del").on("click",(function(e){var n=Number(a(this).data("type"));layer.confirm("真的删除么",(function(e){r.splice(n,1),u(r),layer.close(e)}))})),a(".applyList_edit").on("click",(function(e){var i=Number(a(this).data("type"));n.popup({title:"选择审批人",area:["600px","430px"],id:"car_apply",success:function(e,a){l(this.id).render("approve/selectPeople",{}).done((function(){o.render(null,"car_createApply_form"),c(r.map((function(e){return e.name}))),t.on("tool(LAY-user-back-manage)",(function(e){var n=e.data;console.log(n),"edit"===e.event&&(r[i]={name:n.username},u(r),layer.close(a))}))}))}})})),a(".addPeople").on("click",(function(e){n.popup({title:"选择审批人",area:["600px","430px"],id:"car_apply",success:function(e,a){l(this.id).render("approve/selectPeople",{}).done((function(){o.render(null,"car_createApply_form"),c(r.map((function(e){return e.name}))),t.on("tool(LAY-user-back-manage)",(function(e){var n=e.data;console.log(n),"edit"===e.event&&(r.push({name:n.username}),u(r),layer.close(a))}))}))}})}))}))}function c(e){t.render({elem:"#LAY-user-back-manage",cols:[[{field:"username",title:"登录名"},{field:"name",title:"真实姓名"},{title:"操作",align:"center",fixed:"right",toolbar:"#table-useradmin-admin"}]],url:"/sys/user/findAll",headers:{Authorization:layui.data("layuiAdmin").Authorization},page:!0,limit:30,response:{statusCode:200},parseData:function(a){return{code:a.code,msg:a.msg,count:a.data.totalElements,data:a.data.content.filter((function(a){return console.log(e,a.username),"Y"!==a.isDelete&&!e.includes(a.username)}))}},done:function(e,a,t){window.utils.dealCode(e.code,n),console.log(e),console.log(a),console.log(t)},text:{none:"暂无数据"}}),o.on("submit(LAY-user-back-search)",(function(e){var a=e.field.name,n={};n=a?{search_AND_LIKE_username:a}:null,t.reload("LAY-user-back-manage",{where:n})}))}if(o.on("submit(apply-submit)",(function(e){var a=e.field,t={};t.vehicleId=layui.router().search.id,t.destination=a.destination,t.title=a.title,t.number=a.number,t.type="vehicle",t.username=r.map((function(e){return e.name})).join(","),t.extra=JSON.stringify(a);var l=layer.load(1);n.req({url:"/approval/submitForApproval",data:t,method:"POST",done:function(e){layer.close(l),200===e.code?(layer.msg("操作成功"),setTimeout((function(){window.history.back()}),1e3)):layer.msg("操作失败")}}),console.log(t)})),u(r),layui.router().search.applyId){var s=layer.load(1);n.reqAsync({url:"/approval/findOneById",method:"GET",data:{id:router.search.id}}).then((function(e){layer.close(s)}))}e("carCreateApply",{})}));