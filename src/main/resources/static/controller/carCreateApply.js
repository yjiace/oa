layui.define(["table","admin","form","laytpl"],(function(e){var a=layui.$,n=layui.admin,t=layui.table,l=layui.view,i=layui.form,o=layui.laytpl,r=[];function c(e){o(a("#apply_list").html()).render(e.concat([{}]),(function(e){a("#apply_list_view").html(e),a(".applyList_del").on("click",(function(e){var n=Number(a(this).data("type"));layer.confirm("真的删除么",(function(e){r.splice(n,1),c(r),layer.close(e)}))})),a(".applyList_edit").on("click",(function(e){var o=Number(a(this).data("type"));n.popup({title:"选择审批人",area:["600px","430px"],id:"car_apply",success:function(e,a){l(this.id).render("approve/selectPeople",{}).done((function(){i.render(null,"createApply_form"),t.on("tool(LAY-user-back-manage)",(function(e){var n=e.data;console.log(n),"edit"===e.event&&(r[o]={name:n.username},c(r),layer.close(a))}))}))}})})),a(".addPeople").on("click",(function(e){n.popup({title:"选择审批人",area:["600px","430px"],id:"car_apply",success:function(e,a){l(this.id).render("approve/selectPeople",{}).done((function(){i.render(null,"createApply_form"),t.on("tool(LAY-user-back-manage)",(function(e){var n=e.data;console.log(n),"edit"===e.event&&(r.push({name:n.username}),c(r),layer.close(a))}))}))}})}))}))}i.on("submit(apply-submit)",(function(e){var a=e.field,t={};t.vehicleId=layui.router().search.id,t.destination=a.destination,t.title=a.title,t.number=a.number,t.type="vehicle",t.username=r.map((function(e){return e.name})).join(","),n.req({url:"/approval/submitForApproval",data:t,method:"POST",done:function(e){200===e.code?(layer.msg("操作成功"),window.history.back()):layer.msg("操作失败")}}),console.log(t)})),c(r),layui.router().search.applyId&&n.reqAsync({url:"/approval/findOneById",method:"GET",data:{id:router.search.id}}).then((function(e){})),e("carCreateApply",{})}));