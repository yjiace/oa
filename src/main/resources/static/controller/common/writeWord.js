layui.define(["table","admin","jquery","form"],(function(t){var e=layui.$,a=(layui.admin,layui.view),i=layui.form;function n(t){this.options=t,this.saveData=e.extend(!0,{},this.defaultData),this.canEdit=t.canEdit,this.canApprove=t.canApprove,this.template=t.template||"template1",this.data=t.data,this.success=t.success,this.renderWord(this.options),this.saveData[this.template]=this.data}n.prototype={renderWord:function(t){var a=t.data,i=(t.canEdit,t.canApprove);t.template,t.success;return console.log(a),this.data=a||e.extend(this.defaultData.template1,{canApprove:i}),this.setData(),this.renderWriteWord(),e("#writePrint").on("click",(function(){e("#templete_1").jqprint({})})),a},renderWriteWord:function(){var t=this,e=this.template;a("writeWord").render("approve/"+this.wordHtml[e],this.data).done((function(){t.bindHandle.call(t)}))},toggleTemplate:function(t){this.template=t,this.data=e.extend(this.defaultData[this.template],{template:t}),this.renderWriteWord(),this.setData()},bindHandle:function(){var t=this,a=297*e("#writeWord").width()/210;"template1"===this.template&&(e("#templete_1 .content").height(.8*a+1),e("#templete_1 .content").children().height(.8*a)),this.canApprove&&e("#templete_1 .right .edit").on("click",(function(a){var i=e(this),n=i.text(),r=i.data("index");layer.prompt({formType:2,value:n,title:"请输入文本",area:["300px","200px"]},(function(e,a,n){i.text(e),t.setData(key,e),t.data.approve[r].approveContent=e,t.setData("approve",t.data.approve),layer.close(a)}))})),this.canEdit&&(e("#templete_1 .edit").on("click",(function(a){var i=e(this),n=i.text(),r=i.data("key");layer.prompt({formType:2,value:n,title:"请输入文本",area:["300px","200px"]},(function(e,a,n){i.text(e),t.setData(r,e),layer.close(a)}))})),e("#templete_1 .bottom span").on("click",(function(a){var i=e(this).find("i"),n=i.text(),r=i.data("key");layer.prompt({formType:2,value:n,title:"请输入文本",area:["300px","200px"]},(function(e,a,n){i.text(e),t.setData(r,e),layer.close(a)}))})))},defaultData:{template1:{jimi:"内部机密文件",title:"武警第一机动总队机动第六支队参谋部呈件",fuTitle:"参管呈〔2020〕          号",chengyue:"呈阅《XXXXXXXXXXX》",bushou:"部首长",content:"请输入正文",name:"姓名",time:window.utils.format("yyyy年MM月dd日"),kezhang:"",chengbanren:"",dianhua:"",approve:[]},template2:{jimi:"内部机密文件",title:"XXX作部XXX科呈批文件专用单",fuTitle:"〔2021〕1号",chengyue:"呈阅《XXXXXXXXXXX》",laiwendanwei:"",shouwenriqi:"",wenjianneirong:"",shouzhangpishi:"",chengpijianyi:"",time:window.utils.format("yyyy年MM月dd日"),kezhang:"",chengbanren:"",dianhua:"",approve:[]}},wordHtml:{template1:"writeWord1",template2:"writeWord2"},setData:function(t,e){t&&(this.data[t]=e),this.saveData[this.template]=this.data,console.log(this.data)},bindSelect:function(){var t=this;i.on("select(templateSelect)",(function(e){t.toggleTemplate(e.value)}))}},t("writeWord",{render:function(t){return new n(t)},WriteWord:n})}));