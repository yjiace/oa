layui.define(["table","admin","form"],(function(e){var l=layui.$,a=layui.admin,t=layui.table,o=layui.view;form=layui.form;var i=layer.load(1);function r(e,l){l&&a.req({url:"/approval/vehicle/addComment",method:"POST",data:{id:e,message:l}})}t.render({elem:"#apply_list_table",cols:[[{type:"checkbox",fixed:"left"},{field:"index",title:"序号"},{field:"vehicleNumber",title:"车牌号"},{field:"model",title:"车型"},{field:"transportUnit",title:"单位"},{field:"initiatorUsername",title:"发起人",width:140},{field:"status",title:"审批进度",templet:"#apply_status",width:100},{field:"createTime",title:"发起时间",sort:!0},{title:"操作",minWidth:100,align:"center",fixed:"right",toolbar:"#aplpy_list_table_edit"}]],url:"/approval/vehicle/findAllApprovalRequired",where:{},headers:{Authorization:layui.data("layuiAdmin").Authorization},page:!0,limit:30,response:{statusCode:200},parseData:function(e){return{code:e.code,msg:e.msg,count:e.data.totalElements,data:e.data.content.map((function(e,l){return e.index=l+1,e.createTime=window.utils.format(null,e.createTime),e}))}},done:function(e,l,t){layer.close(i),window.utils.dealCode(e.code,a),console.log(e),console.log(l),console.log(t)},text:{none:"暂无需要审批的车辆"}}),form.on("submit(LAY-user-back-search)",(function(e){var l=e.field,a={};l.vehicleNumber?a.search_AND_LIKE_vehicleNumber=l.vehicleNumber:a=null,console.log(a),t.reload("apply_list_table",{where:a})})),t.on("tool(apply_list_table)",(function(e){var i=e.data;console.log(i),"view"===e.event&&(location.hash="/car/carViewApply/id="+i.id),"edit"===e.event&&a.popup({title:"审批",area:["400px","330px"],btn:["审批通过","审批拒绝"],id:"car_apply",yes:function(e){var o=layer.load(1);r(i.id,l("#comment_val").val()),a.req({url:"/approval/vehicle/operationApproval",method:"POST",data:{id:i.id,operation:"Completed"},done:function(l){layer.close(o),200===l.code?(layer.msg("审批通过"),layer.close(e),t.reload("apply_list_table")):layer.msg("操作失败")}})},btn2:function(e){var o=layer.load(1);r(i.id,l("#comment_val").val()),a.req({url:"/approval/vehicle/operationApproval",method:"POST",data:{id:i.id,operation:"Rejected"},done:function(l){layer.close(o),200===l.code?(layer.msg("审批已拒绝"),layer.close(e),t.reload("apply_list_table")):layer.msg("操作失败")}})},success:function(e,l){o(this.id).render("approve/approveForm",{}).done((function(){form.render(null,"createApply_form"),t.on("tool(LAY-user-back-manage)",(function(e){var a=e.data;console.log(a),"edit"===e.event&&(applyList.push({name:a.username}),renderApply(applyList),layer.close(l))}))}))}})})),e("carNeedApprove",{})}));