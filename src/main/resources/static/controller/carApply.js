layui.define(["table","admin","form","laytpl","laydate","util"],(function(e){var a=layui.$,n=layui.admin,t=layui.table,i=layui.view,l=layui.form,o=layui.laytpl,r=layui.laydate,c=layui.util,u=[];function s(e){o(a("#apply_list").html()).render(e.concat([{}]),(function(e){a("#apply_list_view").html(e),a(".applyList_del").on("click",(function(e){var n=Number(a(this).data("type"));layer.confirm("真的删除么",(function(e){u.splice(n,1),s(u),layer.close(e)}))})),a(".applyList_edit").on("click",(function(e){var o=Number(a(this).data("type"));n.popup({title:"选择审批人",area:["600px","430px"],id:"car_apply",success:function(e,a){i(this.id).render("approve/selectPeople",{}).done((function(){l.render(null,"car_createApply_form"),m(u.map((function(e){return e.name}))),t.on("tool(LAY-user-back-manage)",(function(e){var n=e.data;console.log(n),"edit"===e.event&&(u[o]={name:n.username},s(u),layer.close(a))}))}))}})})),a(".addPeople").on("click",(function(e){n.popup({title:"选择审批人",area:["600px","430px"],id:"car_apply",success:function(e,a){i(this.id).render("approve/selectPeople",{}).done((function(){l.render(null,"car_createApply_form"),m(u.map((function(e){return e.name}))),t.on("tool(LAY-user-back-manage)",(function(e){var n=e.data;console.log(n),"edit"===e.event&&(u.push({name:n.username}),s(u),layer.close(a))}))}))}})}))}))}function m(e){var a=layer.load(1);t.render({elem:"#LAY-user-back-manage",cols:[[{field:"username",title:"登录名"},{field:"name",title:"真实姓名"},{title:"操作",align:"center",fixed:"right",toolbar:"#table-useradmin-admin"}]],url:"/sys/user/findAll",headers:{Authorization:layui.data("layuiAdmin").Authorization},page:!0,limit:30,response:{statusCode:200},parseData:function(a){return{code:a.code,msg:a.msg,count:a.data.totalElements,data:a.data.content.filter((function(a){return console.log(e,a.username),"Y"!==a.isDelete&&!e.includes(a.username)}))}},done:function(e,t,i){layer.close(a),window.utils.dealCode(e.code,n),console.log(e),console.log(t),console.log(i)},text:{none:"暂无数据"}}),l.on("submit(LAY-user-back-search)",(function(e){var a=e.field.name,n={};n=a?{search_AND_LIKE_username:a}:null,t.reload("LAY-user-back-manage",{where:n})}))}s([]);var d={applicationTime:c.toDateString(new Date),returnTime:c.toDateString(new Date),playingTime:c.toDateString(new Date)};r.render({elem:"#application_time",format:"yyyy年MM月dd日",value:new Date,change:function(e,a){d.applicationTime=c.toDateString(a)}}),r.render({elem:"#return_time",format:"MM月dd日 HH时mm分",type:"datetime",value:new Date,change:function(e,a){d.returnTime=c.toDateString(a)}}),r.render({elem:"#playing_time",format:"MM月dd日 HH时mm分",type:"datetime",value:new Date,change:function(e,a){d.playingTime=c.toDateString(a)}}),a("#apply_button").on("click",(function(){if(a("table .key_wrap").each((function(){var e=[];a(this).children().each((function(){a(this).val()&&e.push(a(this).val())}));var n=e.join("-&"),t=a(this).data("name");"return_time"!==t&&"playing_time"!==t&&(d[window.utils.toHump(t)]=n)})),d.username=u.map((function(e){return e.name})).join(","),console.log(d),d.username)if(d.vehicleNumber){var e=layer.load(1);n.reqAsync({url:"/approval/vehicle/submitForApproval",method:"POST",data:d}).then((function(a){console.log(a),layer.close(e),200===a.code?(layer.msg("提交成功",{icon:1}),setTimeout((function(){location.hash="/car/carApplyList"}),1e3)):layer.msg(a.data,{icon:5})}))}else layer.msg("请填写车牌号",{icon:5});else layer.msg("请选择审批人",{icon:5})})),e("carApply",{})}));