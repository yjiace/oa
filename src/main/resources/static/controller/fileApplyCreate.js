layui.define(["table","admin","form","laytpl","upload"],(function(e){var a=layui.$,n=layui.admin,o=layui.table,l=layui.view,i=layui.form,t=layui.upload,r=layui.laytpl,c=[],u=null,s=layui.router();function p(e){r(a("#apply_list").html()).render(e.concat([{}]),(function(e){a("#apply_list_view").html(e),a(".applyList_del").on("click",(function(e){var n=Number(a(this).data("type"));layer.confirm("真的删除么",(function(e){c.splice(n,1),p(c),layer.close(e)}))})),a(".applyList_edit").on("click",(function(e){var t=Number(a(this).data("type"));n.popup({title:"选择审批人",area:["600px","430px"],id:"car_apply",success:function(e,a){l(this.id).render("approve/selectPeople",{}).done((function(){i.render(null,"createApply_form"),o.on("tool(LAY-user-back-manage)",(function(e){var n=e.data;console.log(n),"edit"===e.event&&(c[t]={name:n.username},p(c),layer.close(a))}))}))}})})),a(".addPeople").on("click",(function(e){n.popup({title:"选择审批人",area:["600px","430px"],id:"car_apply",success:function(e,a){l(this.id).render("approve/selectPeople",{}).done((function(){i.render(null,"createApply_form"),o.on("tool(LAY-user-back-manage)",(function(e){var n=e.data;console.log(n),"edit"===e.event&&(c.push({name:n.username}),p(c),layer.close(a))}))}))}})}))}))}s.search&&s.search.id&&(setTimeout((function(){i.val("createApply_form",{documentNumber:"sss",securityClassification:"ss"}),p([{id:1,name:"杨佳策"},{id:2,name:"赵巍博"}]),a("#reApply").val("重新提审")})),n.reqAsync({url:"/document/approval/findOneById",method:"GET",data:{id:s.search.id}}).then((function(e){200===e.code&&(console.log(e.data),i.val("createApply_form",e.data))}))),p(c);var d={},m=t.render({elem:"#upload_word",url:"/document/approval/submitForApproval",data:d,accept:"file",auto:!1,headers:{Authorization:layui.data("layuiAdmin").Authorization},choose:function(e){console.log(a(".layui-upload-file").get(0)),console.log(e);var n=e.pushFile(),o=Object.keys(n);o.forEach((function(e,a){a!==o.length-1&&delete n[e]})),u=n[o[o.length-1]],a("#upload_word").html('<i class="layui-icon">&#xe655;</i>'+u.name)},done:function(e){200===code&&(layer.msg("成功发起审批"),window.history.back())},error:function(){}});i.on("submit(apply-submit)",(function(e){var a=e.field;s.search&&s.search.id;console.log(u);a.documentNumber,c.map((function(e){return e.name})),a.securityClassification;d.documentNumber=a.documentNumber,d.securityClassification=a.securityClassification,d.username=c.map((function(e){return e.name})),m.upload()})),e("fileApplyCreate",{})}));