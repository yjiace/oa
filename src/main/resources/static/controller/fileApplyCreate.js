layui.define(["table","admin","form","laytpl","upload","tinymce","writeWord"],(function(e){var n=layui.$,a=layui.admin,i=layui.table,o=layui.view,t=layui.form,l=layui.upload,r=layui.writeWord,u=layui.laytpl,c=[],d=null,s=[],p=layui.router();function f(e){u(n("#apply_list").html()).render(e.concat([{}]),(function(e){n("#apply_list_view").html(e),n(".applyList_del").on("click",(function(e){var a=Number(n(this).data("type"));layer.confirm("真的删除么",(function(e){c.splice(a,1),f(c),layer.close(e)}))})),n(".applyList_edit").on("click",(function(e){var l=Number(n(this).data("type"));a.popup({title:"选择审批人",area:["600px","430px"],id:"car_apply",success:function(e,n){o(this.id).render("approve/selectPeople",{}).done((function(){t.render(null,"createApply_form"),g(c.map((function(e){return e.name}))),i.on("tool(LAY-user-back-manage)",(function(e){var a=e.data;console.log(a),"edit"===e.event&&(c[l]={name:a.username,id:a.id},f(c),layer.close(n))}))}))}})})),n(".addPeople").on("click",(function(e){a.popup({title:"选择审批人",area:["600px","430px"],id:"car_apply",success:function(e,n){o(this.id).render("approve/selectPeople",{}).done((function(){t.render(null,"createApply_form"),g(c.map((function(e){return e.name}))),i.on("tool(LAY-user-back-manage)",(function(e){var a=e.data;console.log(a),"edit"===e.event&&(c.push({name:a.username,id:a.id}),f(c),layer.close(n))}))}))}})}))}))}var m=r.render({data:{jimi:"内部机密文件",title:"武警第一机动总队机动第六支队参谋部呈件",fuTitle:"参管呈 [ 2020 ]           号",chengyue:"呈阅《XXXXXXXXXXX》",bushou:"部首长",content:"请输入正文",name:"姓名",time:window.utils.format("yyyy年MM月dd日"),kezhang:"",chengbanren:"",dianhua:"",approve:[]},canApprove:!1,canEdit:!0});m.bindSelect(),setTimeout((function(){h=l.render({elem:"#upload_word",url:"/file/uploadFile",data:y,multiple:!0,accept:"file",auto:!1,headers:{Authorization:layui.data("layuiAdmin").Authorization},choose:function(e){var a=e.pushFile();(d||[]).forEach((function(e,n){delete a[e]})),d=Object.keys(a),function(e){console.log(e),n(".fileList_div").show();var a=e.reduce((function(e,n){return e+'<a class="file_a" style="display:block;line-height:1" id="filedList"><i class="layui-icon"></i>'+n.name+"</a>"}),"");n(".fileList_div").html(a)}(Object.values(a))},before:function(e){loadingIndex=layer.load(1)},allDone:function(e){if(console.log(e),e.total!==s.length)return layer.close(loadingIndex),void layer.msg("文件未上传成功，请重新尝试",{icon:5});a.req({url:"/approval/document/submitForApproval",data:n.extend(y,{fileIds:s.join(",")}),method:"POST",done:function(e){s=[],200===e.code?(layer.close(loadingIndex),layer.msg("成功发起审批"),setTimeout((function(){window.location.reload()}),1e3)):layer.msg("操作失败")}})},done:function(e){200===e.code&&s.push(e.data.id)},error:function(){}})}),0),f(c);var y={},h=null;function g(e){var n=layer.load(1);i.render({elem:"#LAY-user-back-manage",cols:[[{field:"username",title:"登录名"},{field:"name",title:"真实姓名"},{title:"操作",align:"center",fixed:"right",toolbar:"#table-useradmin-admin"}]],url:"/sys/user/findAll",headers:{Authorization:layui.data("layuiAdmin").Authorization},page:!0,limit:30,response:{statusCode:200},parseData:function(n){return{code:n.code,msg:n.msg,count:n.data.totalElements,data:n.data.content.filter((function(n){return console.log(e,n.username),"Y"!==n.isDelete&&!e.includes(n.username)}))}},done:function(e,i,o){layer.close(n),window.utils.dealCode(e.code,a),console.log(e),console.log(i),console.log(o)},text:{none:"暂无数据"}}),t.on("submit(LAY-user-back-search)",(function(e){var n=e.field.name,a={};a=n?{search_AND_LIKE_username:n}:null,i.reload("LAY-user-back-manage",{where:a})}))}t.on("submit(apply-submit)",(function(e){var n=e.field;p.search&&p.search.id;console.log(d),y.securityClassification=n.securityClassification,y.title=n.title,y.organizer=n.organizer,y.extra=JSON.stringify(m.data),y.username=c.map((function(e){return e.name})).join(","),d&&h.upload()})),t.verify({onlyone:function(e,n){var i="";return a.req({url:"/approval/document/checkNumber",async:!1,data:{number:e},done:function(e){i=!(200===e.code&&!e.data)&&"审批编号不能重复！"},error:function(){i="审批编号不能重复！"}}),i}}),e("fileApplyCreate",{})}));