layui.define(["table","admin","form","laydate"],(function(e){var t=layui.$,a=layui.admin,l=layui.table,i=(layui.view,layui.form);layui.laydate.render({elem:"#timeselect",type:"datetime",range:"~"});var r=layer.load(1);l.render({elem:"#apply_list_table",cols:[[{type:"checkbox",fixed:"left"},{field:"index",title:"序号"},{field:"vehicleNumber",title:"车牌号"},{field:"model",title:"车型"},{field:"transportUnit",title:"单位"},{field:"initiatorUsername",title:"发起人",width:140},{field:"status",title:"审批进度",templet:"#apply_status",width:100},{field:"createTime",title:"发起时间",sort:!0},{title:"操作",width:200,align:"center",fixed:"right",toolbar:"#aplpy_list_table_edit"}]],url:"/approval/vehicle/findStatistics",where:{},headers:{Authorization:layui.data("layuiAdmin").Authorization},page:!0,limit:30,response:{statusCode:200},parseData:function(e){return{code:e.code,msg:e.msg,count:e.data.totalElements,data:e.data.content.map((function(e,t){return e.index=t+1,e.createTime=window.utils.format(null,e.createTime),e}))}},done:function(e,t,l){layer.close(r),window.utils.dealCode(e.code,a),console.log(e),console.log(t),console.log(l)},text:{none:"暂无数据"}}),i.on("submit(LAY-user-back-search)",(function(e){var t=e.field,a={};return t.vehicleNumber?a.search_AND_LIKE_vehicleNumber=t.vehicleNumber:a.search_AND_LIKE_vehicleNumber=null,t.createTime?a.search_AND_BETWEEN_createTime=t.createTime:a.search_AND_BETWEEN_createTime=null,console.log(a),l.reload("apply_list_table",{where:a}),!1})),i.on("submit(LAY-user-back-reset)",(function(e){l.reload("apply_list_table",{where:null})})),i.on("submit(LAY-user-back-download)",(function(e){return Object.values(e.field).filter(Boolean).length<1?(layer.msg("请输入查询条件"),!1):(a.reqAsync({url:"/approval/vehicle/getToken",method:"GET",data:{search_AND_LIKE_vehicleNumber:e.field.vehicleNumber,search_AND_BETWEEN_createTime:e.field.createTime}}).then((function(e){200===e.code?window.axios.request({url:"/approval/vehicle/carStatistics",method:"get",headers:{Authorization:layui.data("layuiAdmin").Authorization},responseType:"arraybuffer",params:{token:e.data}}).then((function(e){var t="每日用车统计.xlsx",a=t.split("."),l=new Blob([e.data],{type:window.utils.mime[a[1]]}),i=URL.createObjectURL(l),r=document.createElement("a");r.href=i,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href)})):layer.msg("获取凭证失败",{icon:5})})),!1)})),l.on("tool(apply_list_table)",(function(e){var t=e.data;"view"===e.event&&(location.hash="/car/carViewApply/id="+t.id),"del"===e.event&&layer.confirm("确定要撤回？",(function(e){var i=layer.load(1);a.reqAsync({url:"/approval/withdrawalOfApproval",method:"POST",data:{id:t.id},done:function(t){layer.close(i),t.code&&(l.reload("apply_list_table"),layer.close(e))}})}))}));var o={apply:function(){location.hash="/approve/carCreateApply"}};t("#apply_btn").on("click",(function(){var e=t(this).data("type");o[e]&&o[e].call(this)})),e("carlog",{})}));