!function(n){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),e=function(){},r=function(n){return function(){return n}},o=function(n){return n};function u(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var o=t.concat(e);return n.apply(null,o)}}var i=function(n){return function(t){return!n(t)}},c=r(!1),a=r(!0),l=function(){return f},f=function(){var n=function(n){return n.isNone()},t=function(n){return n()},o=function(n){return n};return{fold:function(n,t){return n()},is:c,isSome:c,isNone:a,getOr:o,getOrThunk:t,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:r(null),getOrUndefined:r(void 0),or:o,orThunk:t,map:l,each:e,bind:l,exists:c,forall:a,filter:l,equals:n,equals_:n,toArray:function(){return[]},toString:r("none()")}}(),s=function(n){var t=r(n),e=function(){return u},o=function(t){return t(n)},u={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:a,isNone:c,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:e,orThunk:e,map:function(t){return s(t(n))},each:function(t){t(n)},bind:o,exists:o,forall:o,filter:function(t){return t(n)?u:f},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(c,(function(t){return e(n,t)}))}};return u},d={some:s,none:l,from:function(n){return null==n?f:s(n)}},m=function(n){return function(t){return r=typeof(e=t),(null===e?"null":"object"===r&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"===r&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":r)===n;var e,r}},g=function(n){return function(t){return typeof t===n}},p=m("string"),h=m("object"),v=m("array"),b=g("boolean"),w=function(n){return!function(n){return null==n}(n)},y=g("function"),C=g("number"),x=Array.prototype.slice,S=Array.prototype.indexOf,T=Array.prototype.push,R=function(n,t){return e=n,r=t,S.call(e,r)>-1;var e,r},O=function(n,t){for(var e=0,r=n.length;e<r;e++){if(t(n[e],e))return!0}return!1},D=function(n,t){for(var e=[],r=0;r<n;r++)e.push(t(r));return e},A=function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var u=n[o];r[o]=t(u,o)}return r},B=function(n,t){for(var e=0,r=n.length;e<r;e++){t(n[e],e)}},I=function(n,t){for(var e=[],r=0,o=n.length;r<o;r++){var u=n[r];t(u,r)&&e.push(u)}return e},P=function(n,t,e){return function(n,t){for(var e=n.length-1;e>=0;e--)t(n[e],e)}(n,(function(n){e=t(e,n)})),e},k=function(n,t,e){return B(n,(function(n){e=t(e,n)})),e},E=function(n,t){return function(n,t,e){for(var r=0,o=n.length;r<o;r++){var u=n[r];if(t(u,r))return d.some(u);if(e(u,r))break}return d.none()}(n,t,c)},M=function(n,t){for(var e=0,r=n.length;e<r;e++){if(t(n[e],e))return d.some(e)}return d.none()},N=function(n){for(var t=[],e=0,r=n.length;e<r;++e){if(!v(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);T.apply(t,n[e])}return t},_=function(n,t){return N(A(n,t))},W=function(n,t){for(var e=0,r=n.length;e<r;++e){if(!0!==t(n[e],e))return!1}return!0},j=function(n){return 0===n.length?d.none():d.some(n[n.length-1])},z=function(n,t){for(var e=0;e<n.length;e++){var r=t(n[e],e);if(r.isSome())return r}return d.none()},F=Object.keys,L=Object.hasOwnProperty,H=function(n,t){for(var e=F(n),r=0,o=e.length;r<o;r++){var u=e[r];t(n[u],u)}},q=function(n,t){return V(n,(function(n,e){return{k:e,v:t(n,e)}}))},V=function(n,t){var e={};return H(n,(function(n,r){var o=t(n,r);e[o.k]=o.v})),e},U=function(n,t){var r={};return function(n,t,e,r){H(n,(function(n,o){(t(n,o)?e:r)(n,o)}))}(n,t,function(n){return function(t,e){n[e]=t}}(r),e),r},K=function(n,t){return $(n,t)?d.from(n[t]):d.none()},$=function(n,t){return L.call(n,t)},X=(void 0!==n.window?n.window:Function("return this;")(),function(n){return n.dom().nodeName.toLowerCase()}),G=function(n){return n.dom().nodeType},Y=function(n){return function(t){return G(t)===n}},J=function(n){return 8===G(n)||"#comment"===X(n)},Q=Y(1),Z=Y(3),nn=Y(9),tn=Y(11),en=function(t,e,r){if(!(p(r)||b(r)||C(r)))throw n.console.error("Invalid call to Attr.set. Key ",e,":: Value ",r,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,r+"")},rn=function(n,t,e){en(n.dom(),t,e)},on=function(n,t){var e=n.dom();H(t,(function(n,t){en(e,t,n)}))},un=function(n,t){var e=n.dom().getAttribute(t);return null===e?void 0:e},cn=function(n,t){return d.from(un(n,t))},an=function(n,t){var e=n.dom();return!(!e||!e.hasAttribute)&&e.hasAttribute(t)},ln=function(n,t){n.dom().removeAttribute(t)},fn=function(n){return k(n.dom().attributes,(function(n,t){return n[t.name]=t.value,n}),{})},sn=function(n,t,e){return""===t||n.length>=t.length&&n.substr(e,e+t.length)===t},dn=function(n,t){return-1!==n.indexOf(t)},mn=function(n,t){return sn(n,t,n.length-t.length)},gn=function(n){return function(t){return t.replace(n,"")}}(/^\s+|\s+$/g),pn=function(n){return n.length>0},hn=function(n){return void 0!==n.style&&y(n.style.getPropertyValue)},vn=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:r(n)}},bn={fromHtml:function(t,e){var r=(e||n.document).createElement("div");if(r.innerHTML=t,!r.hasChildNodes()||r.childNodes.length>1)throw n.console.error("HTML does not have a single root node",t),new Error("HTML must have a single root node");return vn(r.childNodes[0])},fromTag:function(t,e){var r=(e||n.document).createElement(t);return vn(r)},fromText:function(t,e){var r=(e||n.document).createTextNode(t);return vn(r)},fromDom:vn,fromPoint:function(n,t,e){var r=n.dom();return d.from(r.elementFromPoint(t,e)).map(vn)}},wn=function(){return(wn=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)},yn=function(n){var t,e=!1;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return e||(e=!0,t=n.apply(null,r)),t}},Cn=function(){return xn(0,0)},xn=function(n,t){return{major:n,minor:t}},Sn={nu:xn,detect:function(n,t){var e=String(t).toLowerCase();return 0===n.length?Cn():function(n,t){var e=function(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(r.test(t))return r}}(n,t);if(!e)return{major:0,minor:0};var r=function(n){return Number(t.replace(e,"$"+n))};return xn(r(1),r(2))}(n,e)},unknown:Cn},Tn="Edge",Rn="Chrome",On="Opera",Dn="Firefox",An="Safari",Bn=function(n){var t=n.current,e=n.version,r=function(n){return function(){return t===n}};return{current:t,version:e,isEdge:r(Tn),isChrome:r(Rn),isIE:r("IE"),isOpera:r(On),isFirefox:r(Dn),isSafari:r(An)}},In={unknown:function(){return Bn({current:void 0,version:Sn.unknown()})},nu:Bn,edge:r(Tn),chrome:r(Rn),ie:r("IE"),opera:r(On),firefox:r(Dn),safari:r(An)},Pn="Windows",kn="Android",En="Linux",Mn="Solaris",Nn="FreeBSD",_n="ChromeOS",Wn=function(n){var t=n.current,e=n.version,r=function(n){return function(){return t===n}};return{current:t,version:e,isWindows:r(Pn),isiOS:r("iOS"),isAndroid:r(kn),isOSX:r("OSX"),isLinux:r(En),isSolaris:r(Mn),isFreeBSD:r(Nn),isChromeOS:r(_n)}},jn={unknown:function(){return Wn({current:void 0,version:Sn.unknown()})},nu:Wn,windows:r(Pn),ios:r("iOS"),android:r(kn),linux:r(En),osx:r("OSX"),solaris:r(Mn),freebsd:r(Nn),chromeos:r(_n)},zn=function(n,t){var e=String(t).toLowerCase();return E(n,(function(n){return n.search(e)}))},Fn=function(n,t){return zn(n,t).map((function(n){var e=Sn.detect(n.versionRegexes,t);return{current:n.name,version:e}}))},Ln=function(n,t){return zn(n,t).map((function(n){var e=Sn.detect(n.versionRegexes,t);return{current:n.name,version:e}}))},Hn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,qn=function(n){return function(t){return dn(t,n)}},Vn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return dn(n,"edge/")&&dn(n,"chrome")&&dn(n,"safari")&&dn(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Hn],search:function(n){return dn(n,"chrome")&&!dn(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return dn(n,"msie")||dn(n,"trident")}},{name:"Opera",versionRegexes:[Hn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:qn("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:qn("firefox")},{name:"Safari",versionRegexes:[Hn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(dn(n,"safari")||dn(n,"mobile/"))&&dn(n,"applewebkit")}}],Un=[{name:"Windows",search:qn("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return dn(n,"iphone")||dn(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:qn("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:qn("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:qn("linux"),versionRegexes:[]},{name:"Solaris",search:qn("sunos"),versionRegexes:[]},{name:"FreeBSD",search:qn("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:qn("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Kn={browsers:r(Vn),oses:r(Un)},$n=function(n,t){var e=Kn.browsers(),o=Kn.oses(),u=Fn(e,n).fold(In.unknown,In.nu),i=Ln(o,n).fold(jn.unknown,jn.nu),c=function(n,t,e,o){var u=n.isiOS()&&!0===/ipad/i.test(e),i=n.isiOS()&&!u,c=n.isiOS()||n.isAndroid(),a=c||o("(pointer:coarse)"),l=u||!i&&c&&o("(min-device-width:768px)"),f=i||c&&!l,s=t.isSafari()&&n.isiOS()&&!1===/safari/i.test(e),d=!f&&!l&&!s;return{isiPad:r(u),isiPhone:r(i),isTablet:r(l),isPhone:r(f),isTouch:r(a),isAndroid:n.isAndroid,isiOS:n.isiOS,isWebView:r(s),isDesktop:r(d)}}(i,u,n,t);return{browser:u,os:i,deviceType:c}},Xn=function(t){return n.window.matchMedia(t).matches},Gn=yn((function(){return $n(n.navigator.userAgent,Xn)})),Yn=function(){return Gn()},Jn=function(n,t){var e=n.dom();if(1!==e.nodeType)return!1;var r=e;if(void 0!==r.matches)return r.matches(t);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(t);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(t);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},Qn=function(n){return 1!==n.nodeType&&9!==n.nodeType&&11!==n.nodeType||0===n.childElementCount},Zn=function(n,t){return n.dom()===t.dom()},nt=function(t,e){return r=t.dom(),o=e.dom(),function(n,t,e){return 0!=(n.compareDocumentPosition(t)&e)}(r,o,n.Node.DOCUMENT_POSITION_CONTAINED_BY);var r,o},tt=function(n,t){return Yn().browser.isIE()?nt(n,t):function(n,t){var e=n.dom(),r=t.dom();return e!==r&&e.contains(r)}(n,t)},et=Jn,rt=function(n){return bn.fromDom(n.dom().ownerDocument)},ot=function(n){return d.from(n.dom().parentNode).map(bn.fromDom)},ut=function(n,t){for(var e=y(t)?t:c,r=n.dom(),o=[];null!==r.parentNode&&void 0!==r.parentNode;){var u=r.parentNode,i=bn.fromDom(u);if(o.push(i),!0===e(i))break;r=u}return o},it=function(n){return d.from(n.dom().previousSibling).map(bn.fromDom)},ct=function(n){return d.from(n.dom().nextSibling).map(bn.fromDom)},at=function(n){return A(n.dom().childNodes,bn.fromDom)},lt=function(n,t){var e=n.dom().childNodes;return d.from(e[t]).map(bn.fromDom)},ft=y(n.Element.prototype.attachShadow)&&y(n.Node.prototype.getRootNode),st=r(ft),dt=ft?function(n){return bn.fromDom(n.dom().getRootNode())}:function(n){return nn(n)?n:rt(n)},mt=function(n){var t=dt(n);return tn(t)?d.some(t):d.none()},gt=function(n){return bn.fromDom(n.dom().host)},pt=function(n){if(st()&&w(n.target)){var t=bn.fromDom(n.target);if(Q(t)&&ht(bn.fromDom(n.target))){var e=n;if(e.composed&&e.composedPath){var r=e.composedPath();if(r)return 0===(o=r).length?d.none():d.some(o[0])}}}var o;return d.from(n.target)},ht=function(n){return w(n.dom().shadowRoot)},vt=function(n){var t,e,r=Z(n)?n.dom().parentNode:n.dom();return null!=r&&null!==r.ownerDocument&&mt(bn.fromDom(r)).fold((function(){return r.ownerDocument.body.contains(r)}),(t=vt,e=gt,function(n){return t(e(n))}))},bt=function(n){var t=n.dom().body;if(null==t)throw new Error("Body is not available yet");return bn.fromDom(t)},wt=function(t,e,r){if(!p(r))throw n.console.error("Invalid call to CSS.set. Property ",e,":: Value ",r,":: Element ",t),new Error("CSS value must be a string: "+r);hn(t)&&t.style.setProperty(e,r)},yt=function(n,t,e){var r=n.dom();wt(r,t,e)},Ct=function(n,t){var e=n.dom();H(t,(function(n,t){wt(e,t,n)}))},xt=function(t,e){var r=t.dom(),o=n.window.getComputedStyle(r).getPropertyValue(e);return""!==o||vt(t)?o:St(r,e)},St=function(n,t){return hn(n)?n.style.getPropertyValue(t):""},Tt=function(n,t){var e=n.dom(),r=St(e,t);return d.from(r).filter((function(n){return n.length>0}))},Rt=function(n,t){!function(n,t){hn(n)&&n.style.removeProperty(t)}(n.dom(),t),cn(n,"style").map(gn).is("")&&ln(n,"style")},Ot=function(n,t){ot(n).each((function(e){e.dom().insertBefore(t.dom(),n.dom())}))},Dt=function(n,t){ct(n).fold((function(){ot(n).each((function(n){Bt(n,t)}))}),(function(n){Ot(n,t)}))},At=function(n,t){(function(n){return lt(n,0)})(n).fold((function(){Bt(n,t)}),(function(e){n.dom().insertBefore(t.dom(),e.dom())}))},Bt=function(n,t){n.dom().appendChild(t.dom())},It=function(n,t){Ot(n,t),Bt(t,n)},Pt=function(n,t){B(t,(function(e,r){var o=0===r?n:t[r-1];Dt(o,e)}))},kt=function(n,t){B(t,(function(t){Bt(n,t)}))},Et=function(n){n.dom().textContent="",B(at(n),(function(n){Mt(n)}))},Mt=function(n){var t=n.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},Nt=function(n){var t,e=at(n);e.length>0&&(t=n,B(e,(function(n){Ot(t,n)}))),Mt(n)},_t=function(n,t,e){return{element:r(n),rowspan:r(t),colspan:r(e)}},Wt=function(n,t,e){return{element:r(n),cells:r(t),section:r(e)}},jt=function(n,t){return{element:r(n),isNew:r(t)}},zt=function(n,t){return{cells:r(n),section:r(t)}},Ft=function(n,t){var e=[];return B(at(n),(function(n){t(n)&&(e=e.concat([n])),e=e.concat(Ft(n,t))})),e},Lt=function(n,t,e){return function(n,t,e){return I(ut(n,e),t)}(n,(function(n){return Jn(n,t)}),e)},Ht=function(n,t){return function(n,t){return I(at(n),t)}(n,(function(n){return Jn(n,t)}))},qt=function(t,e){return function(t,e){var r=void 0===e?n.document:e.dom();return Qn(r)?[]:A(r.querySelectorAll(t),bn.fromDom)}(e,t)};function Vt(n,t,e,r,o){return n(e,r)?d.some(e):y(o)&&o(e)?d.none():t(e,r,o)}var Ut=function(n,t,e){for(var o=n.dom(),u=y(e)?e:r(!1);o.parentNode;){o=o.parentNode;var i=bn.fromDom(o);if(t(i))return d.some(i);if(u(i))break}return d.none()},Kt=function(n,t,e){return Ut(n,(function(n){return Jn(n,t)}),e)},$t=function(n,t){return function(n,t){return E(n.dom().childNodes,(function(n){return t(bn.fromDom(n))})).map(bn.fromDom)}(n,(function(n){return Jn(n,t)}))},Xt=function(t,e){return function(t,e){var r=void 0===e?n.document:e.dom();return Qn(r)?d.none():d.from(r.querySelector(t)).map(bn.fromDom)}(e,t)},Gt=function(n,t,e){return Vt((function(n,t){return Jn(n,t)}),Kt,n,t,e)},Yt=function(n,t,e){return void 0===e&&(e=0),cn(n,t).map((function(n){return parseInt(n,10)})).getOr(e)},Jt=function(n,t){return Yt(n,t,1)},Qt=function(n){return Jt(n,"colspan")>1},Zt=function(n){return Jt(n,"rowspan")>1},ne=function(n,t){return parseInt(xt(n,t),10)},te=r(10),ee=r(10),re=function(n,t){return oe(n,t,r(!0))},oe=function(n,t,e){return _(at(n),(function(n){return Jn(n,t)?e(n)?[n]:[]:oe(n,t,e)}))},ue=function(n,t){return function(n,t,e){return void 0===e&&(e=c),e(t)?d.none():R(n,X(t))?d.some(t):Kt(t,n.join(","),(function(n){return Jn(n,"table")||e(n)}))}(["td","th"],n,t)},ie=function(n){return re(n,"th,td")},ce=function(n,t){return Gt(n,"table",t)},ae=function(n){return re(n,"tr")},le=function(n){var t=ae(n);return A(t,(function(n){var t=n,e=ot(t).map((function(n){var t=X(n);return"tfoot"===t||"thead"===t||"tbody"===t?t:"tbody"})).getOr("tbody"),r=A(ie(n),(function(n){var t=Yt(n,"rowspan",1),e=Yt(n,"colspan",1);return _t(n,t,e)}));return Wt(t,r,e)}))},fe=function(n,t){return n+","+t},se=function(n,t){var e=_(n.all,(function(n){return n.cells()}));return I(e,t)},de=function(n){var t={},e=[],o=n.length,u=0;return B(n,(function(n,o){var i=[];B(n.cells(),(function(n){for(var e=0;void 0!==t[fe(o,e)];)e++;for(var c=function(n,t,e,o,u){return{element:r(n),rowspan:r(t),colspan:r(e),row:r(o),column:r(u)}}(n.element(),n.rowspan(),n.colspan(),o,e),a=0;a<n.colspan();a++)for(var l=0;l<n.rowspan();l++){var f=e+a,s=fe(o+l,f);t[s]=c,u=Math.max(u,f+1)}i.push(c)})),e.push(Wt(n.element(),i,n.section()))})),{grid:function(n,t){return{rows:r(n),columns:r(t)}}(o,u),access:t,all:e}},me={fromTable:function(n){var t=le(n);return de(t)},generate:de,getAt:function(n,t,e){var r=n.access[fe(t,e)];return void 0!==r?d.some(r):d.none()},findItem:function(n,t,e){var r=se(n,(function(n){return e(t,n.element())}));return r.length>0?d.some(r[0]):d.none()},filterItems:se,justCells:function(n){var t=A(n.all,(function(n){return n.cells()}));return N(t)}},ge=function(n,t,e){var r=n[e].element(),o=bn.fromTag("td");Bt(o,bn.fromTag("br")),(t?Bt:At)(r,o)},pe=function(n,t){var e=function(n){return Jn(n.element(),t)},r=le(n),o=me.generate(r),u=function(n,t){var e=n.grid.columns(),r=n.grid.rows(),o=e,u=0,i=0;return H(n.access,(function(n){if(t(n)){var e=n.row(),c=e+n.rowspan()-1,a=n.column(),l=a+n.colspan()-1;e<r?r=e:c>u&&(u=c),a<o?o=a:l>i&&(i=l)}})),function(n,t,e,r){return{minRow:n,minCol:t,maxRow:e,maxCol:r}}(r,o,u,i)}(o,e),i="th:not("+t+"),td:not("+t+")",c=oe(n,"th,td",(function(n){return Jn(n,i)}));return B(c,Mt),function(n,t,e,r){for(var o=t.grid.columns(),u=t.grid.rows(),i=0;i<u;i++)for(var c=!1,a=0;a<o;a++)i<e.minRow||i>e.maxRow||a<e.minCol||a>e.maxCol||(me.getAt(t,i,a).filter(r).isNone()?ge(n,c,i):c=!0)}(r,o,u,e),function(n,t){var e=I(re(n,"tr"),(function(n){return 0===n.dom().childElementCount}));B(e,Mt),t.minCol!==t.maxCol&&t.minRow!==t.maxRow||B(re(n,"th,td"),(function(n){ln(n,"rowspan"),ln(n,"colspan")})),ln(n,"width"),ln(n,"height"),Rt(n,"width"),Rt(n,"height")}(n,u),n};var he=function(n,t){var e=function(t){return n(t)?d.from(t.dom().nodeValue):d.none()};return{get:function(r){if(!n(r))throw new Error("Can only get "+t+" value of a "+t+" node");return e(r).getOr("")},getOption:e,set:function(e,r){if(!n(e))throw new Error("Can only set raw "+t+" value of a "+t+" node");e.dom().nodeValue=r}}}(Z,"text"),ve=function(n){return he.get(n)},be=function(n){return he.getOption(n)},we=function(n,t){return he.set(n,t)},ye=function(n){return"img"===X(n)?1:be(n).fold((function(){return at(n).length}),(function(n){return n.length}))},Ce=["img","br"],xe=function(n){return be(n).filter((function(n){return 0!==n.trim().length||n.indexOf(" ")>-1})).isSome()||R(Ce,X(n))},Se=function(n){return t=xe,(e=function(n){for(var r=0;r<n.childNodes.length;r++){var o=bn.fromDom(n.childNodes[r]);if(t(o))return d.some(o);var u=e(n.childNodes[r]);if(u.isSome())return u}return d.none()})(n.dom());var t,e},Te=function(n){return Re(n,xe)},Re=function(n,t){var e=function(n){for(var r=at(n),o=r.length-1;o>=0;o--){var u=r[o];if(t(u))return d.some(u);var i=e(u);if(i.isSome())return i}return d.none()};return e(n)},Oe=function(n,t){return bn.fromDom(n.dom().cloneNode(t))},De=function(n){return Oe(n,!1)},Ae=function(n){return Oe(n,!0)},Be=function(n,t){var e=function(n,t){var e=bn.fromTag(t),r=fn(n);return on(e,r),e}(n,t),r=at(Ae(n));return kt(e,r),e},Ie=function(){var n=bn.fromTag("td");return Bt(n,bn.fromTag("br")),n},Pe=function(n,t,e){var r=Be(n,t);return H(e,(function(n,t){null===n?ln(r,t):rn(r,t,n)})),r},ke=function(n){return n},Ee=function(n){return function(){return bn.fromTag("tr",n.dom())}},Me=function(n,t,e){return{row:Ee(t),cell:function(t){var r,o,u,i,c=rt(t.element()),a=bn.fromTag(X(t.element()),c.dom()),l=e.getOr(["strong","em","b","i","span","font","h1","h2","h3","h4","h5","h6","p","div"]),f=l.length>0?function(n,t,e){return Se(n).map((function(r){var o=e.join(","),u=Lt(r,o,(function(t){return Zn(t,n)}));return P(u,(function(n,t){var e=De(t);return ln(e,"contenteditable"),Bt(n,e),e}),t)})).getOr(t)}(t.element(),a,l):a;return Bt(f,bn.fromTag("br")),r=t.element(),o=a,u=r.dom(),i=o.dom(),hn(u)&&hn(i)&&(i.style.cssText=u.style.cssText),Rt(a,"height"),1!==t.colspan()&&Rt(t.element(),"width"),n(t.element(),a),a},replace:Pe,gap:Ie}},Ne=function(n){return{row:Ee(n),cell:Ie,replace:ke,gap:Ie}},_e=function(n,t){var e=t.column(),r=t.column()+t.colspan()-1,o=t.row(),u=t.row()+t.rowspan()-1;return e<=n.finishCol()&&r>=n.startCol()&&o<=n.finishRow()&&u>=n.startRow()},We=function(n,t){return t.column()>=n.startCol()&&t.column()+t.colspan()-1<=n.finishCol()&&t.row()>=n.startRow()&&t.row()+t.rowspan()-1<=n.finishRow()},je=function(n,t){return e=Math.min(n.row(),t.row()),o=Math.min(n.column(),t.column()),u=Math.max(n.row()+n.rowspan()-1,t.row()+t.rowspan()-1),i=Math.max(n.column()+n.colspan()-1,t.column()+t.colspan()-1),{startRow:r(e),startCol:r(o),finishRow:r(u),finishCol:r(i)};var e,o,u,i},ze=function(n,t,e){var r=me.findItem(n,t,Zn),o=me.findItem(n,e,Zn);return r.bind((function(n){return o.map((function(t){return je(n,t)}))}))},Fe=function(n,t,e){return ze(n,t,e).bind((function(t){return function(n,t){for(var e=!0,r=u(We,t),o=t.startRow();o<=t.finishRow();o++)for(var i=t.startCol();i<=t.finishCol();i++)e=e&&me.getAt(n,o,i).exists(r);return e?d.some(t):d.none()}(n,t)}))},Le=function(n,t,e){return ze(n,t,e).map((function(t){var e=me.filterItems(n,u(_e,t));return A(e,(function(n){return n.element()}))}))},He=function(n,t){return me.findItem(n,t,(function(n,t){return tt(t,n)})).map((function(n){return n.element()}))},qe=function(n,t,e){return ce(n).bind((function(r){return function(n,t,e,r){return me.findItem(n,t,Zn).bind((function(t){var o=e>0?t.row()+t.rowspan()-1:t.row(),u=r>0?t.column()+t.colspan()-1:t.column();return me.getAt(n,o+e,u+r).map((function(n){return n.element()}))}))}(Ke(r),n,t,e)}))},Ve=function(n,t,e){var r=Ke(n);return Le(r,t,e)},Ue=function(n,t,e,r,o){var u=Ke(n),i=Zn(n,e)?d.some(t):He(u,t),c=Zn(n,o)?d.some(r):He(u,r);return i.bind((function(n){return c.bind((function(t){return Le(u,n,t)}))}))},Ke=me.fromTable,$e=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","li","table","thead","tbody","tfoot","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"];function Xe(){return{up:r({selector:Kt,closest:Gt,predicate:Ut,all:ut}),down:r({selector:qt,predicate:Ft}),styles:r({get:xt,getRaw:Tt,set:yt,remove:Rt}),attrs:r({get:un,set:rn,remove:ln,copyTo:function(n,t){var e=fn(n);on(t,e)}}),insert:r({before:Ot,after:Dt,afterAll:Pt,append:Bt,appendAll:kt,prepend:At,wrap:It}),remove:r({unwrap:Nt,remove:Mt}),create:r({nu:bn.fromTag,clone:function(n){return bn.fromDom(n.dom().cloneNode(!1))},text:bn.fromText}),query:r({comparePosition:function(n,t){return n.dom().compareDocumentPosition(t.dom())},prevSibling:it,nextSibling:ct}),property:r({children:at,name:X,parent:ot,document:function(n){return n.dom().ownerDocument},isText:Z,isComment:J,isElement:Q,getText:ve,setText:we,isBoundary:function(n){return!!Q(n)&&("body"===X(n)||R($e,X(n)))},isEmptyTag:function(n){return!!Q(n)&&R(["br","img","hr","input"],X(n))},isNonEditable:function(n){return Q(n)&&"false"===un(n,"contenteditable")}}),eq:Zn,is:et}}var Ge=function(n,t,e,r){var o=t(n,e);return P(r,(function(e,r){var o=t(n,r);return Ye(n,e,o)}),o)},Ye=function(n,t,e){return t.bind((function(t){return e.filter(u(n.eq,t))}))},Je=function(n,t,e){return e.length>0?function(n,t,e,r){return r(n,t,e[0],e.slice(1))}(n,t,e,Ge):d.none()},Qe=function(n,t,e,o){void 0===o&&(o=c);var i=[t].concat(n.up().all(t)),a=[e].concat(n.up().all(e)),l=function(n){return M(n,o).fold((function(){return n}),(function(t){return n.slice(0,t+1)}))},f=l(i),s=l(a),d=E(f,(function(t){return O(s,function(n,t){return u(n.eq,t)}(n,t))}));return{firstpath:r(f),secondpath:r(s),shared:r(d)}},Ze=Xe(),nr=function(n,t){return Je(Ze,(function(t,e){return n(e)}),t)},tr=function(n){return Kt(n,"table")},er=function(n,t,e){var r=function(n){return function(t){return void 0!==e&&e(t)||Zn(t,n)}};return Zn(n,t)?d.some({boxes:d.some([n]),start:n,finish:t}):tr(n).bind((function(o){return tr(t).bind((function(u){if(Zn(o,u))return d.some({boxes:Ve(o,n,t),start:n,finish:t});if(tt(o,u)){var i=(c=Lt(t,"td,th",r(o))).length>0?c[c.length-1]:t;return d.some({boxes:Ue(o,n,o,t,u),start:n,finish:i})}if(tt(u,o)){var c,a=(c=Lt(n,"td,th",r(u))).length>0?c[c.length-1]:n;return d.some({boxes:Ue(u,n,o,t,u),start:n,finish:a})}return function(n,t,e){return Qe(Ze,n,t,e)}(n,t).shared().bind((function(i){return Gt(i,"table",e).bind((function(e){var i=Lt(t,"td,th",r(e)),c=i.length>0?i[i.length-1]:t,a=Lt(n,"td,th",r(e)),l=a.length>0?a[a.length-1]:n;return d.some({boxes:Ue(e,n,o,t,u),start:l,finish:c})}))}))}))}))},rr=function(n,t){var e=qt(n,t);return e.length>0?d.some(e):d.none()},or=function(n,t,e){return Xt(n,t).bind((function(t){return Xt(n,e).bind((function(n){return nr(tr,[t,n]).map((function(e){return{first:r(t),last:r(n),table:r(e)}}))}))}))},ur=function(n,t,e,r,o){return function(n,t){return E(n,(function(n){return Jn(n,t)}))}(n,o).bind((function(n){return qe(n,t,e).bind((function(n){return function(n,t){return Kt(n,"table").bind((function(e){return Xt(e,t).bind((function(t){return er(t,n).bind((function(n){return n.boxes.map((function(t){return{boxes:t,start:n.start,finish:n.finish}}))}))}))}))}(n,r)}))}))},ir=function(n,t,e){return or(n,t,e).bind((function(t){var e=function(t){return Zn(n,t)},r=Kt(t.first(),"thead,tfoot,tbody,table",e),o=Kt(t.last(),"thead,tfoot,tbody,table",e);return r.bind((function(n){return o.bind((function(e){return Zn(n,e)?function(n,t,e){var r=Ke(n);return Fe(r,t,e)}(t.table(),t.first(),t.last()):d.none()}))}))}))},cr="data-mce-selected",ar="data-mce-first-selected",lr="data-mce-last-selected",fr=cr,sr="td[data-mce-selected],th[data-mce-selected]",dr="[data-mce-selected]",mr=ar,gr="td[data-mce-first-selected],th[data-mce-first-selected]",pr=lr,hr="td[data-mce-last-selected],th[data-mce-last-selected]",vr=Object.freeze({__proto__:null,selected:fr,selectedSelector:sr,attributeSelector:dr,firstSelected:mr,firstSelectedSelector:gr,lastSelected:pr,lastSelectedSelector:hr}),br=function(t){if(!v(t))throw new Error("cases must be an array");if(0===t.length)throw new Error("there must be at least one case");var e=[],r={};return B(t,(function(o,u){var i=F(o);if(1!==i.length)throw new Error("one and only one name per case");var c=i[0],a=o[c];if(void 0!==r[c])throw new Error("duplicate key detected:"+c);if("cata"===c)throw new Error("cannot have a case named cata (sorry)");if(!v(a))throw new Error("case arguments must be an array");e.push(c),r[c]=function(){var r=arguments.length;if(r!==a.length)throw new Error("Wrong number of arguments to case "+c+". Expected "+a.length+" ("+a+"), got "+r);for(var o=new Array(r),i=0;i<o.length;i++)o[i]=arguments[i];var l=function(n){var t=F(n);if(e.length!==t.length)throw new Error("Wrong number of arguments to match. Expected: "+e.join(",")+"\nActual: "+t.join(","));if(!W(e,(function(n){return R(t,n)})))throw new Error("Not all branches were specified when using match. Specified: "+t.join(", ")+"\nRequired: "+e.join(", "));return n[c].apply(null,o)};return{fold:function(){if(arguments.length!==t.length)throw new Error("Wrong number of arguments to fold. Expected "+t.length+", got "+arguments.length);var n=arguments[u];return n.apply(null,o)},match:l,log:function(t){n.console.log(t,{constructors:e,constructor:c,params:o})}}}})),r},wr=br([{none:[]},{multiple:["elements"]},{single:["selection"]}]),yr=function(n,t,e,r){return n.fold(t,e,r)},Cr=wr.none,xr=wr.multiple,Sr=wr.single,Tr=function(n,t){return yr(t.get(),r([]),o,r([n]))},Rr=function(n,t){var e=Tr(n,t);return e.length>0&&W(e,(function(n){return an(n,"rowspan")&&parseInt(un(n,"rowspan"),10)>1||an(n,"colspan")&&parseInt(un(n,"colspan"),10)>1}))?d.some(e):d.none()},Or=function(n,t){return yr(t.get(),d.none,(function(t,e){return 0===t.length?d.none():ir(n,gr,hr).bind((function(n){return t.length>1?d.some({bounds:r(n),cells:r(t)}):d.none()}))}),d.none)},Dr=function(n){return{element:r(n),mergable:d.none,unmergable:d.none,selection:r([n])}},Ar=function(n,t,e){return{element:r(e),mergable:r(Or(t,n)),unmergable:r(Rr(e,n)),selection:r(Tr(e,n))}},Br=function(t,o,u,i){t.on("BeforeGetContent",(function(n){!0===n.selection&&yr(o.get(),e,(function(e){n.preventDefault(),function(n){return ce(n[0]).map(Ae).map((function(n){return[pe(n,dr)]}))}(e).each((function(e){n.content="text"===n.format?function(n){return A(n,(function(n){return n.dom().innerText})).join("")}(e):function(n,t){return A(t,(function(t){return n.selection.serializer.serialize(t.dom(),{})})).join("")}(t,e)}))}),e)})),t.on("BeforeSetContent",(function(e){!0===e.selection&&!0===e.paste&&d.from(t.dom.getParent(t.selection.getStart(),"th,td")).each((function(o){var c=bn.fromDom(o);ce(c).each((function(o){var a,l,f,s,d=I((a=e.content,(f=(l||n.document).createElement("div")).innerHTML=a,at(bn.fromDom(f))),(function(n){return"meta"!==X(n)}));if(1===d.length&&(s=d[0],"table"===X(s))){e.preventDefault();var m=bn.fromDom(t.getDoc()),g=Ne(m),p=function(n,t,e){return{element:r(n),clipboard:r(t),generators:r(e)}}(c,d[0],g);u.pasteCells(o,p).each((function(n){t.selection.setRng(n),t.focus(),i.clear(o)}))}}))}))}))},Ir=function(n,t){return{left:r(n),top:r(t),translate:function(e,r){return Ir(n+e,t+r)}}},Pr=Ir,kr=function(n,t){return void 0!==n?n:void 0!==t?t:0},Er=function(n){var t=n.dom().ownerDocument,e=t.body,r=t.defaultView,o=t.documentElement;if(e===n.dom())return Pr(e.offsetLeft,e.offsetTop);var u=kr(r.pageYOffset,o.scrollTop),i=kr(r.pageXOffset,o.scrollLeft),c=kr(o.clientTop,e.clientTop),a=kr(o.clientLeft,e.clientLeft);return Mr(n).translate(i-a,u-c)},Mr=function(n){var t=n.dom(),e=t.ownerDocument.body;return e===t?Pr(e.offsetLeft,e.offsetTop):vt(n)?function(n){var t=n.getBoundingClientRect();return Pr(t.left,t.top)}(t):Pr(0,0)},Nr=function(n){var t=d.from(n.dom().documentElement).map(bn.fromDom).getOr(n);return{parent:r(t),view:r(n),origin:r(Pr(0,0))}},_r=function(n,t){return{parent:r(t),view:r(n),origin:r(Pr(0,0))}};function Wr(n,t){var e=function(e){var r=t(e);if(r<=0||null===r){var o=xt(e,n);return parseFloat(o)||0}return r},r=function(n,t){return k(t,(function(t,e){var r=xt(n,e),o=void 0===r?0:parseInt(r,10);return isNaN(o)?t:t+o}),0)};return{set:function(t,e){if(!C(e)&&!e.match(/^[0-9]+$/))throw new Error(n+".set accepts only positive integer values. Value was "+e);var r=t.dom();hn(r)&&(r.style[n]=e+"px")},get:e,getOuter:e,aggregate:r,max:function(n,t,e){var o=r(n,e);return t>o?t-o:0}}}var jr=Wr("height",(function(n){var t=n.dom();return vt(n)?t.getBoundingClientRect().height:t.offsetHeight})),zr=function(n){return jr.get(n)},Fr=function(n){return jr.getOuter(n)},Lr=Wr("width",(function(n){return n.dom().offsetWidth})),Hr=function(n){return Lr.get(n)},qr=function(n){return Lr.getOuter(n)},Vr=function(n,t){return{row:n,y:t}},Ur=function(n,t){return{col:n,x:t}},Kr=function(n){return Er(n).left()+qr(n)},$r=function(n){return Er(n).left()},Xr=function(n,t){return Ur(n,$r(t))},Gr=function(n,t){return Ur(n,Kr(t))},Yr=function(n){return Er(n).top()},Jr=function(n,t){return Vr(n,Yr(t))},Qr=function(n,t){return Vr(n,Yr(t)+Fr(t))},Zr=function(n,t,e){if(0===e.length)return[];var r=A(e.slice(1),(function(t,e){return t.map((function(t){return n(e,t)}))})),o=e[e.length-1].map((function(n){return t(e.length-1,n)}));return r.concat([o])},no={delta:o,positions:function(n){return Zr(Jr,Qr,n)},edge:Yr},to={delta:o,edge:$r,positions:function(n){return Zr(Xr,Gr,n)}},eo={delta:function(n){return-n},edge:Kr,positions:function(n){return Zr(Gr,Xr,n)}},ro=function(n){var t=n.grid,e=D(t.columns(),o),u=D(t.rows(),o);return A(e,(function(t){return oo((function(){return _(u,(function(e){return me.getAt(n,e,t).filter((function(n){return n.column()===t})).fold(r([]),(function(n){return[n]}))}))}),(function(n){return 1===n.colspan()}),(function(){return me.getAt(n,0,t)}))}))},oo=function(n,t,e){var r=n();return E(r,t).orThunk((function(){return d.from(r[0]).orThunk(e)})).map((function(n){return n.element()}))},uo=function(n){var t=n.grid,e=D(t.rows(),o),u=D(t.columns(),o);return A(e,(function(t){return oo((function(){return _(u,(function(e){return me.getAt(n,t,e).filter((function(n){return n.row()===t})).fold(r([]),(function(n){return[n]}))}))}),(function(n){return 1===n.rowspan()}),(function(){return me.getAt(n,t,0)}))}))},io=function(n,t){if(t<0||t>=n.length-1)return d.none();var e=n[t].fold((function(){var e=function(n){var t=x.call(n,0);return t.reverse(),t}(n.slice(0,t));return z(e,(function(n,t){return n.map((function(n){return{value:n,delta:t+1}}))}))}),(function(n){return d.some({value:n,delta:0})})),r=n[t+1].fold((function(){var e=n.slice(t+1);return z(e,(function(n,t){return n.map((function(n){return{value:n,delta:t+1}}))}))}),(function(n){return d.some({value:n,delta:1})}));return e.bind((function(n){return r.map((function(t){var e=t.delta+n.delta;return Math.abs(t.value-n.value)/e}))}))},co=function(){var n=Yn().browser;return n.isIE()||n.isEdge()},ao=function(n,t,e){return function(n,t){var e=parseFloat(n);return isNaN(e)?t:e}(xt(n,t),e)},lo=function(n){return co()?function(n){var t=n.dom().getBoundingClientRect().height;return"border-box"===xt(n,"box-sizing")?t:t-ao(n,"padding-top",0)-ao(n,"padding-bottom",0)-(ao(n,"border-top-width",0)+ao(n,"border-bottom-width",0))}(n):ao(n,"height",zr(n))},fo=function(n){return co()?function(n){var t=n.dom().getBoundingClientRect().width;return"border-box"===xt(n,"box-sizing")?t:t-ao(n,"padding-left",0)-ao(n,"padding-right",0)-(ao(n,"border-left-width",0)+ao(n,"border-right-width",0))}(n):ao(n,"width",Hr(n))},so=/(\d+(\.\d+)?)(\w|%)*/,mo=/(\d+(\.\d+)?)%/,go=/(\d+(\.\d+)?)px|em/,po=function(n,t){var e,r=(e=n,d.from(e.dom().offsetParent).map(bn.fromDom)).getOr(bt(rt(n)));return t(n)/t(r)*100},ho=function(n,t){yt(n,"width",t+"px")},vo=function(n,t){yt(n,"width",t+"%")},bo=function(n,t){yt(n,"height",t+"px")},wo=function(n,t,e,r){var o=parseInt(n,10);return mn(n,"%")&&"table"!==X(t)?function(n,t,e,r){var o=ce(n).map((function(n){var r=e(n);return Math.floor(t/100*r)})).getOr(t);return r(n,o),o}(t,o,e,r):o},yo=function(n){var t=function(n){return Tt(n,"height").getOrThunk((function(){return lo(n)+"px"}))}(n);return t?wo(t,n,zr,bo):zr(n)},Co=function(n){return Tt(n,"width").fold((function(){return d.from(un(n,"width"))}),(function(n){return d.some(n)}))},xo=function(n,t){return n/t.pixelWidth()*100},So=function(n,t){return Co(n).fold((function(){var e=Hr(n);return xo(e,t)}),(function(e){return function(n,t,e){var r=mo.exec(t);if(null!==r)return parseFloat(r[1]);var o=fo(n);return xo(o,e)}(n,e,t)}))},To=function(n,t){return Co(n).fold((function(){return fo(n)}),(function(e){return function(n,t,e){var r=go.exec(t);if(null!==r)return parseInt(r[1],10);var o=mo.exec(t);return null!==o?function(n,t){return n/100*t.pixelWidth()}(parseFloat(o[1]),e):fo(n)}(n,e,t)}))},Ro=function(n){return function(n,t,e){return e(n)/Jt(n,t)}(n,"rowspan",yo)},Oo=function(n,t,e){yt(n,"width",t+e)},Do=function(n){return po(n,Hr)+"%"},Ao=r(mo),Bo=r(go),Io=function(n,t,e){return Tt(n,t).fold((function(){return e(n)+"px"}),(function(n){return n}))},Po=function(n,t){return Io(n,"width",(function(n){return To(n,t)}))},ko=function(n){return Io(n,"height",Ro)},Eo=function(n,t,e,r,o){var u=ro(n),c=A(u,(function(n){return n.map(t.edge)}));return A(u,(function(n,t){return n.filter(i(Qt)).fold((function(){var n=io(c,t);return r(n)}),(function(n){return e(n,o)}))}))},Mo=function(n){return n.map((function(n){return n+"px"})).getOr("")},No=function(n,t,e){return Eo(n,t,So,(function(n){return n.fold((function(){return e.minCellWidth()}),(function(n){return n/e.pixelWidth()*100}))}),e)},_o=function(n,t,e){return Eo(n,t,To,(function(n){return n.getOrThunk(e.minCellWidth)}),e)},Wo=function(n,t,e,r){var o=uo(n),u=A(o,(function(n){return n.map(t.edge)}));return A(o,(function(n,t){return n.filter(i(Zt)).fold((function(){var n=io(u,t);return r(n)}),(function(n){return e(n)}))}))},jo=br([{invalid:["raw"]},{pixels:["value"]},{percent:["value"]}]),zo=function(n,t,e){var r=e.substring(0,e.length-n.length),o=parseFloat(r);return r===o.toString()?t(o):jo.invalid(e)},Fo=wn(wn({},jo),{from:function(n){return mn(n,"%")?zo("%",jo.percent,n):mn(n,"px")?zo("px",jo.pixels,n):jo.invalid(n)}}),Lo=function(n,t,e){return n.fold((function(){return t}),(function(n){return function(n,t,e){var r=e/t;return A(n,(function(n){return Fo.from(n).fold((function(){return n}),(function(n){return n*r+"px"}),(function(n){return n/100*e+"px"}))}))}(t,e,n)}),(function(n){return function(n,t){return A(n,(function(n){return Fo.from(n).fold((function(){return n}),(function(n){return n/t*100+"%"}),(function(n){return n+"%"}))}))}(t,e)}))},Ho=function(n,t,e){var o=Fo.from(e),u=W(n,(function(n){return"0px"===n}))?function(n,t){var e=n.fold((function(){return r("")}),(function(n){return r(n/t+"px")}),(function(n){return r(n/t+"px")}));return D(t,e)}(o,n.length):Lo(o,n,t);return Uo(u)},qo=function(n,t){return 0===n.length?t:P(n,(function(n,t){return Fo.from(t).fold(r(0),o,o)+n}),0)},Vo=function(n,t){return Fo.from(n).fold(r(n),(function(n){return n+t+"px"}),(function(n){return n+t+"%"}))},Uo=function(n){if(0===n.length)return n;var t=P(n,(function(n,t){var e=Fo.from(t).fold((function(){return{value:t,remainder:0}}),(function(n){return function(n,t){var e=Math.floor(n);return{value:e+t,remainder:n-e}}(n,"px")}),(function(n){return{value:n+"%",remainder:0}}));return{output:[e.value].concat(n.output),remainder:n.remainder+e.remainder}}),{output:[],remainder:0}),e=t.output;return e.slice(0,e.length-1).concat([Vo(e[e.length-1],Math.round(t.remainder))])},Ko=Fo.from,$o=function(n){return Ko(n).fold(r("px"),r("px"),r("%"))},Xo=function(n,t,e,r,o){var u=me.fromTable(n),i=u.all,c=me.justCells(u);t.each((function(t){var e=$o(t),i=Hr(n),a=function(n,t,e){return Eo(n,t,Po,Mo,e)}(u,r,o);!function(n,t,e){B(t,(function(t){var r=n.slice(t.column(),t.colspan()+t.column()),o=qo(r,te());yt(t.element(),"width",o+e)}))}(Ho(a,i,t),c,e),yt(n,"width",t)})),e.each((function(t){var e=$o(t),r=zr(n),o=function(n,t){return Wo(n,t,ko,Mo)}(u,no);!function(n,t,e,r){B(e,(function(t){var e=n.slice(t.row(),t.rowspan()+t.row()),o=qo(e,ee());yt(t.element(),"height",o+r)})),B(t,(function(t,e){yt(t.element(),"height",n[e])}))}(Ho(o,r,t),i,c,e),yt(n,"height",t)}))},Go=function(n){return Co(n).exists((function(n){return mo.test(n)}))},Yo=function(n){return Co(n).exists((function(n){return go.test(n)}))},Jo=function(n){return Co(n).isNone()},Qo=Do,Zo={ltr:to,rtl:eo},nu=function(n){var t=function(t){return n(t).isRtl()?Zo.rtl:Zo.ltr};return{delta:function(n,e){return t(e).delta(n,e)},edge:function(n){return t(n).edge(n)},positions:function(n,e){return t(e).positions(n,e)}}},tu=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(n.length!==t.length)throw new Error('Wrong number of arguments to struct. Expected "['+n.length+']", got '+t.length+" arguments");var o={};return B(n,(function(n,e){o[n]=r(t[e])})),o}},eu=function(n){var t=tu.apply(null,n),e=[];return{bind:function(n){if(void 0===n)throw new Error("Event bind error: undefined handler");e.push(n)},unbind:function(n){e=I(e,(function(t){return t!==n}))},trigger:function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=t.apply(null,n);B(e,(function(n){n(o)}))}}},ru=function(n){return{registry:q(n,(function(n){return{bind:n.bind,unbind:n.unbind}})),trigger:q(n,(function(n){return n.trigger}))}},ou=br([{none:[]},{only:["index"]},{left:["index","next"]},{middle:["prev","index","next"]},{right:["prev","index"]}]),uu=wn({},ou),iu=function(n,t,e,o){var u=n.slice(0),i=function(n,t){return 0===n.length?uu.none():1===n.length?uu.only(0):0===t?uu.left(0,1):t===n.length-1?uu.right(t-1,t):t>0&&t<n.length-1?uu.middle(t-1,t,t+1):uu.none()}(n,t),c=function(n){return A(n,r(0))},a=r(c(u)),l=function(n,t){if(e>=0){var r=Math.max(o.minCellWidth(),u[t]-e);return c(u.slice(0,n)).concat([e,r-u[t]]).concat(c(u.slice(t+1)))}var i=Math.max(o.minCellWidth(),u[n]+e),a=u[n]-i;return c(u.slice(0,n)).concat([i-u[n],a]).concat(c(u.slice(t+1)))},f=l;return i.fold(a,(function(n){return o.singleColumnWidth(u[n],e)}),f,(function(n,t,e){return l(t,e)}),(function(n,t){if(e>=0)return c(u.slice(0,t)).concat([e]);var r=Math.max(o.minCellWidth(),u[t]+e);return c(u.slice(0,t)).concat([r-u[t]])}))},cu=function(n,t,e){for(var r=0,o=n;o<t;o++)r+=void 0!==e[o]?e[o]:0;return r},au=function(n,t){var e=me.justCells(n);return A(e,(function(n){var e=cu(n.column(),n.column()+n.colspan(),t);return{element:n.element(),width:e,colspan:n.colspan()}}))},lu=function(n,t){var e=me.justCells(n);return A(e,(function(n){var e=cu(n.row(),n.row()+n.rowspan(),t);return{element:n.element,height:r(e),rowspan:n.rowspan}}))},fu=function(n,t,e,o){var u=me.fromTable(n),i=function(n,t){return Wo(n,t,Ro,(function(n){return n.getOrThunk(ee)}))}(u,o),c=A(i,(function(n,r){return e===r?Math.max(t+n,ee()):n})),a=lu(u,c),l=function(n,t){return A(n.all,(function(n,e){return{element:n.element,height:r(t[e])}}))}(u,c);B(l,(function(n){bo(n.element(),n.height())})),B(a,(function(n){bo(n.element(),n.height())}));var f=P(c,(function(n,t){return n+t}),0);bo(n,f)},su=function(n){var t,e,o=bn.fromDom(pt(n).getOr(n.target)),u=function(){return n.stopPropagation()},i=function(){return n.preventDefault()},c=(t=i,e=u,function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t(e.apply(null,n))});return function(n,t,e,o,u,i,c){return{target:r(n),x:r(t),y:r(e),stop:o,prevent:u,kill:i,raw:r(c)}}(o,n.clientX,n.clientY,u,i,c,n)},du=function(n,t,e,r,o){var i=function(n,t){return function(e){n(e)&&t(su(e))}}(e,r);return n.dom().addEventListener(t,i,o),{unbind:u(mu,n,t,i,o)}},mu=function(n,t,e,r){n.dom().removeEventListener(t,e,r)},gu=r(!0),pu=function(n,t,e){return function(n,t,e,r){return du(n,t,e,r,!1)}(n,t,gu,e)},hu=su,vu=function(n,t){var e=un(n,t);return void 0===e||""===e?[]:e.split(" ")},bu=function(n){return void 0!==n.dom().classList},wu=function(n,t){return function(n,t,e){var r=vu(n,t).concat([e]);return rn(n,t,r.join(" ")),!0}(n,"class",t)},yu=function(n,t){bu(n)?n.dom().classList.add(t):wu(n,t)},Cu=function(n,t){return bu(n)&&n.dom().classList.contains(t)},xu=function(n){var t=n.replace(/\./g,"-");return{resolve:function(n){return t+"-"+n}}},Su=xu("ephox-dragster").resolve,Tu=function(n){return n.slice(0).sort()},Ru=function(n,t,e){if(0===t.length)throw new Error("You must specify at least one required field.");var r;return function(n,t){if(!v(t))throw new Error("The "+n+" fields must be an array. Was: "+t+".");B(t,(function(t){if(!p(t))throw new Error("The value "+t+" in the "+n+" fields was not a string.")}))}("required",t),r=Tu(t),E(r,(function(n,t){return t<r.length-1&&n===r[t+1]})).each((function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+r.join(", ")+"].")})),function(r){var o=F(r);W(t,(function(n){return R(o,n)}))||function(n,t){throw new Error("All required keys ("+Tu(n).join(", ")+") were not specified. Specified keys were: "+Tu(t).join(", ")+".")}(t,o),n(t,o);var u=I(t,(function(n){return!e.validate(r[n],n)}));return u.length>0&&function(n,t){throw new Error("All values need to be of type: "+t+". Keys ("+Tu(n).join(", ")+") were not.")}(u,e.label),r}},Ou=function(n,t){var e=I(t,(function(t){return!R(n,t)}));e.length>0&&function(n){throw new Error("Unsupported keys for object: "+Tu(n).join(", "))}(e)},Du=function(n){return function(n,t){return Ru(n,t,{validate:y,label:"function"})}(Ou,n)},Au=Du(["compare","extract","mutate","sink"]),Bu=Du(["element","start","stop","destroy"]),Iu=Du(["forceDrop","drop","move","delayDrop"]),Pu=Au({compare:function(n,t){return Pr(t.left()-n.left(),t.top()-n.top())},extract:function(n){return d.some(Pr(n.x(),n.y()))},sink:function(n,t){var e=function(n){var t=wn({layerClass:Su("blocker")},n),e=bn.fromTag("div");return rn(e,"role","presentation"),Ct(e,{position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"}),yu(e,Su("blocker")),yu(e,t.layerClass),{element:function(){return e},destroy:function(){Mt(e)}}}(t),r=pu(e.element(),"mousedown",n.forceDrop),o=pu(e.element(),"mouseup",n.drop),u=pu(e.element(),"mousemove",n.move),i=pu(e.element(),"mouseout",n.delayDrop);return Bu({element:e.element,start:function(n){Bt(n,e.element())},stop:function(){Mt(e.element())},destroy:function(){e.destroy(),o.unbind(),u.unbind(),i.unbind(),r.unbind()}})},mutate:function(n,t){n.mutate(t.left(),t.top())}});function ku(){var n=d.none(),t=ru({move:eu(["info"])});return{onEvent:function(e,r){r.extract(e).each((function(e){(function(t,e){var r=n.map((function(n){return t.compare(n,e)}));return n=d.some(e),r})(r,e).each((function(n){t.trigger.move(n)}))}))},reset:function(){n=d.none()},events:t.registry}}function Eu(){var n={onEvent:e,reset:e},t=ku(),r=n;return{on:function(){r.reset(),r=t},off:function(){r.reset(),r=n},isOn:function(){return r===t},onEvent:function(n,t){r.onEvent(n,t)},events:t.events}}var Mu=function(t,e,r){var o,u,i,c=!1,a=ru({start:eu([]),stop:eu([])}),l=Eu(),f=function(){m.stop(),l.isOn()&&(l.off(),a.trigger.stop())},s=(o=f,u=200,i=null,{cancel:function(){null!==i&&(n.clearTimeout(i),i=null)},throttle:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];null!==i&&n.clearTimeout(i),i=n.setTimeout((function(){o.apply(null,t),i=null}),u)}});l.events.move.bind((function(n){e.mutate(t,n.info())}));var d=function(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];c&&n.apply(null,t)}},m=e.sink(Iu({forceDrop:f,drop:d(f),move:d((function(n){s.cancel(),l.onEvent(n,e)})),delayDrop:d(s.throttle)}),r);return{element:m.element,go:function(n){m.start(n),l.on(),a.trigger.start()},on:function(){c=!0},off:function(){c=!1},destroy:function(){m.destroy()},events:a.registry}},Nu=function(n){return"true"===un(n,"contenteditable")},_u=xu("ephox-snooker"),Wu=_u.resolve,ju=function(){var n=ru({drag:eu(["xDelta","yDelta","target"])}),t=d.none(),e=function(){var n=ru({drag:eu(["xDelta","yDelta"])});return{mutate:function(t,e){n.trigger.drag(t,e)},events:n.registry}}();e.events.drag.bind((function(e){t.each((function(t){n.trigger.drag(e.xDelta(),e.yDelta(),t)}))}));return{assign:function(n){t=d.some(n)},get:function(){return t},mutate:e.mutate,events:n.registry}},zu=Wu("resizer-bar"),Fu=Wu("resizer-rows"),Lu=Wu("resizer-cols"),Hu=function(n){var t=qt(n.parent(),"."+zu);B(t,Mt)},qu=function(n,t,e){var r=n.origin();B(t,(function(t){t.each((function(t){var o=e(r,t);yu(o,zu),Bt(n.parent(),o)}))}))},Vu=function(n,t,e,r){qu(n,t,(function(n,t){var o,u,i,c,a,l,f=(o=t.col,u=t.x-n.left(),i=e.top()-n.top(),c=7,a=r,l=bn.fromTag("div"),Ct(l,{position:"absolute",left:u-c/2+"px",top:i+"px",height:a+"px",width:c+"px"}),on(l,{"data-column":o,role:"presentation"}),l);return yu(f,Lu),f}))},Uu=function(n,t,e,r){qu(n,t,(function(n,t){var o=function(n,t,e,r,o){var u=bn.fromTag("div");return Ct(u,{position:"absolute",left:t+"px",top:e-o/2+"px",height:o+"px",width:r+"px"}),on(u,{"data-row":n,role:"presentation"}),u}(t.row,e.left()-n.left(),t.y-n.top(),r,7);return yu(o,Fu),o}))},Ku=function(n,t,e,r){Hu(n);var o=me.fromTable(t);!function(n,t,e,r,o,u){var i=Er(t),c=e.length>0?o.positions(e,t):[];Uu(n,c,i,qr(t));var a=r.length>0?u.positions(r,t):[];Vu(n,a,i,Fr(t))}(n,t,uo(o),ro(o),e,r)},$u=function(n,t){var e=qt(n.parent(),"."+zu);B(e,t)},Xu=function(n){$u(n,(function(n){yt(n,"display","none")}))},Gu=function(n){$u(n,(function(n){yt(n,"display","block")}))},Yu=Wu("resizer-bar-dragging"),Ju=function(n,t,e){var r=ju(),o=function(n,t){void 0===t&&(t={});var e=void 0!==t.mode?t.mode:Pu;return Mu(n,e,t)}(r,{}),i=d.none(),c=function(n,t){return d.from(un(n,t))};r.events.drag.bind((function(n){c(n.target(),"data-row").each((function(t){var e=ne(n.target(),"top");yt(n.target(),"top",e+n.yDelta()+"px")})),c(n.target(),"data-column").each((function(t){var e=ne(n.target(),"left");yt(n.target(),"left",e+n.xDelta()+"px")}))}));var a=function(n,t){return ne(n,t)-Yt(n,"data-initial-"+t,0)};o.events.stop.bind((function(){r.get().each((function(r){i.each((function(o){c(r,"data-row").each((function(n){var t=a(r,"top");ln(r,"data-initial-top"),p.trigger.adjustHeight(o,t,parseInt(n,10))})),c(r,"data-column").each((function(n){var t=a(r,"left");ln(r,"data-initial-left"),p.trigger.adjustWidth(o,t,parseInt(n,10))})),Ku(n,o,e,t)}))}))}));var l=function(t,e){p.trigger.startAdjust(),r.assign(t),rn(t,"data-initial-"+e,ne(t,e)),yu(t,Yu),yt(t,"opacity","0.2"),o.go(n.parent())},f=pu(n.parent(),"mousedown",(function(n){var t;t=n.target(),Cu(t,Fu)&&l(n.target(),"top"),function(n){return Cu(n,Lu)}(n.target())&&l(n.target(),"left")})),s=function(t){return Zn(t,n.view())},m=function(n){return Gt(n,"table",s).filter((function(n){return function(n,t){return Gt(n,"[contenteditable]",t)}(n,s).exists(Nu)}))},g=pu(n.view(),"mouseover",(function(r){m(r.target()).fold((function(){vt(r.target())&&Hu(n)}),(function(r){i=d.some(r),Ku(n,r,e,t)}))})),p=ru({adjustHeight:eu(["table","delta","row"]),adjustWidth:eu(["table","delta","column"]),startAdjust:eu([])});return{destroy:function(){f.unbind(),g.unbind(),o.destroy(),Hu(n)},refresh:function(r){Ku(n,r,e,t)},on:o.on,off:o.off,hideBars:u(Xu,n),showBars:u(Gu,n),events:p.registry}},Qu=function(n,t,e){var r=no,o=Ju(n,t,r),u=ru({beforeResize:eu(["table"]),afterResize:eu(["table"]),startDrag:eu([])});return o.events.adjustHeight.bind((function(n){var t=n.table();u.trigger.beforeResize(t);var e=r.delta(n.delta(),t);fu(t,e,n.row(),r),u.trigger.afterResize(t)})),o.events.startAdjust.bind((function(n){u.trigger.startDrag()})),o.events.adjustWidth.bind((function(n){var r=n.table();u.trigger.beforeResize(r);var o=t.delta(n.delta(),r),i=e(r);!function(n,t,e,r,o){var u=o.getCellDelta(t),i=me.fromTable(n),c=o.getWidths(i,r,o),a=iu(c,e,u,o),l=A(a,(function(n,t){return n+c[t]})),f=au(i,l);B(f,(function(n){o.setElementWidth(n.element,n.width)})),e===i.grid.columns()-1&&o.adjustTableWidth(u)}(r,o,n.column(),t,i),u.trigger.afterResize(r)})),{on:o.on,off:o.off,hideBars:o.hideBars,showBars:o.showBars,destroy:o.destroy,events:u.registry}},Zu=function(n,t){return n.fire("newrow",{node:t})},ni=function(n,t){return n.fire("newcell",{node:t})},ti={"border-collapse":"collapse",width:"100%"},ei={border:"1"},ri=function(n){return n.getParam("table_sizing_mode","auto")},oi=function(n){return n.getParam("table_responsive_width")},ui=function(n){return n.getParam("table_default_attributes",ei,"object")},ii=function(n){return n.getParam("table_default_styles",function(n){if(di(n)){var t=n.getBody().offsetWidth;return wn(wn({},ti),{width:t+"px"})}return mi(n)?U(ti,(function(n,t){return"width"!==t})):ti}(n),"object")},ci=function(n){return n.getParam("table_cell_advtab",!0,"boolean")},ai=function(n){return n.getParam("table_row_advtab",!0,"boolean")},li=function(n){return n.getParam("table_advtab",!0,"boolean")},fi=function(n){return n.getParam("table_style_by_css",!1,"boolean")},si=function(n){return"relative"===ri(n)||!0===oi(n)},di=function(n){return"fixed"===ri(n)||!1===oi(n)},mi=function(n){return"responsive"===ri(n)},gi=function(n){var t="section",e=n.getParam("table_header_type",t,"string");return R(["section","cells","sectionCells","auto"],e)?e:t},pi=function(n){var t=n.getParam("table_clone_elements");return p(t)?d.some(t.split(/[ ,]/)):Array.isArray(t)?d.some(t):d.none()},hi=function(n){return n.nodeName.toLowerCase()},vi=function(n){return bn.fromDom(n.getBody())},bi=function(n){return n.getBoundingClientRect().width},wi=function(n){return n.getBoundingClientRect().height},yi=function(n){return function(t){return Zn(t,vi(n))}},Ci=function(n){return/^\d+(\.\d+)?$/.test(n)?n+"px":n},xi=function(n){ln(n,"data-mce-style"),B(ie(n),(function(n){return ln(n,"data-mce-style")}))},Si=function(n,t){var e=n.dom.getStyle(t,"width")||n.dom.getAttrib(t,"width");return d.from(e).filter(pn)},Ti=function(n){return/^(\d+(\.\d+)?)%$/.test(n)},Ri={isRtl:r(!1)},Oi={isRtl:r(!0)},Di=function(n){return"rtl"===function(n){return"rtl"===xt(n,"direction")?"rtl":"ltr"}(n)?Oi:Ri},Ai=function(n){var t=n;return{get:function(){return t},set:function(n){t=n}}},Bi=function(n){var t=function(){return Hr(n)},o=r(0);return{width:t,pixelWidth:t,getWidths:_o,getCellDelta:o,singleColumnWidth:r([0]),minCellWidth:o,setElementWidth:e,adjustTableWidth:e,label:"none"}},Ii=function(n,t){var e=Ai(parseFloat(n)),r=Ai(Hr(t));return{width:e.get,pixelWidth:r.get,getWidths:No,getCellDelta:function(n){return n/r.get()*100},singleColumnWidth:function(n,t){return[100-n]},minCellWidth:function(){return te()/r.get()*100},setElementWidth:vo,adjustTableWidth:function(n){var o=e.get(),u=o+n/100*o;vo(t,u),e.set(u),r.set(Hr(t))},label:"percent"}},Pi=function(n,t){var e=Ai(n),r=e.get;return{width:r,pixelWidth:r,getWidths:_o,getCellDelta:o,singleColumnWidth:function(n,t){return[Math.max(te(),n+t)-n]},minCellWidth:te,setElementWidth:ho,adjustTableWidth:function(n){var o=r()+n;ho(t,o),e.set(o)},label:"pixel"}},ki=function(n){return Co(n).fold((function(){return Bi(n)}),(function(t){return function(n,t){var e=Ao().exec(t);if(null!==e)return Ii(e[1],n);var r=Bo().exec(t);if(null!==r){var o=parseInt(r[1],10);return Pi(o,n)}var u=Hr(n);return Pi(u,n)}(n,t)}))},Ei=Pi,Mi=Ii,Ni=function(n,t){if(si(n)){var e=Si(n,t.dom()).filter(Ti).getOrThunk((function(){return Qo(t)}));return Mi(e,t)}return di(n)?Ei(Hr(t),t):ki(t)},_i=function(n){ln(n,"width")},Wi=function(n,t,e){var r=function(n){return Hr(n)+"px"}(n);Xo(n,d.some(r),d.none(),t,e),_i(n)},ji=function(n,t){!function(n,t,e){var r=Do(n);Xo(n,d.some(r),d.none(),t,e),_i(n)}(t,nu(Di),Ni(n,t))},zi=function(n,t){var e=nu(Di),r=Ni(n,t);Wi(t,e,r)},Fi=function(n){Rt(n,"width"),B(ie(n),(function(n){Rt(n,"width"),_i(n)})),_i(n)},Li=function(){var t=bn.fromTag("div");return Ct(t,{position:"static",height:"0",width:"0",padding:"0",margin:"0",border:"0"}),Bt(bt(bn.fromDom(n.document)),t),t},Hi=function(n){var t,e,r=d.none(),o=d.none(),u=d.none(),i=function(n){return"TABLE"===n.nodeName},c=function(){return o};return n.on("init",(function(){var t=nu(Di),e=function(n,t){return n.inline?_r(vi(n),Li()):Nr(bn.fromDom(n.getDoc()))}(n);if(u=d.some(e),function(n){var t=n.getParam("object_resizing",!0);return p(t)?"table"===t:t}(n)&&function(n){return n.getParam("table_resize_bars",!0,"boolean")}(n)){var i=Qu(e,t,(function(t){return Ni(n,t)}));i.on(),i.events.startDrag.bind((function(t){r=d.some(n.selection.getRng())})),i.events.beforeResize.bind((function(t){var e=t.table().dom();!function(n,t,e,r){n.fire("ObjectResizeStart",{target:t,width:e,height:r})}(n,e,bi(e),wi(e))})),i.events.afterResize.bind((function(t){var e=t.table(),o=e.dom();xi(e),r.each((function(t){n.selection.setRng(t),n.focus()})),function(n,t,e,r){n.fire("ObjectResized",{target:t,width:e,height:r})}(n,o,bi(o),wi(o)),n.undoManager.add()})),o=d.some(i)}})),n.on("ObjectResizeStart",(function(r){var o=r.target;if(i(o)){var u=bn.fromDom(o);!Yo(u)&&di(n)?zi(n,u):!Go(u)&&si(n)&&ji(n,u),t=r.width,e=Si(n,o).getOr("")}})),n.on("ObjectResized",(function(r){var o=r.target;if(i(o)){var u=bn.fromDom(o);if(""===e||!Ti(e)&&mi(n))ji(n,u);else if(Ti(e)){var c=parseFloat(e.replace("%","")),a=r.width*c/t;yt(u,"width",a+"%")}else!function(n){B(ie(n),(function(n){var t=xt(n,"width");yt(n,"width",t),ln(n,"width")}))}(u);xi(u)}})),n.on("SwitchMode",(function(){c().each((function(t){n.mode.isReadOnly()?t.hideBars():t.showBars()}))})),{lazyResize:c,lazyWire:function(){return u.getOr(Nr(bn.fromDom(n.getBody())))},destroy:function(){o.each((function(n){n.destroy()})),u.each((function(t){!function(n,t){n.inline&&Mt(t.parent())}(n,t)}))}}},qi=function(n,t){return{element:r(n),offset:r(t)}},Vi=function(n,t,e){return n.property().isText(t)&&0===n.property().getText(t).trim().length||n.property().isComment(t)?e(t).bind((function(t){return Vi(n,t,e).orThunk((function(){return d.some(t)}))})):d.none()},Ui=function(n,t){return n.property().isText(t)?n.property().getText(t).length:n.property().children(t).length},Ki=function(n,t){var e=Vi(n,t,n.query().prevSibling).getOr(t);if(n.property().isText(e))return qi(e,Ui(n,e));var r=n.property().children(e);return r.length>0?Ki(n,r[r.length-1]):qi(e,Ui(n,e))},$i=Ki,Xi=Xe(),Gi=function(n,t){(function(n){return Co(n).bind((function(n){var t=so.exec(n);return null!==t?d.some({width:r(parseFloat(t[1])),unit:r(t[3])}):d.none()}))})(n).each((function(e){var r=e.width()/2;Oo(n,r,e.unit()),Oo(t,r,e.unit())}))},Yi=function(n){return me.fromTable(n).grid},Ji=function(n){for(var t=[],e=function(n){t.push(n)},r=0;r<n.length;r++)n[r].each(e);return t},Qi=function(n,t,e,r){e===r?ln(n,t):rn(n,t,e)},Zi=function(n,t){var e=[],r=[],o=j(Ht(n,"caption,colgroup")).fold((function(){return u(At,n)}),(function(n){return u(Dt,n)})),i=function(t,u){t.length>0?function(t,u){var i=$t(n,u).getOrThunk((function(){var t=bn.fromTag(u,rt(n).dom());return"thead"===u?o(t):Bt(n,t),t}));Et(i);var c=A(t,(function(n){n.isNew()&&e.push(n.element());var t=n.element();return Et(t),B(n.cells(),(function(n){n.isNew()&&r.push(n.element()),Qi(n.element(),"colspan",n.colspan(),1),Qi(n.element(),"rowspan",n.rowspan(),1),Bt(t,n.element())})),t}));kt(i,c)}(t,u):function(t){$t(n,t).each(Mt)}(u)},c=[],a=[],l=[];return B(t,(function(n){switch(n.section()){case"thead":c.push(n);break;case"tbody":a.push(n);break;case"tfoot":l.push(n)}})),i(c,"thead"),i(a,"tbody"),i(l,"tfoot"),{newRows:e,newCells:r}},nc=function(n,t,e){n.cells()[t]=e},tc=function(n,t){return zt(t,n.section())},ec=function(n,t){var e=n.cells(),r=A(e,t);return zt(r,n.section())},rc=function(n,t){return n.cells()[t]},oc=function(n,t){return rc(n,t).element()},uc=function(n){return n.cells().length},ic=function(n,t){if(0===n.length)return 0;var e=n[0];return M(n,(function(n){return!t(e.element(),n.element())})).fold((function(){return n.length}),(function(n){return n}))},cc=function(n,t,e,r){var o=function(n,t){return n[t]}(n,t).cells().slice(e),u=ic(o,r),i=function(n,t){return A(n,(function(n){return rc(n,t)}))}(n,e).slice(t);return{colspan:u,rowspan:ic(i,r)}},ac=function(n,t){var e=A(n,(function(n){return A(n.cells(),(function(){return!1}))}));return A(n,(function(o,u){return function(n,t){return{details:r(n),section:r(t)}}(_(o.cells(),(function(o,i){if(!1===e[u][i]){var c=cc(n,u,i,t);return function(n,t,r,o){for(var u=n;u<n+r;u++)for(var i=t;i<t+o;i++)e[u][i]=!0}(u,i,c.rowspan,c.colspan),[(a=o.element(),l=c.rowspan,f=c.colspan,s=o.isNew(),{element:r(a),rowspan:r(l),colspan:r(f),isNew:r(s)})]}return[];var a,l,f,s})),o.section())}))},lc=function(n,t,e){for(var r=[],o=0;o<n.grid.rows();o++){for(var u=[],i=0;i<n.grid.columns();i++){var c=me.getAt(n,o,i).map((function(n){return jt(n.element(),e)})).getOrThunk((function(){return jt(t.gap(),!0)}));u.push(c)}var a=zt(u,n.all[o].section());r.push(a)}return r},fc=function(n,t){return A(n,(function(n){var e=function(n){return z(n,(function(n){return ot(n.element()).map((function(n){var t=ot(n).isNone();return jt(n,t)}))})).getOrThunk((function(){return jt(t.row(),!0)}))}(n.details());return function(n,t,e,o){return{element:r(n),cells:r(t),section:r(e),isNew:r(o)}}(e.element(),n.details(),n.section(),e.isNew())}))},sc=function(n,t){var e=ac(n,Zn);return fc(e,t)},dc=function(n,t){return z(n.all,(function(n){return E(n.cells(),(function(n){return Zn(t,n.element())}))}))},mc=function(n,t,e,o,u){return function(i,c,a,l,f,s){var m=me.fromTable(c);return t(m,a).map((function(t){var e=function(n,t){return lc(n,t,!1)}(m,l),o=n(e,t,Zn,u(l)),i=sc(o.grid(),l);return{grid:r(i),cursor:o.cursor}})).fold((function(){return d.none()}),(function(n){var t=Zi(c,n.grid()),u=d.from(s).getOrThunk((function(){return ki(c)}));return e(c,n.grid(),f,u),o(c),Ku(i,c,no,f),d.some({cursor:n.cursor,newRows:r(t.newRows),newCells:r(t.newCells)})}))}},gc=function(n,t){return ue(t.element()).bind((function(t){return dc(n,t)}))},pc=function(n,t){var e=A(t.selection(),(function(t){return ue(t).bind((function(t){return dc(n,t)}))})),r=Ji(e);return r.length>0?d.some({cells:r,generators:t.generators,clipboard:t.clipboard}):d.none()},hc=function(n,t){var e=A(t.selection(),(function(t){return ue(t).bind((function(t){return dc(n,t)}))})),r=Ji(e);return r.length>0?d.some(r):d.none()},vc=function(n,t,e,r){for(var o=!0,u=0;u<n.length;u++)for(var i=0;i<uc(n[0]);i++){var c=e(oc(n[u],i),t);!0===c&&!1===o?nc(n[u],i,jt(r(),!0)):!0===c&&(o=!1)}return n},bc=function(n,t,e,r){if(t>0&&t<n.length){var o=function(n,t){return k(n,(function(n,e){return O(n,(function(n){return t(n.element(),e.element())}))?n:n.concat([e])}),[])}(n[t-1].cells(),e);B(o,(function(o){for(var u=d.none(),i=function(t){for(var i=function(i){var c=n[t].cells()[i];e(c.element(),o.element())&&(u.isNone()&&(u=d.some(r())),u.each((function(e){nc(n[t],i,jt(e,!0))})))},c=0;c<uc(n[0]);c++)i(c)},c=t;c<n.length;c++)i(c)}))}return n},wc=function(n){return{is:function(t){return n===t},isValue:a,isError:c,getOr:r(n),getOrThunk:r(n),getOrDie:r(n),or:function(t){return wc(n)},orThunk:function(t){return wc(n)},fold:function(t,e){return e(n)},map:function(t){return wc(t(n))},mapError:function(t){return wc(n)},each:function(t){t(n)},bind:function(t){return t(n)},exists:function(t){return t(n)},forall:function(t){return t(n)},toOption:function(){return d.some(n)}}},yc=function(n){return{is:c,isValue:c,isError:a,getOr:o,getOrThunk:function(n){return n()},getOrDie:function(){return(t=String(n),function(){throw new Error(t)})();var t},or:function(n){return n},orThunk:function(n){return n()},fold:function(t,e){return t(n)},map:function(t){return yc(n)},mapError:function(t){return yc(t(n))},each:e,bind:function(t){return yc(n)},exists:c,forall:a,toOption:d.none}},Cc={value:wc,error:yc,fromOption:function(n,t){return n.fold((function(){return yc(t)}),wc)}},xc=function(n,t){return{rowDelta:0,colDelta:uc(n[0])-uc(t[0])}},Sc=function(n,t){return{rowDelta:n.length-t.length,colDelta:0}},Tc=function(n,t){return A(n,(function(){return jt(t.cell(),!0)}))},Rc=function(n,t,e){return n.concat(D(t,(function(){return tc(n[n.length-1],Tc(n[n.length-1].cells(),e))})))},Oc=function(n,t,e){return A(n,(function(n){return tc(n,n.cells().concat(Tc(D(t,o),e)))}))},Dc=function(n,t,e){var r=t.colDelta<0?Oc:o;return(t.rowDelta<0?Rc:o)(r(n,Math.abs(t.colDelta),e),Math.abs(t.rowDelta),e)},Ac=function(n,t,e,r){var o=u(r,rc(n[t],e).element()),i=n[t];return n.length>1&&uc(i)>1&&(e>0&&o(oc(i,e-1))||e<i.cells().length-1&&o(oc(i,e+1))||t>0&&o(oc(n[t-1],e))||t<n.length-1&&o(oc(n[t+1],e)))},Bc=function(n,t,e,r,o){return function(n,t,e){if(n.row()>=t.length||n.column()>uc(t[0]))return Cc.error("invalid start address out of table bounds, row: "+n.row()+", column: "+n.column());var r=t.slice(n.row()),o=r[0].cells().slice(n.column()),u=uc(e[0]),i=e.length;return Cc.value({rowDelta:r.length-i,colDelta:o.length-u})}(n,t,e).map((function(u){var i=Dc(t,u,r);return function(n,t,e,r,o){for(var u=n.row(),i=n.column(),c=u+e.length,a=i+uc(e[0]),l=u;l<c;l++)for(var f=i;f<a;f++){Ac(t,l,f,o)&&vc(t,oc(t[l],f),o,r.cell);var s=oc(e[l-u],f-i),d=r.replace(s);nc(t[l],f,jt(d,!0))}return t}(n,i,e,r,o)}))},Ic=function(n,t,e,r,o){!function(n,t,e,r){t>0&&t<n[0].cells().length&&B(n,(function(n){var o=n.cells()[t-1],u=n.cells()[t];e(u.element(),o.element())&&nc(n,t,jt(r(),!0))}))}(t,n,o,r.cell);var u=Sc(e,t),i=Dc(e,u,r),c=Sc(t,i),a=Dc(t,c,r);return A(a,(function(t,e){var r=t.cells().slice(0,n).concat(i[e].cells()).concat(t.cells().slice(n,t.cells().length));return tc(t,r)}))},Pc=function(n,t,e,r,o){bc(t,n,o,r.cell);var u=xc(e,t),i=Dc(e,u,r),c=xc(t,i),a=Dc(t,c,r);return a.slice(0,n).concat(i).concat(a.slice(n,a.length))},kc=function(n,t,e,r,o){var u=n.slice(0,t),i=n.slice(t),c=ec(n[e],(function(e,u){return t>0&&t<n.length&&r(oc(n[t-1],u),oc(n[t],u))?rc(n[t],u):jt(o(e.element(),r),!0)}));return u.concat([c]).concat(i)},Ec=function(n,t,e,r,o){return A(n,(function(n){var u=t>0&&t<uc(n)&&r(oc(n,t-1),oc(n,t))?rc(n,t):jt(o(oc(n,e),r),!0);return function(n,t,e){var r=n.cells(),o=r.slice(0,t),u=r.slice(t),i=o.concat([e]).concat(u);return tc(n,i)}(n,t,u)}))},Mc=function(n,t,e,r){return A(n,(function(n){return ec(n,(function(n){return function(n){return O(t,(function(t){return e(n.element(),t.element())}))}(n)?jt(r(n.element(),e),!0):n}))}))},Nc=function(n,t,e,r){return void 0!==oc(n[t],e)&&t>0&&r(oc(n[t-1],e),oc(n[t],e))},_c=function(n,t,e){return t>0&&e(oc(n,t-1),oc(n,t))},Wc=function(n,t,e,r){var o=_(n,(function(r,o){return Nc(n,o,t,e)||_c(r,t,e)?[]:[rc(r,t)]}));return Mc(n,o,e,r)},jc=function(n,t,e,r){var o=n[t],u=_(o.cells(),(function(r,u){return Nc(n,t,u,e)||_c(o,u,e)?[]:[r]}));return Mc(n,u,e,r)},zc=Du(["cell","row","replace","gap"]),Fc=function(n){var t=Yt(n,"colspan",1),e=Yt(n,"rowspan",1);return{element:r(n),colspan:r(t),rowspan:r(e)}},Lc=function(n,t){void 0===t&&(t=Fc),zc(n);var e=Ai(d.none()),r=function(e){return function(t){return n.cell(t)}(t(e))},o=function(n){var t=r(n);return e.get().isNone()&&e.set(d.some(t)),u=d.some({item:n,replacement:t}),t},u=d.none();return{getOrInit:function(n,t){return u.fold((function(){return o(n)}),(function(e){return t(n,e.item)?e.replacement:o(n)}))},cursor:e.get}},Hc=function(n,t){return function(e){var r=Ai(d.none());zc(e);var o=[],u=function(u){var i={scope:n},c=e.replace(u,t,i);return o.push({item:u,sub:c}),r.get().isNone()&&r.set(d.some(c)),c};return{replaceOrInit:function(n,t){return function(n,t){return E(o,(function(e){return t(e.item,n)}))}(n,t).fold((function(){return u(n)}),(function(e){return t(n,e.item)?e.sub:u(n)}))},cursor:r.get}}},qc=function(n){zc(n);var t=Ai(d.none());return{combine:function(e){return t.get().isNone()&&t.set(d.some(e)),function(){var t=n.cell({element:r(e),colspan:r(1),rowspan:r(1)});return Rt(t,"width"),Rt(e,"width"),t}},cursor:t.get}},Vc=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","table","thead","tfoot","tbody","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"],Uc=Xe(),Kc=function(n){return function(n,t){var e=n.property().name(t);return R(Vc,e)}(Uc,n)},$c=function(n){return function(n,t){var e=n.property().name(t);return R(["ol","ul"],e)}(Uc,n)},Xc=function(n){return function(n,t){return R(["br","img","hr","input"],n.property().name(t))}(Uc,n)},Gc=function(n){var t,e=function(n){return"br"===X(n)},r=function(n){return Te(n).bind((function(t){var r=ct(t).map((function(n){return!!Kc(n)||!!Xc(n)&&"img"!==X(n)})).getOr(!1);return ot(t).map((function(o){return!0===r||function(n){return"li"===X(n)||Ut(n,$c).isSome()}(o)||e(t)||Kc(o)&&!Zn(n,o)?[]:[bn.fromTag("br")]}))})).getOr([])},o=0===(t=_(n,(function(n){var t=at(n);return function(n){return W(n,(function(n){return e(n)||Z(n)&&0===ve(n).trim().length}))}(t)?[]:t.concat(r(n))}))).length?[bn.fromTag("br")]:t;Et(n[0]),kt(n[0],o)},Yc=function(n){0===ie(n).length&&Mt(n)},Jc=function(n,t){return{grid:r(n),cursor:r(t)}},Qc=function(n,t,e){return Zc(n,t,e).orThunk((function(){return Zc(n,0,0)}))},Zc=function(n,t,e){return d.from(n[t]).bind((function(n){return d.from(n.cells()[e]).bind((function(n){return d.from(n.element())}))}))},na=function(n,t,e){return Jc(n,Zc(n,t,e))},ta=function(n){return k(n,(function(n,t){return O(n,(function(n){return n.row()===t.row()}))?n:n.concat([t])}),[]).sort((function(n,t){return n.row()-t.row()}))},ea=function(n){return k(n,(function(n,t){return O(n,(function(n){return n.column()===t.column()}))?n:n.concat([t])}),[]).sort((function(n,t){return n.column()-t.column()}))},ra=function(n,t,e){var r=function(n,t){return A(n,(function(n){var e=A(ie(n),(function(n){var t=Yt(n,"rowspan",1),e=Yt(n,"colspan",1);return _t(n,t,e)}));return Wt(n,e,t.section())}))}(n,e),o=me.generate(r);return lc(o,t,!0)},oa=function(n,t){var e=I(n,t);return 0===e.length?d.some("td"):e.length===n.length?d.some("th"):d.none()},ua=function(n,t,e,r){var o=me.generate(t),u=r.getWidths(o,e,r),i=au(o,u);B(i,(function(n){r.setElementWidth(n.element,n.width)}))},ia=mc((function(n,t,e,r){var o=t[0].row(),u=t[0].row(),i=ta(t),c=k(i,(function(n,t){return kc(n,u,o,e,r.getOrInit)}),n);return na(c,u,t[0].column())}),hc,e,e,Lc),ca=mc((function(n,t,e,r){var o=ta(t),u=o[o.length-1].row(),i=o[o.length-1].row()+o[o.length-1].rowspan(),c=k(o,(function(n,t){return kc(n,i,u,e,r.getOrInit)}),n);return na(c,i,t[0].column())}),hc,e,e,Lc),aa=mc((function(n,t,e,r){var o=ea(t),u=o[0].column(),i=o[0].column(),c=k(o,(function(n,t){return Ec(n,i,u,e,r.getOrInit)}),n);return na(c,t[0].row(),i)}),hc,ua,e,Lc),la=mc((function(n,t,e,r){var o=t[t.length-1].column(),u=t[t.length-1].column()+t[t.length-1].colspan(),i=ea(t),c=k(i,(function(n,t){return Ec(n,u,o,e,r.getOrInit)}),n);return na(c,t[0].row(),u)}),hc,ua,e,Lc),fa=mc((function(n,t,e,r){var o=ea(t),u=function(n,t,e){var r=A(n,(function(n){var r=n.cells().slice(0,t).concat(n.cells().slice(e+1));return zt(r,n.section())}));return I(r,(function(n){return n.cells().length>0}))}(n,o[0].column(),o[o.length-1].column()),i=Qc(u,t[0].row(),t[0].column());return Jc(u,i)}),hc,ua,Yc,Lc),sa=mc((function(n,t,e,r){var o=ta(t),u=function(n,t,e){return n.slice(0,t).concat(n.slice(e+1))}(n,o[0].row(),o[o.length-1].row()),i=Qc(u,t[0].row(),t[0].column());return Jc(u,i)}),hc,e,Yc,Lc),da=mc((function(n,t,e,r){var o=Wc(n,t.column(),e,r.replaceOrInit);return na(o,t.row(),t.column())}),gc,e,e,Hc("row","th")),ma=mc((function(n,t,e,r){var o=Wc(n,t.column(),e,r.replaceOrInit);return na(o,t.row(),t.column())}),gc,e,e,Hc(null,"td")),ga=(mc((function(n,t,e,r){var o=jc(n,t.row(),e,r.replaceOrInit);return na(o,t.row(),t.column())}),gc,e,e,Hc("col","th")),mc((function(n,t,e,r){var o=jc(n,t.row(),e,r.replaceOrInit);return na(o,t.row(),t.column())}),gc,e,e,Hc(null,"td")),mc((function(n,t,e,o){var u=t.cells();Gc(u);var i=function(n,t,e,r){if(0===n.length)return n;for(var o=t.startRow();o<=t.finishRow();o++)for(var u=t.startCol();u<=t.finishCol();u++)nc(n[o],u,jt(r(),!1));return n}(n,t.bounds(),0,r(u[0]));return Jc(i,d.from(u[0]))}),(function(n,t){return t.mergable()}),e,e,qc)),pa=mc((function(n,t,e,r){var o=P(t,(function(n,t){return vc(n,t,e,r.combine(t))}),n);return Jc(o,d.from(t[0]))}),(function(n,t){return t.unmergable()}),ua,e,qc),ha=mc((function(n,t,e,o){var u=function(n,t){var e=me.fromTable(n);return lc(e,t,!0)}(t.clipboard(),t.generators()),i=function(n,t){return{row:r(n),column:r(t)}}(t.row(),t.column());return Bc(i,n,u,t.generators(),e).fold((function(){return Jc(n,d.some(t.element()))}),(function(n){var e=Qc(n,t.row(),t.column());return Jc(n,e)}))}),(function(n,t){return ue(t.element()).bind((function(e){return dc(n,e).map((function(n){return wn(wn({},n),{generators:t.generators,clipboard:t.clipboard})}))}))}),ua,e,Lc),va=mc((function(n,t,e,r){var o=n[t.cells[0].row()],u=t.cells[0].column(),i=ra(t.clipboard(),t.generators(),o),c=Ic(u,n,i,t.generators(),e),a=Qc(c,t.cells[0].row(),t.cells[0].column());return Jc(c,a)}),pc,e,e,Lc),ba=mc((function(n,t,e,r){var o=n[t.cells[0].row()],u=t.cells[t.cells.length-1].column()+t.cells[t.cells.length-1].colspan(),i=ra(t.clipboard(),t.generators(),o),c=Ic(u,n,i,t.generators(),e),a=Qc(c,t.cells[0].row(),t.cells[0].column());return Jc(c,a)}),pc,e,e,Lc),wa=mc((function(n,t,e,r){var o=n[t.cells[0].row()],u=t.cells[0].row(),i=ra(t.clipboard(),t.generators(),o),c=Pc(u,n,i,t.generators(),e),a=Qc(c,t.cells[0].row(),t.cells[0].column());return Jc(c,a)}),pc,e,e,Lc),ya=mc((function(n,t,e,r){var o=n[t.cells[0].row()],u=t.cells[t.cells.length-1].row()+t.cells[t.cells.length-1].rowspan(),i=ra(t.clipboard(),t.generators(),o),c=Pc(u,n,i,t.generators(),e),a=Qc(c,t.cells[0].row(),t.cells[0].column());return Jc(c,a)}),pc,e,e,Lc),Ca=function(n,t){var e=me.fromTable(n);return hc(e,t).bind((function(n){var t=n[n.length-1],r=n[0].column(),o=t.column()+t.colspan(),u=N(A(e.all,(function(n){return I(n.cells(),(function(n){return n.column()>=r&&n.column()<o}))})));return oa(u,(function(n){return"th"===X(n.element())}))})).getOr("")},xa=function(n){return hi(n.parentNode)},Sa=function(n,t){var e="thead"===xa(t),r=!O(t.cells,(function(n){return"th"!==hi(n)}));return e||r?d.some({thead:e,ths:r}):d.none()},Ta=function(n,t){return"thead"===(e=Sa(0,t).fold((function(){return xa(t)}),(function(n){return"thead"})))?"header":"tfoot"===e?"footer":"body";var e},Ra=function(n,t,e){var r=n.getParent(t,"table"),o=t.parentNode,u=hi(o);if(e!==u){var i=n.select(e,r)[0];if(!i){i=n.create(e);var c=r.firstChild;"thead"===e?j(Ht(bn.fromDom(r),"caption,colgroup")).fold((function(){return r.insertBefore(i,c)}),(function(t){return n.insertAfter(i,t.dom())})):r.appendChild(i)}"tbody"===e&&"thead"===u&&i.firstChild?i.insertBefore(t,i.firstChild):i.appendChild(t),o.hasChildNodes()||n.remove(o)}},Oa=function(n,t,e,r){return B(t,(function(t){var o=hi(t)!==e?n.rename(t,e):t;n.setAttrib(o,"scope",r)}))},Da=function(n,t,e){var r,o=n.dom;if("header"===e){var u=gi(n),i="auto"===u?(r=ce(bn.fromDom(t.cells[0])).map((function(n){return ae(n)})).getOr([]),z(r,(function(n){return Sa(0,n.dom())})).map((function(n){return n.thead&&n.ths?"sectionCells":n.thead?"section":"cells"})).getOr("section")):u;Oa(o,t.cells,"section"===i?"td":"th","col"),Ra(o,t,"cells"===i?"tbody":"thead")}else Oa(o,t.cells,"td",null),Ra(o,t,"footer"===e?"tfoot":"tbody")},Aa=function(n){return{get:function(){var t,e,r=vi(n);return(t=r,e=sr,rr(t,e)).fold((function(){return void 0===n.selection.getStart()?Cr():Sr(n.selection)}),(function(n){return xr(n)}))}}},Ba=function(n){return function(t){return d.from(t.dom.getParent(t.selection.getStart(),n)).map((function(n){return bn.fromDom(n)}))}},Ia=Ba("th,td"),Pa=Ba("th,td,caption"),ka=function(n){return Ia(n).map((function(t){return Tr(t,Aa(n))})).map((function(n){return A(n,(function(n){return n.dom()}))})).getOr([])},Ea=function(n){var t,e,r,o=Ia(n),u=o.bind((function(n){return ce(n)})).map((function(n){return ae(n)})).map((function(n){return A(n,(function(n){return n.dom()}))}));return(t=o,e=u,r=function(t,e){return I(e,(function(e){return O(e.cells,(function(e){return"1"===n.dom.getAttrib(e,fr)||e===t.dom()}))}))},t.isSome()&&e.isSome()?d.some(r(t.getOrDie(),e.getOrDie())):d.none()).getOr([])},Ma=function(n,t){var r=function(n){return"table"===X(vi(n))},o=pi(n),u=function(t,e,r,u){return function(i,c){xi(i);var a=u(),l=bn.fromDom(n.getDoc()),f=nu(Di),s=Me(r,l,o),m=Ni(n,i);return e(i)?t(a,i,c,s,f,m).bind((function(t){return B(t.newRows(),(function(t){Zu(n,t.dom())})),B(t.newCells(),(function(t){ni(n,t.dom())})),t.cursor().map((function(t){var e=$i(Xi,t),r=n.dom.createRng();return r.setStart(e.element().dom(),e.offset()),r.setEnd(e.element().dom(),e.offset()),r}))})):d.none()}},i=u(sa,(function(t){return!1===r(n)||Yi(t).rows()>1}),e,t),c=u(fa,(function(t){return!1===r(n)||Yi(t).columns()>1}),e,t),l=u(ia,a,e,t),f=u(ca,a,e,t),s=u(aa,a,Gi,t),m=u(la,a,Gi,t),g=u(ga,a,e,t),p=u(pa,a,e,t),h=u(va,a,e,t),v=u(ba,a,e,t),b=u(wa,a,e,t),w=u(ya,a,e,t),y=u(ha,a,e,t),C=function(n,t){return K(n,"type").filter((function(n){return R(t,n)}))};return{deleteRow:i,deleteColumn:c,insertRowsBefore:l,insertRowsAfter:f,insertColumnsBefore:s,insertColumnsAfter:m,mergeCells:g,unmergeCells:p,pasteColsBefore:h,pasteColsAfter:v,pasteRowsBefore:b,pasteRowsAfter:w,pasteCells:y,setTableCellType:function(n,t){return C(t,["td","th"]).each((function(t){Oa(n.dom,ka(n),t,null)}))},setTableRowType:function(n,t){return C(t,["header","body","footer"]).each((function(t){A(Ea(n),(function(e){return Da(n,e,t)}))}))},makeColumnHeader:u(da,a,e,t),unmakeColumnHeader:u(ma,a,e,t),getTableRowType:function(n){var t=Ea(n);if(t.length>0){var e=A(t,(function(n){return Ta(0,n)})),r=R(e,"header"),o=R(e,"footer");if(r||o){var u=R(e,"body");return!r||u||o?r||u||!o?"":"footer":"header"}return"body"}},getTableCellType:function(n){return oa(ka(n),(function(n){return"th"===hi(n)})).getOr("")},getTableColType:Ca}},Na={styles:{"border-collapse":"collapse",width:"100%"},attributes:{border:"1"}},_a=function(n,t,e,r){return D(n,(function(n){return function(n,t,e,r){for(var o=bn.fromTag("tr"),u=0;u<n;u++){var i=r<t||u<e?bn.fromTag("th"):bn.fromTag("td");u<e&&rn(i,"scope","row"),r<t&&rn(i,"scope","col"),Bt(i,bn.fromTag("br")),Bt(o,i)}return o}(t,e,r,n)}))},Wa=function(n,t){n.selection.select(t.dom(),!0),n.selection.collapse(!0)},ja=function(n,t,e,r,o){var i=ii(n),c={styles:i,attributes:ui(n)},a=function(n,t,e,r,o,u){void 0===u&&(u=Na);var i=bn.fromTag("table"),c="cells"!==o;Ct(i,u.styles),on(i,u.attributes);var a=Math.min(n,e);if(c&&e>0){var l=bn.fromTag("thead");Bt(i,l);var f=_a(e,t,"sectionCells"===o?a:0,r);kt(l,f)}var s=bn.fromTag("tbody");Bt(i,s);var d=_a(c?n-a:n,t,c?0:e,r);return kt(s,d),i}(e,t,o,r,gi(n),c);rn(a,"data-mce-id","__mce");var l=function(n){var t=bn.fromTag("div"),e=bn.fromDom(n.dom().cloneNode(!0));return Bt(t,e),function(n){return n.dom().innerHTML}(t)}(a);return n.insertContent(l),Xt(vi(n),'table[data-mce-id="__mce"]').map((function(t){var e;return di(n)?zi(n,t):mi(n)?Fi(t):(si(n)||(e=i.width,p(e)&&-1!==e.indexOf("%")))&&ji(n,t),xi(t),ln(t,"data-mce-id"),function(n,t){B(qt(t,"tr"),(function(t){Zu(n,t.dom()),B(qt(t,"th,td"),(function(t){ni(n,t.dom())}))}))}(n,t),function(n,t){Xt(t,"td,th").each(u(Wa,n))}(n,t),t.dom()})).getOr(null)},za=function(n,t,e,r,o){void 0===r&&(r={});var u=function(n){return C(n)&&n>0};if(u(t)&&u(e)){var i=r.headerRows||0,c=r.headerColumns||0;return ja(n,e,t,c,i)}return console.error(o),null},Fa=function(n){return function(){return n().fold((function(){return[]}),(function(n){return A(n,(function(n){return n.dom()}))}))}},La=function(n){return function(t){var e=t.length>0?d.some(A(t,bn.fromDom)):d.none();n(e)}},Ha=function(n,t){var e=me.fromTable(n);return hc(e,t).map((function(n){var t=n[n.length-1],r=n[0].column(),o=t.column()+t.colspan();return A(e.all,(function(n){var t=I(n.cells(),(function(n){return n.column()>=r&&n.column()<o})),e=A(t,(function(n){var t=Ae(n.element());return function(n,t,e){var r=Jt(n,t);1===e||r<=1?ln(n,t):rn(n,t,Math.min(e,r))}(t,"colspan",o-r),t})),u=bn.fromTag("tr");return kt(u,e),u}))}))},qa=function(n,t,e){var r=me.fromTable(n);return hc(r,t).map((function(n){var t=lc(r,e,!1).slice(n[0].row(),n[n.length-1].row()+n[n.length-1].rowspan());return function(n){return A(n,(function(n){var t=De(n.element());return B(n.cells(),(function(n){var e=Ae(n.element());Qi(e,"colspan",n.colspan(),1),Qi(e,"rowspan",n.rowspan(),1),Bt(t,e)})),t}))}(sc(t,e))}))},Va=tinymce.util.Tools.resolve("tinymce.util.Tools"),Ua=function(n,t,e){return function(t,r){for(var o=0;o<r.length;o++){var u=n.getStyle(r[o],e);if(void 0===t&&(t=u),t!==u)return""}return t}(undefined,n.select("td,th",t))},Ka=function(n,t,e){e&&n.formatter.apply("align"+e,{},t)},$a=function(n,t){Va.each("left center right".split(" "),(function(e){n.formatter.remove("align"+e,{},t)}))},Xa=function(n,t){var e;return e=n,(t||[]).concat(A(e,(function(n){return{text:n.text||n.title,value:n.value}})))},Ga=function(n){return function(t){return sn(t,"rgb",0)?n.toHex(t):t}},Ya=function(n,t){var e=bn.fromDom(t);return{borderwidth:Tt(e,"border-width").getOr(""),borderstyle:Tt(e,"border-style").getOr(""),bordercolor:Tt(e,"border-color").map(Ga(n)).getOr(""),backgroundcolor:Tt(e,"background-color").map(Ga(n)).getOr("")}},Ja=function(n){var t=n[0],e=n.slice(1);return B(e,(function(n){B(F(t),(function(e){H(n,(function(n,r){var o=t[e];""!==o&&e===r&&o!==n&&(t[e]="")}))}))})),t},Qa=function(n){var t=[{name:"borderstyle",type:"selectbox",label:"Border style",items:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]},{name:"bordercolor",type:"colorinput",label:"Border color"},{name:"backgroundcolor",type:"colorinput",label:"Background color"}];return{title:"Advanced",name:"advanced",items:"cell"===n?[{name:"borderwidth",type:"input",label:"Border width"}].concat(t):t}},Za=function(n,t,e,r){return E(n,(function(n){return e.formatter.matchNode(r,t+n)})).getOr("")},nl=u(Za,["left","center","right"],"align"),tl=u(Za,["top","middle","bottom"],"valign"),el=[{name:"width",type:"input",label:"Width"},{name:"height",type:"input",label:"Height"},{name:"celltype",type:"selectbox",label:"Cell type",items:[{text:"Cell",value:"td"},{text:"Header cell",value:"th"}]},{name:"scope",type:"selectbox",label:"Scope",items:[{text:"None",value:""},{text:"Row",value:"row"},{text:"Column",value:"col"},{text:"Row group",value:"rowgroup"},{text:"Column group",value:"colgroup"}]},{name:"halign",type:"selectbox",label:"H Align",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{name:"valign",type:"selectbox",label:"V Align",items:[{text:"None",value:""},{text:"Top",value:"top"},{text:"Middle",value:"middle"},{text:"Bottom",value:"bottom"}]}],rl=function(n){return function(n){var t=Xa(function(n){return n.getParam("table_cell_class_list",[],"array")}(n));return t.length>0?d.some({name:"class",type:"selectbox",label:"Class",items:t}):d.none()}(n).fold((function(){return el}),(function(n){return el.concat(n)}))},ol=function(n){return function(t,e){var r=t.dom;return{setAttrib:function(t,o){n&&!o||r.setAttrib(e,t,o)},setStyle:function(t,o){n&&!o||r.setStyle(e,t,o)},setFormat:function(r,o){n&&!o||(""===o?t.formatter.remove(r,{value:null},e,!0):t.formatter.apply(r,{value:o},e))}}}},ul={normal:ol(!1),ifTruthy:ol(!0)},il=function(n,t,e){var r=n.dom,o=1===t.length;B(t,(function(t){var u=e.celltype&&hi(t)!==e.celltype?r.rename(t,e.celltype):t,i=o?ul.normal(n,u):ul.ifTruthy(n,u);!function(n,t){n.setAttrib("scope",t.scope),n.setAttrib("class",t.class),n.setStyle("width",Ci(t.width)),n.setStyle("height",Ci(t.height))}(i,e),ci(n)&&function(n,t){n.setFormat("tablecellbackgroundcolor",t.backgroundcolor),n.setFormat("tablecellbordercolor",t.bordercolor),n.setFormat("tablecellborderstyle",t.borderstyle),n.setFormat("tablecellborderwidth",Ci(t.borderwidth))}(i,e),o&&($a(n,u),function(n,t){Va.each("top middle bottom".split(" "),(function(e){n.formatter.remove("valign"+e,{},t)}))}(n,u)),e.halign&&Ka(n,u,e.halign),e.valign&&function(n,t,e){e&&n.formatter.apply("valign"+e,{},t)}(n,u,e.valign)}))},cl=function(n,t,e){var r=e.getData();e.close(),n.undoManager.transact((function(){il(n,t,r),n.focus()}))},al=function(n){var t=ka(n);if(0!==t.length){var e=A(t,(function(t){return function(n,t,e){var r=n.dom;return wn({width:r.getStyle(t,"width")||r.getAttrib(t,"width"),height:r.getStyle(t,"height")||r.getAttrib(t,"height"),scope:r.getAttrib(t,"scope"),celltype:hi(t),class:r.getAttrib(t,"class",""),halign:nl(n,t),valign:tl(n,t)},e?Ya(r,t):{})}(n,t,ci(n))})),r=Ja(e),o={type:"tabpanel",tabs:[{title:"General",name:"general",items:rl(n)},Qa("cell")]},i={type:"panel",items:[{type:"grid",columns:2,items:rl(n)}]};n.windowManager.open({title:"Cell Properties",size:"normal",body:ci(n)?o:i,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:r,onSubmit:u(cl,n,t)})}},ll=[{type:"selectbox",name:"type",label:"Row type",items:[{text:"Header",value:"header"},{text:"Body",value:"body"},{text:"Footer",value:"footer"}]},{type:"selectbox",name:"align",label:"Alignment",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"Height",name:"height",type:"input"}],fl=function(n){return function(n){var t=Xa(function(n){return n.getParam("table_row_class_list",[],"array")}(n));return t.length>0?d.some({name:"class",type:"selectbox",label:"Class",items:t}):d.none()}(n).fold((function(){return ll}),(function(n){return ll.concat(n)}))},sl=function(n,t,e,r){var o=1===t.length;B(t,(function(t){r.type!==hi(t.parentNode)&&Da(n,t,r.type);var u=o?ul.normal(n,t):ul.ifTruthy(n,t);!function(n,t){n.setAttrib("scope",t.scope),n.setAttrib("class",t.class),n.setStyle("height",Ci(t.height))}(u,r),ai(n)&&function(n,t){n.setStyle("background-color",t.backgroundcolor),n.setStyle("border-color",t.bordercolor),n.setStyle("border-style",t.borderstyle)}(u,r),r.align!==e.align&&($a(n,t),Ka(n,t,r.align))}))},dl=function(n,t,e,r){var o=r.getData();r.close(),n.undoManager.transact((function(){sl(n,t,e,o),n.focus()}))},ml=function(n){var t=Ea(n);if(0!==t.length){var e=A(t,(function(t){return function(n,t,e){var r=n.dom;return wn({height:r.getStyle(t,"height")||r.getAttrib(t,"height"),scope:r.getAttrib(t,"scope"),class:r.getAttrib(t,"class",""),type:Ta(0,t),align:nl(n,t)},e?Ya(r,t):{})}(n,t,ai(n))})),r=Ja(e),o={type:"tabpanel",tabs:[{title:"General",name:"general",items:fl(n)},Qa("row")]},i={type:"panel",items:[{type:"grid",columns:2,items:fl(n)}]};n.windowManager.open({title:"Row Properties",size:"normal",body:ai(n)?o:i,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:r,onSubmit:u(dl,n,t,r)})}},gl=tinymce.util.Tools.resolve("tinymce.Env"),pl=function(n,t,e){var r=e?[{type:"input",name:"cols",label:"Cols",inputMode:"numeric"},{type:"input",name:"rows",label:"Rows",inputMode:"numeric"}]:[],o=function(n){return n.getParam("table_appearance_options",!0,"boolean")}(n)?[{type:"input",name:"cellspacing",label:"Cell spacing",inputMode:"numeric"},{type:"input",name:"cellpadding",label:"Cell padding",inputMode:"numeric"},{type:"input",name:"border",label:"Border width"},{type:"label",label:"Caption",items:[{type:"checkbox",name:"caption",label:"Show caption"}]}]:[],u=t.length>0?[{type:"selectbox",name:"class",label:"Class",items:t}]:[];return r.concat([{type:"input",name:"width",label:"Width"},{type:"input",name:"height",label:"Height"}]).concat(o).concat([{type:"selectbox",name:"align",label:"Alignment",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]}]).concat(u)},hl=function(n,t,e,r){if("TD"===t.tagName||"TH"===t.tagName)p(e)?n.setStyle(t,e,r):n.setStyle(t,e);else if(t.children)for(var o=0;o<t.children.length;o++)hl(n,t.children[o],e,r)},vl=function(n,t,e){var r,o=n.dom,u=e.getData();e.close(),""===u.class&&delete u.class,n.undoManager.transact((function(){if(!t){var e=parseInt(u.cols,10)||1,i=parseInt(u.rows,10)||1;t=ja(n,e,i,0,0)}!function(n,t,e){var r,o=n.dom,u={},i={};if(u.class=e.class,i.height=Ci(e.height),o.getAttrib(t,"width")&&!fi(n)?u.width=(r=e.width)?r.replace(/px$/,""):"":i.width=Ci(e.width),fi(n)?(i["border-width"]=Ci(e.border),i["border-spacing"]=Ci(e.cellspacing)):(u.border=e.border,u.cellpadding=e.cellpadding,u.cellspacing=e.cellspacing),fi(n)&&t.children)for(var c=0;c<t.children.length;c++)hl(o,t.children[c],{"border-width":Ci(e.border),padding:Ci(e.cellpadding)}),li(n)&&hl(o,t.children[c],{"border-color":e.bordercolor});li(n)&&(i["background-color"]=e.backgroundcolor,i["border-color"]=e.bordercolor,i["border-style"]=e.borderstyle),u.style=o.serializeStyle(wn(wn({},ii(n)),i)),o.setAttribs(t,wn(wn({},ui(n)),u))}(n,t,u),(r=o.select("caption",t)[0])&&!u.caption&&o.remove(r),!r&&u.caption&&((r=o.create("caption")).innerHTML=gl.ie?" ":'<br data-mce-bogus="1"/>',t.insertBefore(r,t.firstChild)),""===u.align?$a(n,t):Ka(n,t,u.align),n.focus(),n.addVisual()}))},bl=function(n,t){var e,r=n.dom,o=function(n,t){var e,r,o,u,i=ii(n),c=ui(n),a=t?(e=n.dom,{borderstyle:K(i,"border-style").getOr(""),bordercolor:Ga(e)(K(i,"border-color").getOr("")),backgroundcolor:Ga(e)(K(i,"background-color").getOr(""))}):{};return wn(wn(wn(wn(wn(wn({},{height:"",width:"100%",cellspacing:"",cellpadding:"",caption:!1,class:"",align:"",border:""}),i),c),a),(u=i["border-width"],fi(n)&&u?{border:u}:K(c,"border").fold((function(){return{}}),(function(n){return{border:n}})))),(r=K(i,"border-spacing").or(K(c,"cellspacing")).fold((function(){return{}}),(function(n){return{cellspacing:n}})),o=K(i,"border-padding").or(K(c,"cellpadding")).fold((function(){return{}}),(function(n){return{cellpadding:n}})),wn(wn({},r),o)))}(n,li(n));!1===t?(e=r.getParent(n.selection.getStart(),"table"))?o=function(n,t,e){var r=n.dom;return wn({width:r.getStyle(t,"width")||r.getAttrib(t,"width"),height:r.getStyle(t,"height")||r.getAttrib(t,"height"),cellspacing:r.getStyle(t,"border-spacing")||r.getAttrib(t,"cellspacing"),cellpadding:r.getAttrib(t,"cellpadding")||Ua(n.dom,t,"padding"),border:function(t,e){var r=Tt(bn.fromDom(e),"border-width");return fi(n)&&r.isSome()?r.getOr(""):t.getAttrib(e,"border")||Ua(n.dom,e,"border-width")||Ua(n.dom,e,"border")}(r,t),caption:!!r.select("caption",t)[0],class:r.getAttrib(t,"class",""),align:nl(n,t)},e?Ya(r,t):{})}(n,e,li(n)):li(n)&&(o.borderstyle="",o.bordercolor="",o.backgroundcolor=""):(o.cols="1",o.rows="1",li(n)&&(o.borderstyle="",o.bordercolor="",o.backgroundcolor=""));var i=Xa(function(n){return n.getParam("table_class_list",[],"array")}(n));i.length>0&&o.class&&(o.class=o.class.replace(/\s*mce\-item\-table\s*/g,""));var c={type:"grid",columns:2,items:pl(n,i,t)},a=li(n)?{type:"tabpanel",tabs:[{title:"General",name:"general",items:[c]},Qa("table")]}:{type:"panel",items:[c]};n.windowManager.open({title:"Table Properties",size:"normal",body:a,onSubmit:u(vl,n,e),buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:o})},wl=function(n,t,o,c,a){var l=yi(n),f=function(n){return ce(n,l)},s=function(t){return Ia(n).each((function(e){f(e).each((function(r){var u=Ar(c,r,e);t(r,u).each((function(t){n.selection.setRng(t),n.focus(),o.clear(r),xi(r)}))}))}))},m=function(){return Ia(n).map((function(t){return f(t).bind((function(r){var o=Ar(c,r,t),u=Me(e,bn.fromDom(n.getDoc()),d.none());return qa(r,o,u)}))}))},g=function(){return Ia(n).map((function(n){return f(n).bind((function(t){var e=Ar(c,t,n);return Ha(t,e)}))}))},v=function(t,e){return e().each((function(e){var u=A(e,(function(n){return Ae(n)}));Ia(n).each((function(e){return f(e).each((function(i){var a=Ne(bn.fromDom(n.getDoc())),l=function(n,t,e,o){return{selection:r(Tr(t,n)),clipboard:r(e),generators:r(o)}}(c,e,u,a);t(i,l).each((function(t){n.selection.setRng(t),n.focus(),o.clear(i)}))}))}))}))};H({mceTableSplitCells:function(){return s(t.unmergeCells)},mceTableMergeCells:function(){return s(t.mergeCells)},mceTableInsertRowBefore:function(){return s(t.insertRowsBefore)},mceTableInsertRowAfter:function(){return s(t.insertRowsAfter)},mceTableInsertColBefore:function(){return s(t.insertColumnsBefore)},mceTableInsertColAfter:function(){return s(t.insertColumnsAfter)},mceTableDeleteCol:function(){return s(t.deleteColumn)},mceTableDeleteRow:function(){return s(t.deleteRow)},mceTableCutCol:function(n){return g().each((function(n){a.setColumns(n),s(t.deleteColumn)}))},mceTableCutRow:function(n){return m().each((function(n){a.setRows(n),s(t.deleteRow)}))},mceTableCopyCol:function(n){return g().each((function(n){return a.setColumns(n)}))},mceTableCopyRow:function(n){return m().each((function(n){return a.setRows(n)}))},mceTablePasteColBefore:function(n){return v(t.pasteColsBefore,a.getColumns)},mceTablePasteColAfter:function(n){return v(t.pasteColsAfter,a.getColumns)},mceTablePasteRowBefore:function(n){return v(t.pasteRowsBefore,a.getRows)},mceTablePasteRowAfter:function(n){return v(t.pasteRowsAfter,a.getRows)},mceTableDelete:function(){return Pa(n).each((function(t){ce(t,l).filter(i(l)).each((function(t){var e=bn.fromText("");if(Dt(t,e),Mt(t),n.dom.isEmpty(n.getBody()))n.setContent(""),n.selection.setCursorLocation();else{var r=n.dom.createRng();r.setStart(e.dom(),0),r.setEnd(e.dom(),0),n.selection.setRng(r),n.nodeChanged()}}))}))},mceTableSizingMode:function(t,e){return function(t){return Pa(n).each((function(e){mi(n)||di(n)||si(n)||ce(e,l).each((function(e){"relative"!==t||Go(e)?"fixed"!==t||Yo(e)?"responsive"!==t||Jo(e)||Fi(e):zi(n,e):ji(n,e),xi(e)}))}))}(e)}},(function(t,e){return n.addCommand(e,t)})),H({mceTableCellType:function(e,r){return t.setTableCellType(n,r)},mceTableRowType:function(e,r){return t.setTableRowType(n,r)}},(function(t,e){return n.addCommand(e,t)})),n.addCommand("mceTableColType",(function(n,e){return K(e,"type").each((function(n){return s("th"===n?t.makeColumnHeader:t.unmakeColumnHeader)}))})),H({mceTableProps:u(bl,n,!1),mceTableRowProps:u(ml,n),mceTableCellProps:u(al,n)},(function(t,e){return n.addCommand(e,(function(){return t()}))})),n.addCommand("mceInsertTable",(function(t,e){h(e)&&F(e).length>0?za(n,e.rows,e.columns,e.options,"Invalid values for mceInsertTable - rows and columns values are required to insert a table."):bl(n,!0)})),n.addCommand("mceTableApplyCellStyle",(function(t,e){if(h(e)){var r=ka(n);0!==r.length&&H(e,(function(t,e){var o="tablecell"+e.toLowerCase().replace("-","");n.formatter.has(o)&&p(t)&&B(r,(function(e){ul.normal(n,e).setFormat(o,t)}))}))}}))},yl=function(n,t,e){var r=yi(n);H({mceTableRowType:function(){return t.getTableRowType(n)},mceTableCellType:function(){return t.getTableCellType(n)},mceTableColType:function(){return Ia(n).bind((function(n){return function(n){return ce(n,r)}(n).map((function(r){var o=Ar(e,r,n);return t.getTableColType(r,o)}))})).getOr("")}},(function(t,e){return n.addQueryValueHandler(e,t)}))},Cl=br([{none:["current"]},{first:["current"]},{middle:["current","target"]},{last:["current"]}]),xl=wn(wn({},Cl),{none:function(n){return void 0===n&&(n=void 0),Cl.none(n)}}),Sl=function(n,t){return ce(n,t).bind((function(t){var e=ie(t);return M(e,(function(t){return Zn(n,t)})).map((function(n){return{index:n,all:e}}))}))},Tl=function(n,t,e,o){return{start:r(n),soffset:r(t),finish:r(e),foffset:r(o)}},Rl=br([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Ol={before:Rl.before,on:Rl.on,after:Rl.after,cata:function(n,t,e,r){return n.fold(t,e,r)},getStart:function(n){return n.fold(o,o,o)}},Dl=br([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Al={domRange:Dl.domRange,relative:Dl.relative,exact:Dl.exact,exactFromRange:function(n){return Dl.exact(n.start(),n.soffset(),n.finish(),n.foffset())},getWin:function(n){var t,e=function(n){return n.match({domRange:function(n){return bn.fromDom(n.startContainer)},relative:function(n,t){return Ol.getStart(n)},exact:function(n,t,e,r){return n}})}(n);return t=e,bn.fromDom(t.dom().ownerDocument.defaultView)},range:Tl},Bl=function(n,t){return n.selectNodeContents(t.dom())},Il=function(n,t,e){var r,o=n.document.createRange();return r=o,t.fold((function(n){r.setStartBefore(n.dom())}),(function(n,t){r.setStart(n.dom(),t)}),(function(n){r.setStartAfter(n.dom())})),function(n,t){t.fold((function(t){n.setEndBefore(t.dom())}),(function(t,e){n.setEnd(t.dom(),e)}),(function(t){n.setEndAfter(t.dom())}))}(o,e),o},Pl=function(n,t,e,r,o){var u=n.document.createRange();return u.setStart(t.dom(),e),u.setEnd(r.dom(),o),u},kl=function(n){return{left:r(n.left),top:r(n.top),right:r(n.right),bottom:r(n.bottom),width:r(n.width),height:r(n.height)}},El=br([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),Ml=function(n,t,e){return t(bn.fromDom(e.startContainer),e.startOffset,bn.fromDom(e.endContainer),e.endOffset)},Nl=function(n,t){return function(n,t){var e=t.ltr();return e.collapsed?t.rtl().filter((function(n){return!1===n.collapsed})).map((function(n){return El.rtl(bn.fromDom(n.endContainer),n.endOffset,bn.fromDom(n.startContainer),n.startOffset)})).getOrThunk((function(){return Ml(0,El.ltr,e)})):Ml(0,El.ltr,e)}(0,function(n,t){return t.match({domRange:function(n){return{ltr:r(n),rtl:d.none}},relative:function(t,e){return{ltr:yn((function(){return Il(n,t,e)})),rtl:yn((function(){return d.some(Il(n,e,t))}))}},exact:function(t,e,r,o){return{ltr:yn((function(){return Pl(n,t,e,r,o)})),rtl:yn((function(){return d.some(Pl(n,r,o,t,e))}))}}})}(n,t))},_l=function(n,t){return Nl(n,t).match({ltr:function(t,e,r,o){var u=n.document.createRange();return u.setStart(t.dom(),e),u.setEnd(r.dom(),o),u},rtl:function(t,e,r,o){var u=n.document.createRange();return u.setStart(r.dom(),o),u.setEnd(t.dom(),e),u}})},Wl=(El.ltr,El.rtl,function(n,t,e){return t>=n.left&&t<=n.right&&e>=n.top&&e<=n.bottom}),jl=function(n,t,e,r,o){var u=function(e){var r=n.dom().createRange();return r.setStart(t.dom(),e),r.collapse(!0),r},i=ve(t).length,c=function(n,t,e,r,o){if(0===o)return 0;if(t===r)return o-1;for(var u=r,i=1;i<o;i++){var c=n(i),a=Math.abs(t-c.left);if(e<=c.bottom){if(e<c.top||a>u)return i-1;u=a}}return 0}((function(n){return u(n).getBoundingClientRect()}),e,r,o.right,i);return u(c)},zl=function(n,t,e,r){return Z(t)?function(n,t,e,r){var o=n.dom().createRange();o.selectNode(t.dom());var u=o.getClientRects();return z(u,(function(n){return Wl(n,e,r)?d.some(n):d.none()})).map((function(o){return jl(n,t,e,r,o)}))}(n,t,e,r):function(n,t,e,r){var o=n.dom().createRange(),u=at(t);return z(u,(function(t){return o.selectNode(t.dom()),Wl(o.getBoundingClientRect(),e,r)?zl(n,t,e,r):d.none()}))}(n,t,e,r)},Fl=function(n,t){return t-n.left<n.right-t},Ll=function(n,t,e){var r=n.dom().createRange();return r.selectNode(t.dom()),r.collapse(e),r},Hl=function(n,t,e){var r=n.dom().createRange();r.selectNode(t.dom());var o=r.getBoundingClientRect(),u=Fl(o,e);return(true===u?Se:Te)(t).map((function(t){return Ll(n,t,u)}))},ql=function(n,t,e){var r=t.dom().getBoundingClientRect(),o=Fl(r,e);return d.some(Ll(n,t,o))},Vl=function(n,t,e,r){var o=n.dom().createRange();o.selectNode(t.dom());var u=o.getBoundingClientRect();return function(n,t,e,r){var o=n.dom().createRange();o.selectNode(t.dom());var u=o.getBoundingClientRect(),i=Math.max(u.left,Math.min(u.right,e)),c=Math.max(u.top,Math.min(u.bottom,r));return zl(n,t,i,c)}(n,t,Math.max(u.left,Math.min(u.right,e)),Math.max(u.top,Math.min(u.bottom,r)))},Ul=document.caretPositionFromPoint?function(n,t,e){return d.from(n.dom().caretPositionFromPoint(t,e)).bind((function(t){if(null===t.offsetNode)return d.none();var e=n.dom().createRange();return e.setStart(t.offsetNode,t.offset),e.collapse(),d.some(e)}))}:document.caretRangeFromPoint?function(n,t,e){return d.from(n.dom().caretRangeFromPoint(t,e))}:function(n,t,e){return bn.fromPoint(n,t,e).bind((function(r){var o=function(){return function(n,t,e){return(0===at(t).length?ql:Hl)(n,t,e)}(n,r,t)};return 0===at(r).length?o():Vl(n,r,t,e).orThunk(o)}))},Kl=function(n,t){var e=X(n);return"input"===e?Ol.after(n):R(["br","img"],e)?0===t?Ol.before(n):Ol.after(n):Ol.on(n,t)},$l=function(n,t){var e=n.fold(Ol.before,Kl,Ol.after),r=t.fold(Ol.before,Kl,Ol.after);return Al.relative(e,r)},Xl=function(n,t,e,r){var o=Kl(n,t),u=Kl(e,r);return Al.relative(o,u)},Gl=function(n,t,e,r){var o=function(n,t,e,r){var o=rt(n).dom().createRange();return o.setStart(n.dom(),t),o.setEnd(e.dom(),r),o}(n,t,e,r),u=Zn(n,e)&&t===r;return o.collapsed&&!u},Yl=function(n,t){d.from(n.getSelection()).each((function(n){n.removeAllRanges(),n.addRange(t)}))},Jl=function(n,t,e,r,o){var u=Pl(n,t,e,r,o);Yl(n,u)},Ql=function(n,t){return Nl(n,t).match({ltr:function(t,e,r,o){Jl(n,t,e,r,o)},rtl:function(t,e,r,o){var u=n.getSelection();if(u.setBaseAndExtent)u.setBaseAndExtent(t.dom(),e,r.dom(),o);else if(u.extend)try{!function(n,t,e,r,o,u){t.collapse(e.dom(),r),t.extend(o.dom(),u)}(0,u,t,e,r,o)}catch(u){Jl(n,r,o,t,e)}else Jl(n,r,o,t,e)}})},Zl=function(n,t,e,r,o){var u=Xl(t,e,r,o);Ql(n,u)},nf=function(n,t,e){var r=$l(t,e);Ql(n,r)},tf=function(n){var t=Al.getWin(n).dom(),e=function(n,e,r,o){return Pl(t,n,e,r,o)},r=function(n){return n.match({domRange:function(n){var t=bn.fromDom(n.startContainer),e=bn.fromDom(n.endContainer);return Xl(t,n.startOffset,e,n.endOffset)},relative:$l,exact:Xl})}(n);return Nl(t,r).match({ltr:e,rtl:e})},ef=function(n){var t=bn.fromDom(n.anchorNode),e=bn.fromDom(n.focusNode);return Gl(t,n.anchorOffset,e,n.focusOffset)?d.some(Tl(t,n.anchorOffset,e,n.focusOffset)):function(n){if(n.rangeCount>0){var t=n.getRangeAt(0),e=n.getRangeAt(n.rangeCount-1);return d.some(Tl(bn.fromDom(t.startContainer),t.startOffset,bn.fromDom(e.endContainer),e.endOffset))}return d.none()}(n)},rf=function(n,t){var e=function(n,t){var e=n.document.createRange();return Bl(e,t),e}(n,t);Yl(n,e)},of=function(n){return function(n){return d.from(n.getSelection()).filter((function(n){return n.rangeCount>0})).bind(ef)}(n).map((function(n){return Al.exact(n.start(),n.soffset(),n.finish(),n.foffset())}))},uf=function(n,t){return function(n){var t=n.getClientRects(),e=t.length>0?t[0]:n.getBoundingClientRect();return e.width>0||e.height>0?d.some(e).map(kl):d.none()}(_l(n,t))},cf=function(n,t,e){return function(n,t,e){var r=bn.fromDom(n.document);return Ul(r,t,e).map((function(n){return Tl(bn.fromDom(n.startContainer),n.startOffset,bn.fromDom(n.endContainer),n.endOffset)}))}(n,t,e)},af=tinymce.util.Tools.resolve("tinymce.util.VK"),lf=function(n,t,e,r){return df(n,t,function(n,t){return Sl(n,t).fold((function(){return xl.none(n)}),(function(t){return t.index+1<t.all.length?xl.middle(n,t.all[t.index+1]):xl.last(n)}))}(e),r)},ff=function(n,t,e,r){return df(n,t,function(n,t){return Sl(n,t).fold((function(){return xl.none()}),(function(t){return t.index-1>=0?xl.middle(n,t.all[t.index-1]):xl.first(n)}))}(e),r)},sf=function(n,t){var e=Al.exact(t,0,t,0);return tf(e)},df=function(n,t,e,r,o){return e.fold(d.none,d.none,(function(n,t){return Se(t).map((function(n){return sf(0,n)}))}),(function(e){return ce(e,t).bind((function(t){var o=Dr(e);return n.undoManager.transact((function(){r.insertRowsAfter(t,o)})),function(n,t){var e=qt(t,"tr");return j(e).bind((function(n){return Xt(n,"td,th").map((function(n){return sf(0,n)}))}))}(0,t)}))}))},mf=["table","li","dl"],gf=function(n,t){return{selection:r(n),kill:r(t)}},pf=function(n,t,e,o){return{start:r(Ol.on(n,t)),finish:r(Ol.on(e,o))}},hf=function(n,t){var e=_l(n,t);return Tl(bn.fromDom(e.startContainer),e.startOffset,bn.fromDom(e.endContainer),e.endOffset)},vf=pf,bf=function(n,t,e,r,o){return Zn(e,r)?d.none():er(e,r,t).bind((function(t){var r=t.boxes.getOr([]);return r.length>0?(o(n,r,t.start,t.finish),d.some(gf(d.some(vf(e,0,e,ye(e))),!0))):d.none()}))},wf=function(n,t){return{item:r(n),mode:r(t)}},yf=function(n,t,e,r){return void 0===r&&(r=Cf),n.property().parent(t).map((function(n){return wf(n,r)}))},Cf=function(n,t,e,r){return void 0===r&&(r=xf),e.sibling(n,t).map((function(n){return wf(n,r)}))},xf=function(n,t,e,r){void 0===r&&(r=xf);var o=n.property().children(t);return e.first(o).map((function(n){return wf(n,r)}))},Sf=[{current:yf,next:Cf,fallback:d.none()},{current:Cf,next:xf,fallback:d.some(yf)},{current:xf,next:xf,fallback:d.some(Cf)}],Tf=function(n,t,e,r,o){return void 0===o&&(o=Sf),E(o,(function(n){return n.current===e})).bind((function(e){return e.current(n,t,r,e.next).orThunk((function(){return e.fallback.bind((function(e){return Tf(n,t,e,r)}))}))}))},Rf=function(){return{sibling:function(n,t){return n.query().prevSibling(t)},first:function(n){return n.length>0?d.some(n[n.length-1]):d.none()}}},Of=function(){return{sibling:function(n,t){return n.query().nextSibling(t)},first:function(n){return n.length>0?d.some(n[0]):d.none()}}},Df=function(n,t,e,r,o,u){return Tf(n,t,r,o).bind((function(t){return u(t.item())?d.none():e(t.item())?d.some(t.item()):Df(n,t.item(),e,t.mode(),o,u)}))},Af=function(n){return function(t){return 0===n.property().children(t).length}},Bf=function(n,t,e,r){return Df(n,t,e,Cf,Rf(),r)},If=function(n,t,e,r){return Df(n,t,e,Cf,Of(),r)},Pf=Xe(),kf=function(n,t){return function(n,t,e){return Bf(n,t,Af(n),e)}(Pf,n,t)},Ef=function(n,t){return function(n,t,e){return If(n,t,Af(n),e)}(Pf,n,t)},Mf=br([{none:["message"]},{success:[]},{failedUp:["cell"]},{failedDown:["cell"]}]),Nf=function(n){return Gt(n,"tr")},_f=wn(wn({},Mf),{verify:function(n,t,e,r,o,u,i){return Gt(r,"td,th",i).bind((function(e){return Gt(t,"td,th",i).map((function(t){return Zn(e,t)?Zn(r,e)&&ye(e)===o?u(t):Mf.none("in same cell"):nr(Nf,[e,t]).fold((function(){return function(n,t,e){var r=n.getRect(t),o=n.getRect(e);return o.right>r.left&&o.left<r.right}(n,t,e)?Mf.success():u(t)}),(function(n){return u(t)}))}))})).getOr(Mf.none("default"))},cata:function(n,t,e,r,o){return n.fold(t,e,r,o)}}),Wf=function(n){return ot(n).bind((function(t){var e=at(t);return jf(e,n).map((function(o){return function(n,t,e,o){return{parent:r(n),children:r(t),element:r(e),index:r(o)}}(t,e,n,o)}))}))},jf=function(n,t){return M(n,u(Zn,t))},zf=function(n){return"br"===X(n)},Ff=function(n,t,e){return t(n,e).bind((function(n){return Z(n)&&0===ve(n).trim().length?Ff(n,t,e):d.some(n)}))},Lf=function(n,t,e,r){return function(n,t){return lt(n,t).filter(zf).orThunk((function(){return lt(n,t-1).filter(zf)}))}(t,e).bind((function(t){return r.traverse(t).fold((function(){return Ff(t,r.gather,n).map(r.relative)}),(function(n){return Wf(n).map((function(n){return Ol.on(n.parent(),n.index())}))}))}))},Hf=function(n,t,e,o){return(zf(t)?function(n,t,e){return e.traverse(t).orThunk((function(){return Ff(t,e.gather,n)})).map(e.relative)}(n,t,o):Lf(n,t,e,o)).map((function(n){return{start:r(n),finish:r(n)}}))},qf=function(n,t){return{left:n.left,top:n.top+t,right:n.right,bottom:n.bottom+t}},Vf=function(n,t){return{left:n.left,top:n.top-t,right:n.right,bottom:n.bottom-t}},Uf=function(n,t,e){return{left:n.left+t,top:n.top+e,right:n.right+t,bottom:n.bottom+e}},Kf=function(n){return{left:n.left,top:n.top,right:n.right,bottom:n.bottom}},$f=function(n,t){return d.some(n.getRect(t))},Xf=function(n,t,e){return Q(t)?$f(n,t).map(Kf):Z(t)?function(n,t,e){return e>=0&&e<ye(t)?n.getRangedRect(t,e,t,e+1):e>0?n.getRangedRect(t,e-1,t,e):d.none()}(n,t,e).map(Kf):d.none()},Gf=function(n,t){return Q(t)?$f(n,t).map(Kf):Z(t)?n.getRangedRect(t,0,t,ye(t)).map(Kf):d.none()},Yf=br([{none:[]},{retry:["caret"]}]),Jf=function(n,t,e){return(o=t,u=Kc,Vt((function(n,t){return t(n)}),Ut,o,u,i)).fold(r(!1),(function(t){return Gf(n,t).exists((function(n){return function(n,t){return n.left<t.left||Math.abs(t.right-n.left)<1||n.left>t.right}(e,n)}))}));var o,u,i},Qf={point:function(n){return n.bottom},adjuster:function(n,t,e,r,o){var u=qf(o,5);return Math.abs(e.bottom-r.bottom)<1||e.top>o.bottom?Yf.retry(u):e.top===o.bottom?Yf.retry(qf(o,1)):Jf(n,t,o)?Yf.retry(Uf(u,5,0)):Yf.none()},move:qf,gather:Ef},Zf=function(n,t,e,r,o){return 0===o?d.some(r):function(n,t,e){return n.elementFromPoint(t,e).filter((function(n){return"table"===X(n)})).isSome()}(n,r.left,t.point(r))?function(n,t,e,r,o){return Zf(n,t,e,t.move(r,5),o)}(n,t,e,r,o-1):n.situsFromPoint(r.left,t.point(r)).bind((function(u){return u.start().fold(d.none,(function(u){return Gf(n,u).bind((function(i){return t.adjuster(n,u,i,e,r).fold(d.none,(function(r){return Zf(n,t,e,r,o-1)}))})).orThunk((function(){return d.some(r)}))}),d.none)}))},ns=function(n,t,e){var r=n.move(e,5),o=Zf(t,n,e,r,100).getOr(r);return function(n,t,e){return n.point(t)>e.getInnerHeight()?d.some(n.point(t)-e.getInnerHeight()):n.point(t)<0?d.some(-n.point(t)):d.none()}(n,o,t).fold((function(){return t.situsFromPoint(o.left,n.point(o))}),(function(e){return t.scrollBy(0,e),t.situsFromPoint(o.left,n.point(o)-e)}))},ts={tryUp:u(ns,{point:function(n){return n.top},adjuster:function(n,t,e,r,o){var u=Vf(o,5);return Math.abs(e.top-r.top)<1||e.bottom<o.top?Yf.retry(u):e.bottom===o.top?Yf.retry(Vf(o,1)):Jf(n,t,o)?Yf.retry(Uf(u,5,0)):Yf.none()},move:Vf,gather:kf}),tryDown:u(ns,Qf),ieTryUp:function(n,t){return n.situsFromPoint(t.left,t.top-5)},ieTryDown:function(n,t){return n.situsFromPoint(t.left,t.bottom+5)},getJumpSize:r(5)},es=function(n,t,e){return n.getSelection().bind((function(r){return Hf(t,r.finish(),r.foffset(),e).fold((function(){return d.some(qi(r.finish(),r.foffset()))}),(function(o){var u=n.fromSitus(o);return function(n){return _f.cata(n,(function(n){return d.none()}),(function(){return d.none()}),(function(n){return d.some(qi(n,0))}),(function(n){return d.some(qi(n,ye(n)))}))}(_f.verify(n,r.finish(),r.foffset(),u.finish(),u.foffset(),e.failure,t))}))}))},rs=function(n,t,e,r,o,u){return 0===u?d.none():is(n,t,e,r,o).bind((function(i){var c=n.fromSitus(i),a=_f.verify(n,e,r,c.finish(),c.foffset(),o.failure,t);return _f.cata(a,(function(){return d.none()}),(function(){return d.some(i)}),(function(i){return Zn(e,i)&&0===r?os(n,e,r,Vf,o):rs(n,t,i,0,o,u-1)}),(function(i){return Zn(e,i)&&r===ye(i)?os(n,e,r,qf,o):rs(n,t,i,ye(i),o,u-1)}))}))},os=function(n,t,e,r,o){return Xf(n,t,e).bind((function(t){return us(n,o,r(t,ts.getJumpSize()))}))},us=function(n,t,e){var r=Yn().browser;return r.isChrome()||r.isSafari()||r.isFirefox()||r.isEdge()?t.otherRetry(n,e):r.isIE()?t.ieRetry(n,e):d.none()},is=function(n,t,e,r,o){return Xf(n,e,r).bind((function(t){return us(n,o,t)}))},cs=function(n,t){return Ut(n,(function(n){return ot(n).exists((function(n){return Zn(n,t)}))}),e).isSome();var e},as=function(n,t,e,o,u){return Gt(o,"td,th",t).bind((function(o){return Gt(o,"table",t).bind((function(i){return cs(u,i)?function(n,t,e){return es(n,t,e).bind((function(r){return rs(n,t,r.element(),r.offset(),e,20).map(n.fromSitus)}))}(n,t,e).bind((function(n){return Gt(n.finish(),"td,th",t).map((function(t){return{start:r(o),finish:r(t),range:r(n)}}))})):d.none()}))}))},ls=function(n,t,e,r,o,u){return Yn().browser.isIE()?d.none():u(r,t).orThunk((function(){return as(n,t,e,r,o).map((function(n){var t=n.range();return gf(d.some(vf(t.start(),t.soffset(),t.finish(),t.foffset())),!0)}))}))},fs=function(n,t){return Gt(n,"tr",t).bind((function(n){return Gt(n,"table",t).bind((function(e){var r=qt(e,"tr");return Zn(n,r[0])?function(n,t,e){return Bf(Pf,n,t,e)}(e,(function(n){return Te(n).isSome()}),t).map((function(n){var t=ye(n);return gf(d.some(vf(n,t,n,t)),!0)})):d.none()}))}))},ss=function(n,t){return Gt(n,"tr",t).bind((function(n){return Gt(n,"table",t).bind((function(e){var r=qt(e,"tr");return Zn(n,r[r.length-1])?function(n,t,e){return If(Pf,n,t,e)}(e,(function(n){return Se(n).isSome()}),t).map((function(n){return gf(d.some(vf(n,0,n,0)),!0)})):d.none()}))}))},ds=function(n,t,e,r,o,u,i){return as(n,e,r,o,u).bind((function(n){return bf(t,e,n.start(),n.finish(),i)}))},ms=function(n,t){return Gt(n,"td,th",t)};var gs={traverse:ct,gather:Ef,relative:Ol.before,otherRetry:ts.tryDown,ieRetry:ts.ieTryDown,failure:_f.failedDown},ps={traverse:it,gather:kf,relative:Ol.before,otherRetry:ts.tryUp,ieRetry:ts.ieTryUp,failure:_f.failedUp},hs=function(n){return function(t){return t===n}},vs=hs(38),bs=hs(40),ws=function(n){return n>=37&&n<=40},ys={isBackward:hs(37),isForward:hs(39)},Cs={isBackward:hs(39),isForward:hs(37)},xs=function(n){return{left:n.left(),top:n.top(),right:n.right(),bottom:n.bottom(),width:n.width(),height:n.height()}},Ss=function(t){return{elementFromPoint:function(n,e){return bn.fromPoint(bn.fromDom(t.document),n,e)},getRect:function(n){return n.dom().getBoundingClientRect()},getRangedRect:function(n,e,r,o){var u=Al.exact(n,e,r,o);return uf(t,u).map(xs)},getSelection:function(){return of(t).map((function(n){return hf(t,n)}))},fromSitus:function(n){var e=Al.relative(n.start(),n.finish());return hf(t,e)},situsFromPoint:function(n,e){return cf(t,n,e).map((function(n){return pf(n.start(),n.soffset(),n.finish(),n.foffset())}))},clearSelection:function(){!function(n){n.getSelection().removeAllRanges()}(t)},collapseSelection:function(n){void 0===n&&(n=!1),of(t).each((function(e){return e.fold((function(t){return t.collapse(n)}),(function(e,r){var o=n?e:r;nf(t,o,o)}),(function(e,r,o,u){var i=n?e:o,c=n?r:u;Zl(t,i,c,i,c)}))}))},setSelection:function(n){Zl(t,n.start(),n.soffset(),n.finish(),n.foffset())},setRelativeSelection:function(n,e){nf(t,n,e)},selectContents:function(n){rf(t,n)},getInnerHeight:function(){return t.innerHeight},getScrollY:function(){var e,r,o,u;return(e=bn.fromDom(t.document),r=void 0!==e?e.dom():n.document,o=r.body.scrollLeft||r.documentElement.scrollLeft,u=r.body.scrollTop||r.documentElement.scrollTop,Pr(o,u)).top()},scrollBy:function(e,r){!function(t,e,r){(void 0!==r?r.dom():n.document).defaultView.scrollBy(t,e)}(e,r,bn.fromDom(t.document))}}},Ts=function(n,t){return{rows:n,cols:t}},Rs=function(n,t,e,r){var o=function(n,t,e,r){var o=d.none(),u=function(){o=d.none()};return{mousedown:function(n){r.clear(t),o=ms(n.target(),e)},mouseover:function(u){o.each((function(o){r.clearBeforeUpdate(t),ms(u.target(),e).each((function(u){er(o,u,e).each((function(e){var i=e.boxes.getOr([]);(i.length>1||1===i.length&&!Zn(o,u))&&(r.selectRange(t,i,e.start,e.finish),n.selectContents(u))}))}))}))},mouseup:function(n){o.each(u)}}}(Ss(n),t,e,r);return{mousedown:o.mousedown,mouseover:o.mouseover,mouseup:o.mouseup}},Os=function(n,t,e,r){var o=Ss(n),i=function(){return r.clear(t),d.none()};return{keydown:function(n,c,a,l,f,s){var m=n.raw(),g=m.which,p=!0===m.shiftKey;return rr(t,r.selectedSelector).fold((function(){return bs(g)&&p?u(ds,o,t,e,gs,l,c,r.selectRange):vs(g)&&p?u(ds,o,t,e,ps,l,c,r.selectRange):bs(g)?u(ls,o,e,gs,l,c,ss):vs(g)?u(ls,o,e,ps,l,c,fs):d.none}),(function(n){var e=function(e){return function(){return z(e,(function(e){return function(n,t,e,r,o){return ur(r,n,t,o.firstSelectedSelector,o.lastSelectedSelector).map((function(n){return o.clearBeforeUpdate(e),o.selectRange(e,n.boxes,n.start,n.finish),n.boxes}))}(e.rows,e.cols,t,n,r)})).fold((function(){return or(t,r.firstSelectedSelector,r.lastSelectedSelector).map((function(n){var e=bs(g)||s.isForward(g)?Ol.after:Ol.before;return o.setRelativeSelection(Ol.on(n.first(),0),e(n.table())),r.clear(t),gf(d.none(),!0)}))}),(function(n){return d.some(gf(d.none(),!0))}))}};return bs(g)&&p?e([Ts(1,0)]):vs(g)&&p?e([Ts(-1,0)]):s.isBackward(g)&&p?e([Ts(0,-1),Ts(-1,0)]):s.isForward(g)&&p?e([Ts(0,1),Ts(1,0)]):ws(g)&&!1===p?i:d.none}))()},keyup:function(n,o,u,i,c){return rr(t,r.selectedSelector).fold((function(){var a=n.raw(),l=a.which;return!1===(!0===a.shiftKey)?d.none():ws(l)?function(n,t,e,r,o,u,i){return Zn(e,o)&&r===u?d.none():Gt(e,"td,th",t).bind((function(e){return Gt(o,"td,th",t).bind((function(r){return bf(n,t,e,r,i)}))}))}(t,e,o,u,i,c,r.selectRange):d.none()}),d.none)}}},Ds=function(n,t,e){var r=function(t){ln(t,n.selected),ln(t,n.firstSelected),ln(t,n.lastSelected)},o=function(t){rn(t,n.selected,"1")},u=function(n){i(n),e()},i=function(t){var e=qt(t,n.selectedSelector);B(e,r)};return{clearBeforeUpdate:i,clear:u,selectRange:function(e,r,i,c){u(e),B(r,o),rn(i,n.firstSelected,"1"),rn(c,n.lastSelected,"1"),t(r,i,c)},selectedSelector:n.selectedSelector,firstSelectedSelector:n.firstSelectedSelector,lastSelectedSelector:n.lastSelectedSelector}},As=function(n,t,e){var r=me.fromTable(n);return hc(r,t).map((function(n){var t=lc(r,e,!1);return{upOrLeftCells:function(n,t,e){var r=n.slice(0,t[t.length-1].row()+1),o=sc(r,e);return _(o,(function(n){var e=n.cells().slice(0,t[t.length-1].column()+1);return A(e,(function(n){return n.element()}))}))}(t,n,e),downOrRightCells:function(n,t,e){var r=n.slice(t[0].row()+t[0].rowspan()-1,n.length),o=sc(r,e);return _(o,(function(n){var e=n.cells().slice(t[0].column()+t[0].colspan()-1,+n.cells().length);return A(e,(function(n){return n.element()}))}))}(t,n,e)}}))},Bs=function(n){return!1===Cu(bn.fromDom(n.target),"ephox-snooker-resizer-bar")};function Is(n,t,r){var o=Ds(vr,(function(t,o,u){r.targets().each((function(r){ce(o).each((function(i){var c=pi(n),a=Me(e,bn.fromDom(n.getDoc()),c),l=As(i,r,a);!function(n,t,e,r,o){n.fire("TableSelectionChange",{cells:t,start:e,finish:r,otherCells:o})}(n,t,o,u,l)}))}))}),(function(){return function(n){n.fire("TableSelectionClear")}(n)}));return n.on("init",(function(r){var u=n.getWin(),i=vi(n),c=yi(n),a=Rs(u,i,c,o),l=Os(u,i,c,o),f=function(n,t,e,r){var o=Ss(n);return function(n,u){r.clearBeforeUpdate(t),er(n,u,e).each((function(n){var e=n.boxes.getOr([]);r.selectRange(t,e,n.start,n.finish),o.selectContents(u),o.collapseSelection()}))}}(u,i,c,o);n.on("TableSelectorChange",(function(n){return f(n.start,n.finish)}));var s,d,m=function(t,e){(function(n){return!0===n.raw().shiftKey})(t)&&(e.kill()&&t.kill(),e.selection().each((function(t){var e=Al.relative(t.start(),t.finish()),r=_l(u,e);n.selection.setRng(r)})))},g=function(n){return 0===n.button},p=(s=Ai(bn.fromDom(i)),d=Ai(0),{touchEnd:function(n){var t=bn.fromDom(n.target);if("td"===X(t)||"th"===X(t)){var e=s.get(),r=d.get();Zn(e,t)&&n.timeStamp-r<300&&(n.preventDefault(),f(t,t))}s.set(t),d.set(n.timeStamp)}});n.on("mousedown",(function(n){g(n)&&Bs(n)&&a.mousedown(hu(n))})),n.on("mouseover",(function(n){var t;(void 0===(t=n).buttons||gl.browser.isEdge()&&0===t.buttons||0!=(1&t.buttons))&&Bs(n)&&a.mouseover(hu(n))})),n.on("mouseup",(function(n){g(n)&&Bs(n)&&a.mouseup(hu(n))})),n.on("touchend",p.touchEnd),n.on("keyup",(function(t){var e=hu(t);if(e.raw().shiftKey&&ws(e.raw().which)){var r=n.selection.getRng(),o=bn.fromDom(r.startContainer),u=bn.fromDom(r.endContainer);l.keyup(e,o,r.startOffset,u,r.endOffset).each((function(n){m(e,n)}))}})),n.on("keydown",(function(e){var r=hu(e);t().each((function(n){return n.hideBars()}));var o=n.selection.getRng(),u=bn.fromDom(n.selection.getStart()),i=bn.fromDom(o.startContainer),c=bn.fromDom(o.endContainer),a=Di(u).isRtl()?Cs:ys;l.keydown(r,i,o.startOffset,c,o.endOffset,a).each((function(n){m(r,n)})),t().each((function(n){return n.showBars()}))})),n.on("NodeChange",(function(){var t=n.selection,r=bn.fromDom(t.getStart()),u=bn.fromDom(t.getEnd());nr(ce,[r,u]).fold((function(){return o.clear(i)}),e)}))})),{clear:o.clear}}var Ps=function(n,t){var e=Ai(d.none()),r=Ai([]),o=function(){return Pa(n).bind((function(n){var e=ce(n);return e.map((function(e){return"caption"===X(n)?Dr(n):Ar(t,e,n)}))}))},u=function(){e.set(yn(o)()),B(r.get(),(function(n){return n()}))},i=function(n,t){var o=function(){return e.get().fold((function(){n.setDisabled(!0)}),(function(e){n.setDisabled(t(e))}))};return o(),r.set(r.get().concat([o])),function(){r.set(I(r.get(),(function(n){return n!==o})))}};return n.on("NodeChange ExecCommand TableSelectorChange",u),{onSetupTable:function(n){return i(n,(function(n){return!1}))},onSetupCellOrRow:function(n){return i(n,(function(n){return"caption"===X(n.element())}))},onSetupPasteable:function(n){return function(t){return i(t,(function(t){return"caption"===X(t.element())||n().isNone()}))}},onSetupMergeable:function(n){return i(n,(function(n){return n.mergable().isNone()}))},onSetupUnmergeable:function(n){return i(n,(function(n){return n.unmergable().isNone()}))},resetTargets:u,targets:function(){return e.get()}}},ks={tablecellbackgroundcolor:{selector:"td,th",styles:{backgroundColor:"%value"},remove_similar:!0},tablecellbordercolor:{selector:"td,th",styles:{borderColor:"%value"},remove_similar:!0},tablecellborderstyle:{selector:"td,th",styles:{borderStyle:"%value"},remove_similar:!0},tablecellborderwidth:{selector:"td,th",styles:{borderWidth:"%value"},remove_similar:!0}};function Es(n){var t=Aa(n),e=Ps(n,t),r=Hi(n),o=Is(n,r.lazyResize,e),u=Ma(n,r.lazyWire),i=function(){var n=Ai(d.none()),t=Ai(d.none()),e=function(n){n.set(d.none())};return{getRows:n.get,setRows:function(r){n.set(r),e(t)},clearRows:function(){return e(n)},getColumns:t.get,setColumns:function(r){t.set(r),e(n)},clearColumns:function(){return e(t)}}}();return wl(n,u,o,t,i),yl(n,u,t),Br(n,t,u,o),function(n,t,e){var r=function(t){return function(){return n.execCommand(t)}},o=function(t){var e=t.numRows,r=t.numColumns;n.undoManager.transact((function(){ja(n,r,e,0,0)})),n.addVisual()},u={text:"Table properties",onSetup:t.onSetupTable,onAction:r("mceTableProps")},i={text:"Delete table",icon:"table-delete-table",onSetup:t.onSetupTable,onAction:r("mceTableDelete")};n.ui.registry.addMenuItem("tableinsertrowbefore",{text:"Insert row before",icon:"table-insert-row-above",onAction:r("mceTableInsertRowBefore"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tableinsertrowafter",{text:"Insert row after",icon:"table-insert-row-after",onAction:r("mceTableInsertRowAfter"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tabledeleterow",{text:"Delete row",icon:"table-delete-row",onAction:r("mceTableDeleteRow"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablerowprops",{text:"Row properties",icon:"table-row-properties",onAction:r("mceTableRowProps"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablecutrow",{text:"Cut row",icon:"cut-row",onAction:r("mceTableCutRow"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablecopyrow",{text:"Copy row",icon:"duplicate-row",onAction:r("mceTableCopyRow"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablepasterowbefore",{text:"Paste row before",icon:"paste-row-before",onAction:r("mceTablePasteRowBefore"),onSetup:t.onSetupPasteable(e.getRows)}),n.ui.registry.addMenuItem("tablepasterowafter",{text:"Paste row after",icon:"paste-row-after",onAction:r("mceTablePasteRowAfter"),onSetup:t.onSetupPasteable(e.getRows)}),n.ui.registry.addMenuItem("tableinsertcolumnbefore",{text:"Insert column before",icon:"table-insert-column-before",onAction:r("mceTableInsertColBefore"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tableinsertcolumnafter",{text:"Insert column after",icon:"table-insert-column-after",onAction:r("mceTableInsertColAfter"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tabledeletecolumn",{text:"Delete column",icon:"table-delete-column",onAction:r("mceTableDeleteCol"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablecutcolumn",{text:"Cut column",icon:"cut-column",onAction:r("mceTableCutCol"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablecopycolumn",{text:"Copy column",icon:"duplicate-column",onAction:r("mceTableCopyCol"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablepastecolumnbefore",{text:"Paste column before",icon:"paste-column-before",onAction:r("mceTablePasteColBefore"),onSetup:t.onSetupPasteable(e.getColumns)}),n.ui.registry.addMenuItem("tablepastecolumnafter",{text:"Paste column after",icon:"paste-column-after",onAction:r("mceTablePasteColAfter"),onSetup:t.onSetupPasteable(e.getColumns)}),n.ui.registry.addMenuItem("tablecellprops",{text:"Cell properties",icon:"table-cell-properties",onAction:r("mceTableCellProps"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablemergecells",{text:"Merge cells",icon:"table-merge-cells",onAction:r("mceTableMergeCells"),onSetup:t.onSetupMergeable}),n.ui.registry.addMenuItem("tablesplitcells",{text:"Split cell",icon:"table-split-cells",onAction:r("mceTableSplitCells"),onSetup:t.onSetupUnmergeable}),!1===function(n){return n.getParam("table_grid",!0,"boolean")}(n)?n.ui.registry.addMenuItem("inserttable",{text:"Table",icon:"table",onAction:r("mceInsertTable")}):n.ui.registry.addNestedMenuItem("inserttable",{text:"Table",icon:"table",getSubmenuItems:function(){return[{type:"fancymenuitem",fancytype:"inserttable",onAction:o}]}}),n.ui.registry.addMenuItem("inserttabledialog",{text:"Insert table",icon:"table",onAction:r("mceInsertTable")}),n.ui.registry.addMenuItem("tableprops",u),n.ui.registry.addMenuItem("deletetable",i),n.ui.registry.addNestedMenuItem("row",{type:"nestedmenuitem",text:"Row",getSubmenuItems:function(){return"tableinsertrowbefore tableinsertrowafter tabledeleterow tablerowprops | tablecutrow tablecopyrow tablepasterowbefore tablepasterowafter"}}),n.ui.registry.addNestedMenuItem("column",{type:"nestedmenuitem",text:"Column",getSubmenuItems:function(){return"tableinsertcolumnbefore tableinsertcolumnafter tabledeletecolumn"}}),n.ui.registry.addNestedMenuItem("cell",{type:"nestedmenuitem",text:"Cell",getSubmenuItems:function(){return"tablecellprops tablemergecells tablesplitcells"}}),n.ui.registry.addContextMenu("table",{update:function(){return t.resetTargets(),t.targets().fold((function(){return""}),(function(n){return"caption"===X(n.element())?"tableprops deletetable":"cell row column | advtablesort | tableprops deletetable"}))}})}(n,e,i),function(n,t,e){n.ui.registry.addMenuButton("table",{tooltip:"Table",icon:"table",fetch:function(n){return n("inserttable | cell row column | advtablesort | tableprops deletetable")}});var r=function(t){return function(){return n.execCommand(t)}};n.ui.registry.addButton("tableprops",{tooltip:"Table properties",onAction:r("mceTableProps"),icon:"table",onSetup:t.onSetupTable}),n.ui.registry.addButton("tabledelete",{tooltip:"Delete table",onAction:r("mceTableDelete"),icon:"table-delete-table",onSetup:t.onSetupTable}),n.ui.registry.addButton("tablecellprops",{tooltip:"Cell properties",onAction:r("mceTableCellProps"),icon:"table-cell-properties",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tablemergecells",{tooltip:"Merge cells",onAction:r("mceTableMergeCells"),icon:"table-merge-cells",onSetup:t.onSetupMergeable}),n.ui.registry.addButton("tablesplitcells",{tooltip:"Split cell",onAction:r("mceTableSplitCells"),icon:"table-split-cells",onSetup:t.onSetupUnmergeable}),n.ui.registry.addButton("tableinsertrowbefore",{tooltip:"Insert row before",onAction:r("mceTableInsertRowBefore"),icon:"table-insert-row-above",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tableinsertrowafter",{tooltip:"Insert row after",onAction:r("mceTableInsertRowAfter"),icon:"table-insert-row-after",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tabledeleterow",{tooltip:"Delete row",onAction:r("mceTableDeleteRow"),icon:"table-delete-row",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tablerowprops",{tooltip:"Row properties",onAction:r("mceTableRowProps"),icon:"table-row-properties",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tableinsertcolbefore",{tooltip:"Insert column before",onAction:r("mceTableInsertColBefore"),icon:"table-insert-column-before",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tableinsertcolafter",{tooltip:"Insert column after",onAction:r("mceTableInsertColAfter"),icon:"table-insert-column-after",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tabledeletecol",{tooltip:"Delete column",onAction:r("mceTableDeleteCol"),icon:"table-delete-column",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tablecutrow",{tooltip:"Cut row",icon:"cut-row",onAction:r("mceTableCutRow"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tablecopyrow",{tooltip:"Copy row",icon:"duplicate-row",onAction:r("mceTableCopyRow"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tablepasterowbefore",{tooltip:"Paste row before",icon:"paste-row-before",onAction:r("mceTablePasteRowBefore"),onSetup:t.onSetupPasteable(e.getRows)}),n.ui.registry.addButton("tablepasterowafter",{tooltip:"Paste row after",icon:"paste-row-after",onAction:r("mceTablePasteRowAfter"),onSetup:t.onSetupPasteable(e.getRows)}),n.ui.registry.addButton("tablecutcol",{tooltip:"Cut column",icon:"cut-column",onAction:r("mceTableCutCol"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tablecopycol",{tooltip:"Copy column",icon:"duplicate-column",onAction:r("mceTableCopyCol"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tablepastecolbefore",{tooltip:"Paste column before",icon:"paste-column-before",onAction:r("mceTablePasteColBefore"),onSetup:t.onSetupPasteable(e.getColumns)}),n.ui.registry.addButton("tablepastecolafter",{tooltip:"Paste column after",icon:"paste-column-after",onAction:r("mceTablePasteColAfter"),onSetup:t.onSetupPasteable(e.getColumns)}),n.ui.registry.addButton("tableinsertdialog",{tooltip:"Insert table",onAction:r("mceInsertTable"),icon:"table"})}(n,e,i),function(n){var t=function(n){return n.getParam("table_toolbar","tableprops tabledelete | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol")}(n);t.length>0&&n.ui.registry.addContextToolbar("table",{predicate:function(t){return n.dom.is(t,"table")&&n.getBody().contains(t)},items:t,scope:"node",position:"node"})}(n),n.on("PreInit",(function(){n.serializer.addTempAttr(mr),n.serializer.addTempAttr(pr),function(n){n.formatter.register(ks)}(n)})),function(n){return n.getParam("table_tab_navigation",!0,"boolean")}(n)&&n.on("keydown",(function(t){!function(n,t,e,r){if(n.keyCode===af.TAB){var o=vi(t),u=function(n){var t=X(n);return Zn(n,o)||R(mf,t)},i=t.selection.getRng();if(i.collapsed){var c=bn.fromDom(i.startContainer);ue(c,u).each((function(o){n.preventDefault(),(n.shiftKey?ff:lf)(t,u,o,e,r).each((function(n){t.selection.setRng(n)}))}))}}}(t,n,u,r.lazyWire)})),n.on("remove",(function(){r.destroy()})),function(n,t,e,r){return{insertTable:function(t,e,r){return void 0===r&&(r={}),za(n,e,t,r,"Invalid values for insertTable - rows and columns values are required to insert a table.")},setClipboardRows:La(t.setRows),getClipboardRows:Fa(t.getRows),setClipboardCols:La(t.setColumns),getClipboardCols:Fa(t.getColumns),resizeHandler:e,selectionTargets:r}}(n,i,r,e)}t.add("table",Es)}(window);