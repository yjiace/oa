!function(e){"use strict";var n,t,r,o,i=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=function(){},a=function(e){return function(){return e}},s=function(e){return function(n){return!e(n)}},c=a(!1),f=a(!0),d=function(){return l},l=function(){var e=function(e){return e.isNone()},n=function(e){return e()},t=function(e){return e};return{fold:function(e,n){return e()},is:c,isSome:c,isNone:f,getOr:t,getOrThunk:n,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:a(null),getOrUndefined:a(void 0),or:t,orThunk:n,map:d,each:u,bind:d,exists:c,forall:f,filter:d,equals:e,equals_:e,toArray:function(){return[]},toString:a("none()")}}(),m=function(e){var n=a(e),t=function(){return o},r=function(n){return n(e)},o={fold:function(n,t){return t(e)},is:function(n){return e===n},isSome:f,isNone:c,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:t,orThunk:t,map:function(n){return m(n(e))},each:function(n){n(e)},bind:r,exists:r,forall:r,filter:function(n){return n(e)?o:l},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(n){return n.is(e)},equals_:function(n,t){return n.fold(c,(function(n){return t(e,n)}))}};return o},p={some:m,none:d,from:function(e){return null==e?l:m(e)}},g=function(e){return function(n){return r=typeof(t=n),(null===t?"null":"object"===r&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===r&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":r)===e;var t,r}},v=function(e){return function(n){return typeof n===e}},h=g("string"),y=g("array"),S=v("boolean"),b=v("function"),C=v("number"),N=Array.prototype.slice,O=Array.prototype.push,L=function(e,n){for(var t=e.length,r=new Array(t),o=0;o<t;o++){var i=e[o];r[o]=n(i,o)}return r},w=function(e,n){for(var t=0,r=e.length;t<r;t++){n(e[t],t)}},T=function(e,n){for(var t=[],r=0,o=e.length;r<o;r++){var i=e[r];n(i,r)&&t.push(i)}return t},D=function(e,n,t){return w(e,(function(e){t=n(t,e)})),t},k=function(e,n,t){for(var r=0,o=e.length;r<o;r++){var i=e[r];if(n(i,r))return p.some(i);if(t(i,r))break}return p.none()},x=function(e,n){return k(e,n,c)},A=function(e,n){return function(e){for(var n=[],t=0,r=e.length;t<r;++t){if(!y(e[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+e);O.apply(n,e[t])}return n}(L(e,n))},E=function(e){var n=N.call(e,0);return n.reverse(),n},P=function(e){return 0===e.length?p.none():p.some(e[0])},B=function(e){return 0===e.length?p.none():p.some(e[e.length-1])},R=function(){return(R=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)},I=function(){return M(0,0)},M=function(e,n){return{major:e,minor:n}},U={nu:M,detect:function(e,n){var t=String(n).toLowerCase();return 0===e.length?I():function(e,n){var t=function(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(r.test(n))return r}}(e,n);if(!t)return{major:0,minor:0};var r=function(e){return Number(n.replace(t,"$"+e))};return M(r(1),r(2))}(e,t)},unknown:I},_="Edge",F="Chrome",$="Opera",H="Firefox",j="Safari",q=function(e){var n=e.current,t=e.version,r=function(e){return function(){return n===e}};return{current:n,version:t,isEdge:r(_),isChrome:r(F),isIE:r("IE"),isOpera:r($),isFirefox:r(H),isSafari:r(j)}},K={unknown:function(){return q({current:void 0,version:U.unknown()})},nu:q,edge:a(_),chrome:a(F),ie:a("IE"),opera:a($),firefox:a(H),safari:a(j)},V="Windows",W="Android",Q="Linux",X="Solaris",z="FreeBSD",Y="ChromeOS",G=function(e){var n=e.current,t=e.version,r=function(e){return function(){return n===e}};return{current:n,version:t,isWindows:r(V),isiOS:r("iOS"),isAndroid:r(W),isOSX:r("OSX"),isLinux:r(Q),isSolaris:r(X),isFreeBSD:r(z),isChromeOS:r(Y)}},J={unknown:function(){return G({current:void 0,version:U.unknown()})},nu:G,windows:a(V),ios:a("iOS"),android:a(W),linux:a(Q),osx:a("OSX"),solaris:a(X),freebsd:a(z),chromeos:a(Y)},Z=function(e,n){var t=String(n).toLowerCase();return x(e,(function(e){return e.search(t)}))},ee=function(e,n){return Z(e,n).map((function(e){var t=U.detect(e.versionRegexes,n);return{current:e.name,version:t}}))},ne=function(e,n){return Z(e,n).map((function(e){var t=U.detect(e.versionRegexes,n);return{current:e.name,version:t}}))},te=function(e,n){return-1!==e.indexOf(n)},re=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,oe=function(e){return function(n){return te(n,e)}},ie=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return te(e,"edge/")&&te(e,"chrome")&&te(e,"safari")&&te(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,re],search:function(e){return te(e,"chrome")&&!te(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return te(e,"msie")||te(e,"trident")}},{name:"Opera",versionRegexes:[re,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:oe("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:oe("firefox")},{name:"Safari",versionRegexes:[re,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(te(e,"safari")||te(e,"mobile/"))&&te(e,"applewebkit")}}],ue=[{name:"Windows",search:oe("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return te(e,"iphone")||te(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:oe("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:oe("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:oe("linux"),versionRegexes:[]},{name:"Solaris",search:oe("sunos"),versionRegexes:[]},{name:"FreeBSD",search:oe("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:oe("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],ae={browsers:a(ie),oses:a(ue)},se=function(e,n){var t=ae.browsers(),r=ae.oses(),o=ee(t,e).fold(K.unknown,K.nu),i=ne(r,e).fold(J.unknown,J.nu),u=function(e,n,t,r){var o=e.isiOS()&&!0===/ipad/i.test(t),i=e.isiOS()&&!o,u=e.isiOS()||e.isAndroid(),s=u||r("(pointer:coarse)"),c=o||!i&&u&&r("(min-device-width:768px)"),f=i||u&&!c,d=n.isSafari()&&e.isiOS()&&!1===/safari/i.test(t),l=!f&&!c&&!d;return{isiPad:a(o),isiPhone:a(i),isTablet:a(c),isPhone:a(f),isTouch:a(s),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:a(d),isDesktop:a(l)}}(i,o,e,n);return{browser:o,os:i,deviceType:u}},ce=function(n){return e.window.matchMedia(n).matches},fe=(n=function(){return se(e.navigator.userAgent,ce)},r=!1,function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return r||(r=!0,t=n.apply(null,e)),t}),de=function(e){if(null==e)throw new Error("Node cannot be null or undefined");return{dom:a(e)}},le={fromHtml:function(n,t){var r=(t||e.document).createElement("div");if(r.innerHTML=n,!r.hasChildNodes()||r.childNodes.length>1)throw e.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return de(r.childNodes[0])},fromTag:function(n,t){var r=(t||e.document).createElement(n);return de(r)},fromText:function(n,t){var r=(t||e.document).createTextNode(n);return de(r)},fromDom:de,fromPoint:function(e,n,t){var r=e.dom();return p.from(r.elementFromPoint(n,t)).map(de)}},me=function(e,n){return e.dom()===n.dom()},pe=function(n,t){return r=n.dom(),o=t.dom(),function(e,n,t){return 0!=(e.compareDocumentPosition(n)&t)}(r,o,e.Node.DOCUMENT_POSITION_CONTAINED_BY);var r,o},ge=function(e,n){return fe().browser.isIE()?pe(e,n):function(e,n){var t=e.dom(),r=n.dom();return t!==r&&t.contains(r)}(e,n)},ve=function(e,n){var t=e.dom();if(1!==t.nodeType)return!1;var r=t;if(void 0!==r.matches)return r.matches(n);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(n);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(n);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(n);throw new Error("Browser lacks native selectors")},he=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),ye=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),Se=tinymce.util.Tools.resolve("tinymce.util.VK"),be=function(e,n,t){return e.isSome()&&n.isSome()?p.some(t(e.getOrDie(),n.getOrDie())):p.none()},Ce=(void 0!==e.window?e.window:Function("return this;")(),function(e){return e.dom().nodeName.toLowerCase()}),Ne=(o=1,function(e){return function(e){return e.dom().nodeType}(e)===o}),Oe=function(e){return p.from(e.dom().parentNode).map(le.fromDom)},Le=function(e){return L(e.dom().childNodes,le.fromDom)},we=function(e,n){var t=e.dom().childNodes;return p.from(t[n]).map(le.fromDom)},Te=function(e){return we(e,0)},De=function(e){return we(e,e.dom().childNodes.length-1)},ke=function(e,n){Oe(e).each((function(t){t.dom().insertBefore(n.dom(),e.dom())}))},xe=function(e,n){e.dom().appendChild(n.dom())},Ae=function(e,n){w(n,(function(n){xe(e,n)}))},Ee=function(e){var n=e.dom();null!==n.parentNode&&n.parentNode.removeChild(n)},Pe=function(e,n,t){return e.fire("ListMutation",{action:n,element:t})},Be=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),Re=tinymce.util.Tools.resolve("tinymce.util.Tools"),Ie=function(e){return function(n){return n&&n.nodeName.toLowerCase()===e}},Me=function(e){return function(n){return n&&e.test(n.nodeName)}},Ue=function(e){return e&&3===e.nodeType},_e=Me(/^(OL|UL|DL)$/),Fe=Me(/^(OL|UL)$/),$e=Ie("ol"),He=Me(/^(LI|DT|DD)$/),je=Me(/^(DT|DD)$/),qe=Me(/^(TH|TD)$/),Ke=Ie("br"),Ve=function(e,n){return n&&!!e.schema.getTextBlockElements()[n.nodeName]},We=function(e,n){return e&&e.nodeName in n},Qe=function(e,n,t){var r=e.isEmpty(n);return!(t&&e.select("span[data-mce-type=bookmark]",n).length>0)&&r},Xe=function(e,n){return e.isChildOf(n,e.getRoot())},ze=function(e,n){var t=n||e.selection.getStart(!0);return e.dom.getParent(t,"OL,UL,DL",Je(e,t))},Ye=function(e){var n=ze(e),t=e.selection.getSelectedBlocks();return function(e,n){return e&&1===n.length&&n[0]===e}(n,t)?function(e){return Re.grep(e.querySelectorAll("ol,ul,dl"),(function(e){return _e(e)}))}(n):Re.grep(t,(function(e){return _e(e)&&n!==e}))},Ge=function(e){var n=e.selection.getSelectedBlocks();return Re.grep(function(e,n){var t=Re.map(n,(function(n){return e.dom.getParent(n,"li,dd,dt",Je(e,n))||n}));return Be.unique(t)}(e,n),(function(e){return He(e)}))},Je=function(e,n){var t=e.dom.getParents(n,"TD,TH");return t.length>0?t[0]:e.getBody()},Ze=function(e,n){var t=e.dom.getParents(n,"ol,ul",Je(e,n));return B(t)},en=function(e){var n=function(e){var n=Ze(e,e.selection.getStart()),t=T(e.selection.getSelectedBlocks(),Fe);return n.toArray().concat(t)}(e);return nn(e,n)},nn=function(e,n){var t=L(n,(function(n){return Ze(e,n).getOr(n)}));return Be.unique(t)},tn=function(e,n){var t,r,o,i=e.dom,u=e.schema.getBlockElements(),a=i.createFragment(),s=function(e){var n=e.getParam("forced_root_block","p");return!1===n?"":!0===n?"p":n}(e);if(s&&((r=i.create(s)).tagName===s.toUpperCase()&&i.setAttribs(r,function(e){return e.getParam("forced_root_block_attrs",{})}(e)),We(n.firstChild,u)||a.appendChild(r)),n)for(;t=n.firstChild;){var c=t.nodeName;o||"SPAN"===c&&"bookmark"===t.getAttribute("data-mce-type")||(o=!0),We(t,u)?(a.appendChild(t),r=null):s?(r||(r=i.create(s),a.appendChild(r)),r.appendChild(t)):a.appendChild(t)}return s?o||r.appendChild(i.create("br",{"data-mce-bogus":"1"})):a.appendChild(i.create("br")),a},rn=Object.keys,on=function(e,n){for(var t=rn(e),r=0,o=t.length;r<o;r++){var i=t[r];n(e[i],i)}},un=function(e,n){var t={};return function(e,n,t,r){on(e,(function(e,o){(n(e,o)?t:r)(e,o)}))}(e,n,function(e){return function(n,t){e[t]=n}}(t),u),t},an=function(n,t){var r=n.dom();on(t,(function(n,t){!function(n,t,r){if(!(h(r)||S(r)||C(r)))throw e.console.error("Invalid call to Attr.set. Key ",t,":: Value ",r,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(t,r+"")}(r,t,n)}))},sn=function(e){return D(e.dom().attributes,(function(e,n){return e[n.name]=n.value,e}),{})},cn=(b(e.Element.prototype.attachShadow)&&b(e.Node.prototype.getRootNode),function(n,t,r){if(!h(r))throw e.console.error("Invalid call to CSS.set. Property ",t,":: Value ",r,":: Element ",n),new Error("CSS value must be a string: "+r);(function(e){return void 0!==e.style&&b(e.style.getPropertyValue)})(n)&&n.style.setProperty(t,r)}),fn=function(e){return function(e,n){return le.fromDom(e.dom().cloneNode(n))}(e,!0)},dn=function(e,n){var t=function(e,n){var t=le.fromTag(n),r=sn(e);return an(t,r),t}(e,n);ke(e,t);var r=Le(e);return Ae(t,r),Ee(e),t},ln=function(e,n){xe(e.item,n.list)},mn=function(e,n){var t={list:le.fromTag(n,e),item:le.fromTag("li",e)};return xe(t.list,t.item),t},pn=function(e,n,t){var r=n.slice(0,t.depth);return B(r).each((function(n){!function(e,n){xe(e.list,n),e.item=n}(n,function(e,n,t){var r=le.fromTag("li",e);return an(r,n),Ae(r,t),r}(e,t.itemAttributes,t.content)),function(e,n){Ce(e.list)!==n.listType&&(e.list=dn(e.list,n.listType)),an(e.list,n.listAttributes)}(n,t)})),r},gn=function(e,n,t){var r,o=function(e,n,t){for(var r=[],o=0;o<t;o++)r.push(mn(e,n.listType));return r}(e,t,t.depth-n.length);return function(e){for(var n=1;n<e.length;n++)ln(e[n-1],e[n])}(o),function(e,n){for(var t=0;t<e.length-1;t++)r=e[t].item,o="list-style-type",i="none",u=void 0,u=r.dom(),cn(u,o,i);var r,o,i,u;B(e).each((function(e){an(e.list,n.listAttributes),an(e.item,n.itemAttributes),Ae(e.item,n.content)}))}(o,t),r=o,be(B(n),P(r),ln),n.concat(o)},vn=function(e){return ve(e,"OL,UL")},hn=function(e){return Te(e).map(vn).getOr(!1)},yn=function(e){return e.depth>0},Sn=function(e){return e.isSelected},bn=function(e){var n=Le(e),t=De(e).map(vn).getOr(!1)?n.slice(0,-1):n;return L(t,fn)},Cn=function(e){return w(e,(function(n,t){(function(e,n){var t=e[n].depth,r=function(e){return e.depth===t&&!e.dirty},o=function(e){return e.depth<t};return k(E(e.slice(0,n)),r,o).orThunk((function(){return k(e.slice(n+1),r,o)}))})(e,t).fold((function(){n.dirty&&function(e){e.listAttributes=un(e.listAttributes,(function(e,n){return"start"!==n}))}(n)}),(function(e){return r=e,(t=n).listType=r.listType,void(t.listAttributes=R({},r.listAttributes));var t,r}))})),e},Nn=function(e,n,t,r){return Te(r).filter(vn).fold((function(){n.each((function(e){me(e.start,r)&&t.set(!0)}));var o=function(e,n,t){return Oe(e).filter(Ne).map((function(r){return{depth:n,dirty:!1,isSelected:t,content:bn(e),itemAttributes:sn(e),listAttributes:sn(r),listType:Ce(r)}}))}(r,e,t.get());n.each((function(e){me(e.end,r)&&t.set(!1)}));var i=De(r).filter(vn).map((function(r){return On(e,n,t,r)})).getOr([]);return o.toArray().concat(i)}),(function(r){return On(e,n,t,r)}))},On=function(e,n,t,r){return A(Le(r),(function(r){return(vn(r)?On:Nn)(e+1,n,t,r)}))},Ln=function(n,t){var r=Cn(t);return L(r,(function(t){var r,o,i,u=(r=t.content,i=(o||e.document).createDocumentFragment(),w(r,(function(e){i.appendChild(e.dom())})),le.fromDom(i));return le.fromDom(tn(n,u.dom()))}))},wn=function(e,n){var t=Cn(n);return function(e,n){var t=D(n,(function(n,t){return t.depth>n.length?gn(e,n,t):pn(e,n,t)}),[]);return P(t).map((function(e){return e.list}))}(e.contentDocument,t).toArray()},Tn=function(e,n,t){var r=function(e,n){var t,r=(t=!1,{get:function(){return t},set:function(e){t=e}});return L(e,(function(e){return{sourceList:e,entries:On(0,n,r,e)}}))}(n,function(e){var n=L(Ge(e),le.fromDom);return be(x(n,s(hn)),x(E(n),s(hn)),(function(e,n){return{start:e,end:n}}))}(e));w(r,(function(n){!function(e,n){w(T(e,Sn),(function(e){return function(e,n){switch(e){case"Indent":n.depth++;break;case"Outdent":n.depth--;break;case"Flatten":n.depth=0}n.dirty=!0}(n,e)}))}(n.entries,t);var r,o=function(e,n){return A(function(e,n){if(0===e.length)return[];for(var t=n(e[0]),r=[],o=[],i=0,u=e.length;i<u;i++){var a=e[i],s=n(a);s!==t&&(r.push(o),o=[]),t=s,o.push(a)}return 0!==o.length&&r.push(o),r}(n,yn),(function(n){return P(n).map(yn).getOr(!1)?wn(e,n):Ln(e,n)}))}(e,n.entries);w(o,(function(n){Pe(e,"Indent"===t?"IndentList":"OutdentList",n.dom())})),r=n.sourceList,w(o,(function(e){ke(r,e)})),Ee(n.sourceList)}))},Dn=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),kn=Dn.DOM,xn=function(e,n){ve(n,"dd")?dn(n,"dt"):ve(n,"dt")&&Oe(n).each((function(t){return function(e,n,t){var r=kn.select('span[data-mce-type="bookmark"]',n),o=tn(e,t),i=kn.createRng();i.setStartAfter(t),i.setEndAfter(n);for(var u,a=i.extractContents(),s=a.firstChild;s;s=s.firstChild)if("LI"===s.nodeName&&e.dom.isEmpty(s)){kn.remove(s);break}e.dom.isEmpty(a)||kn.insertAfter(a,n),kn.insertAfter(o,n),Qe(e.dom,t.parentNode)&&(u=t.parentNode,Re.each(r,(function(e){u.parentNode.insertBefore(e,t.parentNode)})),kn.remove(u)),kn.remove(t),Qe(e.dom,n)&&kn.remove(n)}(e,t.dom(),n.dom())}))},An=function(e){ve(e,"dt")&&dn(e,"dd")},En=function(e,n){if(Ue(e))return{container:e,offset:n};var t=he.getNode(e,n);return Ue(t)?{container:t,offset:n>=e.childNodes.length?t.data.length:0}:t.previousSibling&&Ue(t.previousSibling)?{container:t.previousSibling,offset:t.previousSibling.data.length}:t.nextSibling&&Ue(t.nextSibling)?{container:t.nextSibling,offset:0}:{container:e,offset:n}},Pn=function(e){var n=e.cloneRange(),t=En(e.startContainer,e.startOffset);n.setStart(t.container,t.offset);var r=En(e.endContainer,e.endOffset);return n.setEnd(r.container,r.offset),n},Bn=function(e,n){var t=L(en(e),le.fromDom),r=L(function(e){return T(Ge(e),je)}(e),le.fromDom),o=!1;if(t.length||r.length){var i=e.selection.getBookmark();Tn(e,t,n),function(e,n,t){w(t,"Indent"===n?An:function(n){return xn(e,n)})}(e,n,r),e.selection.moveToBookmark(i),e.selection.setRng(Pn(e.selection.getRng())),e.nodeChanged(),o=!0}return o},Rn=function(e){return Bn(e,"Indent")},In=function(e){return Bn(e,"Outdent")},Mn=function(e){return Bn(e,"Flatten")},Un=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),_n=Dn.DOM,Fn=function(e){var n={},t=function(t){var r,o,i;o=e[t?"startContainer":"endContainer"],i=e[t?"startOffset":"endOffset"],1===o.nodeType&&(r=_n.create("span",{"data-mce-type":"bookmark"}),o.hasChildNodes()?(i=Math.min(i,o.childNodes.length-1),t?o.insertBefore(r,o.childNodes[i]):_n.insertAfter(r,o.childNodes[i])):o.appendChild(r),o=r,i=0),n[t?"startContainer":"endContainer"]=o,n[t?"startOffset":"endOffset"]=i};return t(!0),e.collapsed||t(),n},$n=function(e){function n(n){var t,r,o;t=o=e[n?"startContainer":"endContainer"],r=e[n?"startOffset":"endOffset"],t&&(1===t.nodeType&&(r=function(e){for(var n=e.parentNode.firstChild,t=0;n;){if(n===e)return t;1===n.nodeType&&"bookmark"===n.getAttribute("data-mce-type")||t++,n=n.nextSibling}return-1}(t),t=t.parentNode,_n.remove(o),!t.hasChildNodes()&&_n.isBlock(t)&&t.appendChild(_n.create("br"))),e[n?"startContainer":"endContainer"]=t,e[n?"startOffset":"endOffset"]=r)}n(!0),n();var t=_n.createRng();return t.setStart(e.startContainer,e.startOffset),e.endContainer&&t.setEnd(e.endContainer,e.endOffset),Pn(t)},Hn=function(e){switch(e){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},jn=function(e){return/\btox\-/.test(e.className)},qn=function(e,n,t){var r=function(e){var r=k(e.parents,_e,qe).filter((function(e){return e.nodeName===n&&!jn(e)})).isSome();t(r)},o=e.dom.getParents(e.selection.getNode());return r({parents:o}),e.on("NodeChange",r),function(){return e.off("NodeChange",r)}},Kn=function(e,n){Re.each(n,(function(n,t){e.setAttribute(t,n)}))},Vn=function(e,n,t){!function(e,n,t){var r=t["list-style-type"]?t["list-style-type"]:null;e.setStyle(n,"list-style-type",r)}(e,n,t),function(e,n,t){Kn(n,t["list-attributes"]),Re.each(e.select("li",n),(function(e){Kn(e,t["list-item-attributes"])}))}(e,n,t)},Wn=function(e,n,t,r){var o=n[t?"startContainer":"endContainer"],i=n[t?"startOffset":"endOffset"];for(1===o.nodeType&&(o=o.childNodes[Math.min(i,o.childNodes.length-1)]||o),!t&&Ke(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==r;){if(Ve(e,o))return o;if(/^(TD|TH)$/.test(o.parentNode.nodeName))return o;o=o.parentNode}return o},Qn=function(e,n,t){void 0===t&&(t={});var r=e.selection.getRng(),o="LI",i=Je(e,e.selection.getStart(!0)),u=e.dom;if("false"!==u.getContentEditable(e.selection.getNode())){"DL"===(n=n.toUpperCase())&&(o="DT");var a=Fn(r);Re.each(function(e,n,t){for(var r,o=[],i=e.dom,u=Wn(e,n,!0,t),a=Wn(e,n,!1,t),s=[],c=u;c&&(s.push(c),c!==a);c=c.nextSibling);return Re.each(s,(function(n){if(Ve(e,n))return o.push(n),void(r=null);if(i.isBlock(n)||Ke(n))return Ke(n)&&i.remove(n),void(r=null);var u=n.nextSibling;Un.isBookmarkNode(n)&&(Ve(e,u)||!u&&n.parentNode===t)?r=null:(r||(r=i.create("p"),n.parentNode.insertBefore(r,n),o.push(r)),r.appendChild(n))})),o}(e,r,i),(function(r){var i,a=r.previousSibling;a&&_e(a)&&a.nodeName===n&&function(e,n,t){var r=e.getStyle(n,"list-style-type"),o=t?t["list-style-type"]:"";return r===(null===o?"":o)}(u,a,t)?(i=a,r=u.rename(r,o),a.appendChild(r)):(i=u.create(n),r.parentNode.insertBefore(i,r),i.appendChild(r),r=u.rename(r,o)),function(e,n,t){Re.each(t,(function(t){var r;return e.setStyle(n,((r={})[t]="",r))}))}(u,r,["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"]),Vn(u,i,t),zn(e.dom,i)})),e.selection.setRng($n(a))}},Xn=function(e,n,t){return function(e,n){return e&&n&&_e(e)&&e.nodeName===n.nodeName}(n,t)&&function(e,n,t){return e.getStyle(n,"list-style-type",!0)===e.getStyle(t,"list-style-type",!0)}(e,n,t)&&(r=t,n.className===r.className);var r},zn=function(e,n){var t,r;if(t=n.nextSibling,Xn(e,n,t)){for(;r=t.firstChild;)n.appendChild(r);e.remove(t)}if(t=n.previousSibling,Xn(e,n,t)){for(;r=t.lastChild;)n.insertBefore(r,n.firstChild);e.remove(t)}},Yn=function(e,n,t,r,o){if(n.nodeName!==r||Gn(o)){var i=Fn(e.selection.getRng(!0));Re.each([n].concat(t),(function(n){!function(e,n,t,r){if(n.nodeName!==t){var o=e.dom.rename(n,t);Vn(e.dom,o,r),Pe(e,Hn(t),o)}else Vn(e.dom,n,r),Pe(e,Hn(t),n)}(e,n,r,o)})),e.selection.setRng($n(i))}else Mn(e)},Gn=function(e){return"list-style-type"in e},Jn=function(e,n,t){var r=ze(e),o=Ye(e);t=t||{},r&&o.length>0?Yn(e,r,o,n,t):function(e,n,t,r){if(n!==e.getBody())if(n)if(n.nodeName!==t||Gn(r)||jn(n)){var o=Fn(e.selection.getRng(!0));Vn(e.dom,n,r);var i=e.dom.rename(n,t);zn(e.dom,i),e.selection.setRng($n(o)),Pe(e,Hn(t),i)}else Mn(e);else Qn(e,t,r),Pe(e,Hn(t),n)}(e,r,n,t)},Zn=Dn.DOM,et=function(e,n){Re.each(Re.grep(e.select("ol,ul",n)),(function(n){!function(e,n){var t,r=n.parentNode;"LI"===r.nodeName&&r.firstChild===n&&((t=r.previousSibling)&&"LI"===t.nodeName?(t.appendChild(n),Qe(e,r)&&Zn.remove(r)):Zn.setStyle(r,"listStyleType","none")),_e(r)&&(t=r.previousSibling)&&"LI"===t.nodeName&&t.appendChild(n)}(e,n)}))},nt=function(e,n,t,r){var o=n.startContainer,i=n.startOffset;if(Ue(o)&&(t?i<o.data.length:i>0))return o;var u=e.schema.getNonEmptyElements();1===o.nodeType&&(o=he.getNode(o,i));var a=new ye(o,r);for(t&&function(e,n){return!!Ke(n)&&!(!e.isBlock(n.nextSibling)||Ke(n.previousSibling))}(e.dom,o)&&a.next();o=a[t?"next":"prev2"]();){if("LI"===o.nodeName&&!o.hasChildNodes())return o;if(u[o.nodeName])return o;if(Ue(o)&&o.data.length>0)return o}},tt=function(e,n){var t=n.childNodes;return 1===t.length&&!_e(t[0])&&e.isBlock(t[0])},rt=function(e,n,t){var r,o=tt(e,t)?t.firstChild:t;if(function(e,n){tt(e,n)&&e.remove(n.firstChild,!0)}(e,n),!Qe(e,n,!0))for(;r=n.firstChild;)o.appendChild(r)},ot=function(e,n,t){var r,o=n.parentNode;if(Xe(e,n)&&Xe(e,t)){_e(t.lastChild)&&(r=t.lastChild),o===t.lastChild&&Ke(o.previousSibling)&&e.remove(o.previousSibling);var i=t.lastChild;i&&Ke(i)&&n.hasChildNodes()&&e.remove(i),Qe(e,t,!0)&&e.$(t).empty(),rt(e,n,t),r&&t.appendChild(r);var u=ge(le.fromDom(t),le.fromDom(n))?e.getParents(n,_e,t):[];e.remove(n),w(u,(function(n){Qe(e,n)&&n!==e.getRoot()&&e.remove(n)}))}},it=function(e,n,t,r){var o=e.dom;if(o.isEmpty(r))!function(e,n,t){e.dom.$(t).empty(),ot(e.dom,n,t),e.selection.setCursorLocation(t)}(e,t,r);else{var i=Fn(n);ot(o,t,r),e.selection.setRng($n(i))}},ut=function(e,n){var t=e.dom,r=e.selection,o=r.getStart(),i=Je(e,o),u=t.getParent(r.getStart(),"LI",i);if(u){var a=u.parentNode;if(a===e.getBody()&&Qe(t,a))return!0;var s=Pn(r.getRng()),c=t.getParent(nt(e,s,n,i),"LI",i);if(c&&c!==u)return e.undoManager.transact((function(){var t;n?it(e,s,c,u):(t=u).parentNode.firstChild===t?In(e):function(e,n,t,r){var o=Fn(n);ot(e.dom,t,r);var i=$n(o);e.selection.setRng(i)}(e,s,u,c)})),!0;if(!c&&!n&&0===s.startOffset&&0===s.endOffset)return e.undoManager.transact((function(){Mn(e)})),!0}return!1},at=function(e,n){return ut(e,n)||function(e,n){var t=e.dom,r=e.selection.getStart(),o=Je(e,r),i=t.getParent(r,t.isBlock,o);if(i&&t.isEmpty(i)){var u=Pn(e.selection.getRng()),a=t.getParent(nt(e,u,n,o),"LI",o);if(a)return e.undoManager.transact((function(){!function(e,n,t){var r=e.getParent(n.parentNode,e.isBlock,t);e.remove(n),r&&e.isEmpty(r)&&e.remove(r)}(t,i,o),zn(t,a.parentNode),e.selection.select(a,!0),e.selection.collapse(n)})),!0}return!1}(e,n)},st=function(e,n){return e.selection.isCollapsed()?at(e,n):function(e){var n=e.selection.getStart(),t=Je(e,n);return!!(e.dom.getParent(n,"LI,DT,DD",t)||Ge(e).length>0)&&(e.undoManager.transact((function(){e.execCommand("Delete"),et(e.dom,e.getBody())})),!0)}(e)},ct=function(e){var n=e.dom,t=ze(e);$e(t)&&e.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:n.getAttrib(t,"start")||"1"},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(t){var r=t.getData();e.undoManager.transact((function(){n.setAttrib(ze(e),"start","1"===r.start?"":r.start)})),t.close()}})},ft=function(e,n){return function(){var t=e.dom.getParent(e.selection.getStart(),"UL,OL,DL");return t&&t.nodeName===n}},dt=function(e){(function(e){return e.getParam("lists_indent_on_tab",!0)})(e)&&function(e){e.on("keydown",(function(n){n.keyCode!==Se.TAB||Se.metaKeyPressed(n)||e.undoManager.transact((function(){(n.shiftKey?In(e):Rn(e))&&n.preventDefault()}))}))}(e),function(e){e.on("keydown",(function(n){n.keyCode===Se.BACKSPACE?st(e,!1)&&n.preventDefault():n.keyCode===Se.DELETE&&st(e,!0)&&n.preventDefault()}))}(e)};i.add("lists",(function(e){return!1===function(e){return!(!/(^|[ ,])rtc([, ]|$)/.test(e.getParam("plugins","","string"))||!i.get("rtc"))}(e)&&(dt(e),function(e){e.on("BeforeExecCommand",(function(n){var t=n.command.toLowerCase();"indent"===t?Rn(e):"outdent"===t&&In(e)})),e.addCommand("InsertUnorderedList",(function(n,t){Jn(e,"UL",t)})),e.addCommand("InsertOrderedList",(function(n,t){Jn(e,"OL",t)})),e.addCommand("InsertDefinitionList",(function(n,t){Jn(e,"DL",t)})),e.addCommand("RemoveList",(function(){Mn(e)})),e.addCommand("mceListProps",(function(){ct(e)})),e.addQueryStateHandler("InsertUnorderedList",ft(e,"UL")),e.addQueryStateHandler("InsertOrderedList",ft(e,"OL")),e.addQueryStateHandler("InsertDefinitionList",ft(e,"DL"))}(e)),function(e){var n=function(n){return function(){return e.execCommand(n)}};(function(e,n){var t=e.getParam("plugins","","string");return-1!==Re.inArray(t.split(/[ ,]/),n)})(e,"advlist")||(e.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:n("InsertOrderedList"),onSetup:function(n){return qn(e,"OL",n.setActive)}}),e.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:n("InsertUnorderedList"),onSetup:function(n){return qn(e,"UL",n.setActive)}}))}(e),function(e){var n={text:"List properties...",icon:"ordered-list",onAction:function(){return ct(e)},onSetup:function(n){return qn(e,"OL",(function(e){return n.setDisabled(!e)}))}};e.ui.registry.addMenuItem("listprops",n),e.ui.registry.addContextMenu("lists",{update:function(n){var t=ze(e,n);return $e(t)?["listprops"]:[]}})}(e),function(e){return{backspaceDelete:function(n){st(e,n)}}}(e)}))}(window);